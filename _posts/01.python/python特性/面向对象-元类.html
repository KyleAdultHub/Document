---
title: 面向对象-元类
date: "2016-09-16 23:00:00"
categories:
- python
- python特性
tags:
- python
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">面向对象-元类</span></font></div><div><ul><li><div><font style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold; line-height: 21.6px;">类对象</span></font></div></li><ul><li><div><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 21.6px;">类对象的产生：<span style="font-size: 9pt; line-height: 21.6px;">在大多数编程语言中，类就是一组用来描述如何生成一个对象的代码段。在Python中这一点仍然成</span></span></font><span style="font-size: 9pt; line-height: 1.45;">立，<span style="font-size: 9pt; line-height: 1.45;">但是，Python中的类还远不止如此。类同样也是一种对象，只要你使用关键</span></span><span style="font-size: 9pt;">字class，Python解释器在执行的时候就会创建一个类对象</span><span style="font-size: 9pt; line-height: 1.45;">。</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;"> 类对象的功能：</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">0.创建（实例对象的能力）     “类的功能”</span></div></li><li><div><span style="font-size: 9pt;">1.你可以将它赋值给一个变量    “对象的功能”</span></div></li><li><div><span style="font-size: 9pt;">2. 你可以拷贝它       <span style="font-size: 9pt;">“对象的功能”</span></span></div></li><li><div><span style="font-size: 9pt;">3. 你可以为它增加属性       <span style="font-size: 9pt;">“对象的功能”</span></span></div></li><li><div><span style="font-size: 9pt;">4. 你可以将它作为函数参数进行传递       <span style="font-size: 9pt;">“对象的功能”</span></span></div></li></ul></ul><li><div><span style="font-size: 12px; font-weight: bold; line-height: 13.6px;">动态的创</span><span style="font-weight: bold; line-height: 13.6px; font-size: 9pt;">建类</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">动态创建类:</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">因为类也是对象，你可以在运行时动态的创建它们，就像其他任何对象一样。首先，你可以在函数中</span><span style="font-size: 9pt; line-height: 1.45;">创建类，使用class关键字即可。</span></font></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">1.比较low的方法</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">示例:</span></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/面向对象-元类_files/Image.png" type="image/png" data-filename="Image.png" width="302"/></span></div></li><li><div><span style="font-size: 9pt;">通过调用choose_class 可以实现动态的创建类，类似于实例创建的方法，但是这种方式还是不够动态；</span></div></li></ul><li><div>2<span style="font-size: 9pt;">.type-创建类</span></div></li><ul><li><div><span style="font-size: 9pt;">type的另外一种功能介绍：</span></div></li><ul><li><div><span style="font-size: 9pt;">type可以接受一个类的描述作为参数，然后返回一个类。</span></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">type创建类对象的格式：</span></div></li><ul><li><div><span style="font-size: 9pt;">type(类名, 由父类名称组成的元组（可以为空），包含属性的字典（名称和值）)</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">示例：</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/面向对象-元类_files/Image [1].png" type="image/png" data-filename="Image.png" width="229"/></span></div></li></ul><li><div><span style="font-size: 9pt;">注意：属性可以添加类属性，也可以添加类方法和静态方法和类方法，通过使用装饰器@classmethod和@staticmethod</span></div></li></ul></ul><li><div><span style="font-size: 9pt;">创建类幕后的事情</span></div></li><ul><li><div><span style="font-size: 9pt;">在Python中，类也是对象，你可以动态的创建类。这就是当你使用关键字class时Python在</span><span style="font-size: 9pt; line-height: 1.45;">幕后做的事情，而这就是通过元类来实现的。</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">面向对象-元类</span></font></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">元类概念：</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">在python中了解到对象也是实例，所以实例也应该是由类创建出来的，创建类对象的类就被叫做元类；</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">通过元类创建出来的类叫做类对象，通过类对象创建出来的对象叫做实例对象</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">type实际上就是一个元类，在创建类的时候，通过type的元类传入参数，创建出想要创建的额类</span></div></li><li><div><span style="font-size: 9pt;">Python中所有的东西，注意，我是指所有的东西——都是对象。这包括整数、字符</span><span style="font-size: 9pt; line-height: 1.45;">串、函数以及类。它们全部都是对象，而且它们都是从一个类创建而来，这个类就是type。（python中所有都是type创建出来的）</span></div></li></ul><li><div><span style="font-size: 9pt;">__metaclass__属性：</span></div></li><ul><li><div><span style="font-size: 9pt;">应用场景：__metaclass__属性应用在需要定义一个元类的时候；</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">例如：</span></div></li><ul><li><div><img src="/e_img/面向对象-元类_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="177"/></div></li></ul><li><div><span style="line-height: 13.6px;">__metclass__作用：</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">当python解释器在解释的时候，还没创建类对象之前，Python会在类的定义中寻找__metaclass__属性，如果找</span><span style="font-size: 9pt; line-height: 1.45;">到了，Python就会用它来创建类Foo，如果没有找到，就会用内建的type来创建这个类，如果找到了就会用__metclass__定义的方法来创建类。</span></div></li></ul><li><div><span style="font-size: 12px; line-height: 13.6px;">自定义元类的目的：</span></div></li><ul><li><div><span style="line-height: 13.6px;">拦截类的创建,通过调用__metclass__指向的类，去执行对应的__new__方法（如果没有该属性则去执行type的__new__方法）</span></div></li><li><div><span style="line-height: 13.6px;">修改类</span></div></li><li><div><span style="line-height: 13.6px;">返回修改类的结果</span></div></li></ul><li><div><font style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold; line-height: 13.6px;">python解释器执行的步骤</span></font></div></li><ul><li><div><font style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold; line-height: 13.6px;">比如当解释如下的代码时，python解释器做了如下的动作：</span></font></div></li><li><div><img src="/e_img/面向对象-元类_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="109"/></div></li><li><div>1.<span style="font-size: 9pt;">Foo中有__metaclass__这个属性吗？如果是，Python会通过__metaclass__创建一个名字为Foo的类</span></div></li><li><div><span style="font-size: 9pt;">(对象)</span></div></li><li><div><span style="font-size: 9pt;">2. 如果Python没有找到__metaclass__，它会继续在Bar（父类）中寻找__metaclass__属性，并尝试做</span></div></li><li><div><span style="font-size: 9pt;">和前面同样的操作。</span></div></li><li><div><span style="font-size: 9pt;">3. 如果Python在任何父类中都找不到__metaclass__，它就会在模块层次中去寻找__metaclass__，并尝</span></div></li><li><div><span style="font-size: 9pt;">试做同样的操作。</span></div></li><li><div><span style="font-size: 9pt;">4. 如果还是找不到__metaclass__,Python就会用内置的type来创建这个类对象。</span></div></li><li><div><span style="font-size: 9pt;">5.如果找到了__metclass__属性，那么按照__metaclass__定义的方法来创建类（</span><span style="font-size: 9pt;">__metaclass__中放置些什么代码呢：<span style="font-size: 9pt;">type，或者任何使用到type或者子类化type的东东都可以</span></span><span style="font-size: 9pt;">）</span></div></li></ul><li><div><span style="line-height: 13.6px;">自定义元类的方法</span></div></li><ul><li><div><img src="/e_img/面向对象-元类_files/Image [4].png" type="image/png" data-filename="Image.png" width="401"/></div></li></ul><li><div>应用到自定义元类的地方</div></li><ul><li><div>在使用数据库编程的时候，经常用到自定义元类，叫做orm框架，通过创建出来orm对象来完成和数据库表的匹配，并通过对象来完成对数据库的操作；（以后会做进一步介绍）  附件有orm框架的源码</div></li></ul></ul></ul></ul></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html>