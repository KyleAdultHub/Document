---
title: 网络协议与通信过程
date: "2016-09-12 22:00:00"
categories:
- python
- 网络协议与python
tags:
- python
- 网络协议
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 1.45;-evernote-highlight:true;">网络协议</span></font></span></div><div><ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">网络协议介绍 </span><span style="font-size: 10pt; line-height: 1.45;"> </span></li><ul><li><span style="font-size: 9pt;">协议</span></li><ul><li><span style="font-size: 9pt;">双方的约定、沟通的前提</span></li></ul><li><span style="font-size: 9pt;">网络协议</span></li><ul><li><span style="font-size: 9pt;">网络通讯双方的约定</span></li><li><span style="font-size: 9pt;">IP、ICMP、TCP、UDP、HTTP、ARP、DHCP</span></li></ul><li><span style="font-size: 9pt;">协议族</span></li><ul><li><span style="font-size: 9pt;">TCP/IP协议族 是当今互联网最通用一套网络协议族</span></li></ul><li><span style="font-size: 9pt;">网络协议的分层，OSI七层 VS TCP/IP四层</span></li><ul><li><img src="/e_img/网络协议与通信过程_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="300"/></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">TCP\IP网络参考模型</span></li><ul><li><img src="/e_img/网络协议与通信过程_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="379"/></li><li><span style="font-size: 9pt;">应用层协议：HTTP、DHCP协议</span></li><li><span style="font-size: 9pt;">将协议分层的意义：封装和隔离，每层只需要使用其他层提供的接口来实现其对应的功能</span></li></ul><li><span style="font-size: 10pt; font-weight: bold;">各种网络协议与网络设备的介绍</span></li><ul><li><span style="font-size: 9pt;">网络协议中的基础介绍</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">ip地址</span></li><ul><li><span style="font-size: 9pt;">概念：IP地址由子网号和主机号构成。</span></li><li><span style="font-size: 9pt; line-height: 1.45;">获取方式：手动设置容易冲突，</span><span style="font-size: 9pt;">使用DHCP自动分配时会自动获取IP地址和子网掩码</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">作用：</span><span style="font-size: 9pt; line-height: 13.600000381469727px;"> </span><span style="font-size: 9pt; line-height: 13.600000381469727px;">IP地址是一台主机在网络中的逻辑地址，网络中通信前提</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">，是在网络中标识一台主机的标识符；</span></font></li></ul><li><span style="font-size: 9pt;">子网掩码</span><span style="font-size: 9pt; line-height: 1.45;">。</span></li><ul><li><span style="font-size: 9pt;">子网掩码作用：和IP地址按位&amp;，获取IP地址中网络号。然后判断该网段是属于局域网还是网络子网，如果不在局域网会去访问网关</span></li></ul><li><span style="font-size: 9pt;">MAC地址</span></li><ul><li><span style="font-size: 9pt;">概念：</span></li><ul><li><span style="font-size: 9pt;">也称物理地址、硬件地址，实际就是写入到网卡中6字节序列号数据，一般全球唯一。</span></li><li><span style="font-size: 9pt;">IP地址是网络层的标识，数据链路层不能识别上层标识IP，只能靠mac地址来完成数据通讯，mac地址是同网段通讯得前提；</span></li></ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">获取的方法：</span></li><ul><li><span style="font-size: 9pt;">当用IP地址来进行通信时，交换机如果没有记录对应IP的mac地址，会应用ARP协议进行全网广播，对应的IP地址的机器会返回消息，交换机会记录对应机器的mac地址的信息，之后发送给此mac地址便不需要广播；</span></li></ul><li><span style="font-size: 9pt;">MAC地址作用：</span></li><ul><li><span style="font-size: 9pt;">在数据链路层工作，可以被交换机识别，用来标识子网中的主机；</span></li><li><span style="font-size: 9pt;">主机用以判断数据是否发给自己的</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">DNS（域名系统）</span></font></li><ul><li><span style="font-size: 9pt;">DNS（Domain Name System，域名系统），因特网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP地址。</span></li><li><span style="font-size: 9pt;">通过主机名，最终得到该主机名对应的IP地址的过程叫做域名解析。</span></li></ul><li><span style="font-size: 9pt;">NAT</span></li><ul><li><span style="font-size: 9pt;">当在专用网内部的一些主机本来已经分配到了本地IP地址（即仅在本专用网内使用的专用地址），又想和因特网上的主机通信可使用NAT方法，这样所有的主机可以通过公网的IP地址来访问互联网。</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">路由器可以通过NAT功能，在内网中的主机访问公网的时候，可以将其IP地址和端口替换成路由器的公网地址，并通过路由器的端口来记录该IP地址，这样路由器收到公网的信息反馈再反馈给对应的IP地址</span></font></li></ul></ul><li><span style="font-size: 9pt;">DHCP动态主机配置协议</span></li><ul><li><span style="font-size: 9pt;">是一个应用层协议。当我们将客户主机iP地址设置为动态获取方式时，DHCP服务器就会根据DHCP协议给局域网计算机分配IP和子网掩码，使得客户机能够利用这个IP上网和通信。</span></li></ul><li><span style="font-size: 9pt;">ARP协议</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">ARP协议作用</span></font></li><ul><li><span style="font-size: 9pt;">ARP（Address Resolution Protocol），是</span><span style="font-size: 9pt; font-weight: bold;">根据IP地址获取物理地址的一个TCP/IP协议</span><span style="font-size: 9pt;">。</span></li><li><span style="font-size: 9pt;">当需要获取目的IP的MAC地址时先全网ARP广播，广播信息中包括想要寻找的IP地址</span></li><li><span style="font-size: 9pt;">收到ARP广播 判断IP地址是否为自己是则回复自己MAC地址，不是则丢掉</span></li></ul><li><span style="font-size: 9pt;">ARP命令</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">arp -a    </span><span style="font-size: 9pt; line-height: 13.600000381469727px;">用来获取进行过数据交流的主机信息</span></li><li><span style="font-size: 9pt; font-weight: bold;">ping命令     采用ICMP协议实现通讯的原理</span></li><ul><li><span style="font-size: 9pt;">ping 172.16.31.127</span></li><li><span style="font-size: 9pt;">ICMP报文发送之前需要通过arp协议获取MAC地址</span></li><li><span style="font-size: 9pt;">为获取MAC地址首先ARP广播，获取MAC地址后才能进行数据包的发送和接收</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">拓展：rarp协议是通过mac地址寻找IP地址</span></li></ul></ul><li><font style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold; line-height: 13.600000381469727px;">交换机\集线器\路由器的介绍</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">集线器--HUB  （</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">外接USB口 大多采用集线器方式， 容器产生电涌现象</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">）</span></font></li><ul><li><span style="font-size: 9pt;">作用：在物理层上全部数据直接广播 (电信号)</span></li><li><span style="font-size: 9pt;">存在问题：由于只在物理层工作所以只传播电信号，不能识别链路层的mac地址，不能控制数据的发送到指定机器，而且广播数据容易造成网络造成阻塞</span></li><li><span style="font-size: 9pt;">目前网络设备中比较少见，还存在于一些比较特殊的环境中。</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">交换机--Switch</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">作用：用于局域网中的通信</span></font></li><li><span style="font-size: 9pt;">原理：</span></li><ul><li><span style="font-size: 9pt;">具有MAC地址学习能力，能够缓存IP地址到MAC转换关系，记录到交换机的固定端口；</span></li><li><span style="font-size: 9pt;">交换机会存储IP-MAC的转换关系，具有时效性，过期将删除</span></li></ul><li><span style="font-size: 9pt;">分类:</span></li><ul><li><span style="font-size: 9pt;">两层交换机 可识别MAC 可根据MAC转发</span></li><li><span style="font-size: 9pt;">三层交换机(拓展功能带路由功能)</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">路由器--Router</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">作用：</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">又称网关设备（Gateway）是用于连接多个逻辑上分开的网络。</span></font></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">原理：</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">路由器是网关设备，存在一个局域网中，<span style="font-size: 9pt;">路由器中时刻维持着一张路由表，记录着可以和该网络通讯的网段网关地址和其他等信息，这样当局域网想要访问其他网关的时候，路由器就可以通过路由表找的对应的网关地址，<span style="font-size: 9pt;">将报文送给相应端口的数据链路层，数据链路层封装后，发送报文；</span></span></span></font></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">路由器当收到一个子网传递给其他网络的信息的时候，会根据RIP协议或者手动设置的规定的下一跳地址来判断下一跳的最优地址，然后替换网络报文中的下一跳的mac地址，以此来访问整个互联网络，这就是<span style="font-size: 9pt; line-height: 13.600000381469727px;">路由器的判断</span><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">网络地址</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">和选择</span><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">IP路径</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">的功能。</span></span></font></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">作用：用来连接多个逻辑上分开的网络，和<span style="font-size: 9pt; line-height: 13.600000381469727px;">判断</span><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">网络地址</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">和选择</span><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">IP路</span></span><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">径</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">的功能</span></font></li></ul></ul></ul><div><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">网络通信过程介绍</span></span></font></div><div><ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">TCP\IP协议传输示意图</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/网络协议与通信过程_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-weight: bold;" width="377"/></span></li><li><span style="font-size: 9pt; line-height: 1.45;">在构造网络报文的时候，每经过一层会被打上一个头</span></li><li><span style="font-size: 9pt; line-height: 1.45;">其中链路层的mac地址是一直在变化的，在链路层中每次路由的传递会对应的替换其中的mac地址为下一跳的mac地址</span></li><li><span style="font-size: 9pt; line-height: 1.45;">报文的IP地址用来指向最终的传输地址（终点），mac地址用来指向下一跳地址（指路）</span></li></ul></ul></div></div><div><ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">上网全过程分析</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">1. 域名解析开始； 2. ARP探测网关MAC地址； 3. IP路由选择； 4. 域名解析完成结果返回HTTP服务器IP； 5. 建立和HTTP服务器的连接； 6. 连接发送HTTP请求-响应-解析-显示； 7. 关闭连接</span></li><li><span style="font-size: 9pt;"><img src="/e_img/网络协议与通信过程_files/Image [3].png" type="image/png" data-filename="Image.png" width="385"/></span></li></ul></ul></div><div><ul><li><span style="font-size: 9pt; font-weight: bold;">实例（访问百度服务器的全过程）</span></li><ul><li><font style="font-size: 9pt;"><span style="text-indent: 0pt; letter-spacing: 0pt; text-transform: none; font-size: 9pt; font-family: 微软雅黑; line-height: 150%;">一、先要解析出</span><span style="text-indent: 0pt; letter-spacing: 0pt; text-transform: none; font-size: 9pt; font-family: 微软雅黑; line-height: 150%;"><a href="http://baidu.com/" style="font-size: 9pt; font-family: 微软雅黑; line-height: 150%;">baidu.com</a>对应的ip地址</span></font></li><ul><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">1.要先使用arp获取默认网关的mac地址</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">2.组织数据发送给默认网关（ip还是dns服务器的ip，但是mac地址是默认网关的mac地址）</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">3.默认网关拥有转发数据的能力，把数据转发给路由器</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">4.路由器根据自己的路由协议，来选择一个合适的较快的路径转发数据给目的网关</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">5,目的网关（dns服务器所在的网关），把数据转发给dns服务器</span></span></li><li><font style="font-size: 9pt;"><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify; font-size: 9pt; line-height: 150%;">6.dns服务器查询解析出</span><a href="http://baidu.com/" style="letter-spacing: 0pt; text-indent: 0pt; background-color: rgb(255, 255, 255); text-align: justify; font-size: 9pt; line-height: 150%;">baidu.com</a><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify; font-size: 9pt; line-height: 150%;">对应的ip地址，并原路返回请求这个域名的client</span></font></li></ul><li><font style="font-size: 9pt;"><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify; font-size: 9pt; line-height: 150%;">二、得到了</span><a href="http://baidu.com/" style="letter-spacing: 0pt; text-indent: 0pt; background-color: rgb(255, 255, 255); text-align: justify; font-size: 9pt; line-height: 150%;">baidu.com</a><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify; font-size: 9pt; line-height: 150%;">对应的ip地址之后，会发送tcp的3次握手，进行连接</span></font></li><ul><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">1.使用http协议发送请求数据个web服务器</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">2.web服务器收到数据请求之后，通过查询自己的服务器得到相应的结果，原路返回给浏览器</span></span></li><li><span style="letter-spacing: 0pt; text-indent: 0pt; text-align: justify;"><span style="font-size: 9pt; line-height: 150%;">3.浏览器接收到数据之后通过浏览器自己的渲染功能来显示这个网页</span></span></li><li><font style="font-size: 9pt;"><span style="text-indent: 0pt; letter-spacing: 0pt; font-size: 9pt; line-height: 150%;"> 4.浏览器关闭</span><span style="text-indent: 0pt; letter-spacing: 0pt; background-color: rgb(255, 255, 255); font-size: 9pt; line-height: 150%;">tcp</span><span style="text-indent: 0pt; letter-spacing: 0pt; background-color: rgb(255, 255, 255); font-size: 9pt; line-height: 150%;">连接，即</span><span style="text-indent: 0pt; letter-spacing: 0pt; background-color: rgb(255, 255, 255); font-size: 9pt; line-height: 150%;">4</span><span style="text-indent: 0pt; letter-spacing: 0pt; font-size: 9pt; line-height: 150%;">次挥手结束，完成整个访问过程。</span></font></li></ul></ul></ul></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html>