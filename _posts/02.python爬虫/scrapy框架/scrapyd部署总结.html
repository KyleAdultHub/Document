---
title: Scrapyd部署总结
date: "2017-04-06 22:00:00"
categories:
- python爬虫
- scrapy框架
tags:
- 爬虫
- scrapy
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><span style="font-size: 18px; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold;">二、环境安装</span></div><div style="vertical-align: baseline; background-color: transparent;"><div style="vertical-align: baseline; background-image: url(&quot;http://static.blog.csdn.net/skin/skin-yellow/images/bg-yellow.png&quot;); background-repeat: repeat;"><div style="vertical-align: baseline;"><div style="vertical-align: baseline; text-align: left; min-width: 980px;"><div style="vertical-align: baseline; box-sizing: border-box;"><div style="vertical-align: baseline; overflow: hidden; background-color: rgb(255, 255, 255);"><div style="vertical-align: baseline; background-color: rgb(255, 255, 255);"><div style="margin: 35px 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">安装scprayd，网址：</span><a href="https://github.com/scrapy/scrapyd" style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(12, 137, 207); font-family: &quot;PT Serif&quot;; line-height: 35px; text-decoration: none;" target="_blank">https://github.com/scrapy/scrapyd</a></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">安装scrapyd-client，网址：</span><a href="https://github.com/scrapy/scrapyd-client" style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(12, 137, 207); font-family: &quot;PT Serif&quot;; line-height: 35px; text-decoration: none;" target="_blank">https://github.com/scrapy/scrapyd-client</a></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">建议从github上下载最新源码，然后用python setup.py install安装，因为pip安装源有可能不是最新版的。</span></span></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; font-size: 18px; vertical-align: baseline;"><span style="font-size: 18px; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">三、验证安装成功</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">在命令框中输入scrapyd，输出如下说明安装成功</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161114205256046.png" type="image/png" data-filename="20161114205256046.png" height="229" style="margin: 0px; border: none; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; padding: 0px; line-height: inherit; font-family: inherit; vertical-align: baseline; max-height: 100%; max-width: 602px; height: auto;" width="602"/></span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">打开http://localhost:6800/ 可以看到</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161114205800994.png" type="image/png" data-filename="20161114205800994.png" height="353" style="margin: 0px; border: none; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; padding: 0px; line-height: inherit; font-family: inherit; vertical-align: baseline; max-height: 100%; max-width: 602px; height: auto;" width="602"/></span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">点击jobs可以查看爬虫运行情况。</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161114205913543.png" type="image/png" data-filename="20161114205913543.png" height="220" style="margin: 0px; border: none; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; padding: 0px; line-height: inherit; font-family: inherit; vertical-align: baseline; max-height: 100%; max-width: 602px; height: auto;" width="324"/></span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">接下来就是让人很头疼的scrapyd-deploy问题了，查看官方文档上说用</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">scrapyd-deploy -l</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">可以看到当前部署的爬虫项目，但是当我输入这段命令的时候显示这个命令不存在或者有错误、不合法之类的。</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: rgb(255, 255, 255); border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">解决方案：</span></span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">在你的python目录下的Scripts文件夹中，我的路径是“D:\program files\python2.7.0\Scripts”，增加一个scrapyd-deploy.bat文件。</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">内容为：</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">@echo off</span></span></div><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">&quot;D:\program files\python2.7.0\python.exe&quot; &quot;D:\program files\python2.7.0\Scripts\scrapyd-deploy&quot; %*</span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">然后重新打开命令框，再运行scrapyd-deploy -l 就可以了。</span></span></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><br/></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; font-size: 18px; vertical-align: baseline;"><span style="font-size: 18px; background-color: rgb(255, 255, 255); border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">四、发布工程到scrapyd</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">scrapyd-deploy &lt;target&gt; -p &lt;project&gt;</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">target为你的服务器命令，project是你的工程名字。</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">首先对你要发布的爬虫工程的scrapy.cfg 文件进行修改，我这个文件的内容如下：</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">[deploy:scrapyd1]</span></span></div><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="font-size: 12pt; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">url = http://localhost:6800/</span></span></div><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">project = baidu</span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="font-size: 12pt; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">因此我输入的命令是：</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">scrapyd-deploy scrapyd1 -p baidu</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">输出如下</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161115115154867.png" type="image/png" data-filename="20161115115154867.png" height="116" style="margin: 0px; border: none; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; padding: 0px; line-height: inherit; font-family: inherit; vertical-align: baseline; max-height: 100%; max-width: 602px; height: auto;" width="602"/></span></span></div></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><br/></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; font-size: 18px; vertical-align: baseline;"><span style="font-size: 18px; background-color: rgb(255, 255, 255); border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">五、启动爬虫</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">使用如下命令启动一个爬虫</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">curl http://localhost:6800/schedule.json -d project=PROJECT_NAME -d spider=SPIDER_NAME</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">PROJECT_NAME填入你爬虫工程的名字，SPIDER_NAME填入你爬虫的名字</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">我输入的代码如下：</span></span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">curl http://localhost:6800/schedule.json -d project=baidu -d spider=baidu</span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161115115441699.png" type="image/png" data-filename="20161115115441699.png" height="77" style="margin: 0px; border: none; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; padding: 0px; line-height: inherit; font-family: inherit; vertical-align: baseline; max-height: 100%; max-width: 602px; height: auto;" width="602"/></span></span></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><br/></div></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">因为这个测试爬虫写的非常简单，一下子就运行完了。查看网站的jobs可以看到有一个爬虫已经运行完，处于Finished一列中</span></span></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><div><span style="font-size: 15px; background-color: rgb(255, 255, 255); color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;"><img src="/e_img/scrapyd部署总结_files/20161115115521424.png" type="image/png" data-filename="20161115115521424.png" height="271" style="font-size:inherit;margin:0px;border:none;font-style:inherit;font-variant:inherit;font-weight:inherit;font-stretch:inherit;padding:0px;line-height:inherit;font-family:inherit;vertical-align:baseline;max-height:100%;max-width:602px;height:auto;" width="602"/></span></div></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; font-size: 18px; vertical-align: baseline;"><span style="font-size: 18px; background-color: rgb(255, 255, 255); border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">六、停止一个爬虫</span></span></div><div style="font-size: 13px; vertical-align: baseline; margin: 0px 0px 20px; border: 0px; padding: 9.5px; word-break: break-all; background-color: rgb(253, 246, 227); white-space: pre-wrap; word-wrap: normal; overflow: auto;"><span style="font-size: 12px; background-color: transparent; border: none; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">curl http://localhost:</span><span style="margin: 0px; border: 0px; padding: 0px; font-size: inherit; vertical-align: baseline; background-color: transparent; color: rgb(42, 161, 152); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">6800</span><span style="font-size: 12px; background-color: transparent; border: none; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">/cancel.json</span> <span style="margin: 0px; border: 0px; padding: 0px; font-size: inherit; vertical-align: baseline; background-color: transparent; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">-d</span> <span style="font-size: 12px; background-color: transparent; border: none; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">project=PROJECT_NAME</span> <span style="margin: 0px; border: 0px; padding: 0px; font-size: inherit; vertical-align: baseline; background-color: transparent; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">-d</span> <span style="font-size: 12px; background-color: transparent; border: none; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(101, 123, 131); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; line-height: 20px;">job=JOB_ID</span></div><div style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="font-size: 12pt; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; line-height: 35px;">更多API可以查看官网：</span><a href="http://scrapyd.readthedocs.io/en/latest/api.html" style="margin: 0px; border: 0px; padding: 0px; vertical-align: baseline; font-size: 12pt; color: rgb(12, 137, 207); font-family: &quot;PT Serif&quot;; line-height: 35px; text-decoration: none;" target="_blank">http://scrapyd.readthedocs.io/en/latest/api.html</a></span></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><br/></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;"><span style="margin: 0px; border: 0px; padding: 0px; font-size: 18px; vertical-align: baseline;"><span style="font-size: 18px; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; color: rgb(85, 85, 85); font-family: &quot;PT Serif&quot;; font-weight: bold; line-height: 35px;">七、根据文档编写的调度脚本</span></span></div><div style="font-size: inherit; margin: 0px; border: 0px; padding: 0px; vertical-align: baseline;">前提: 已安装scrapyd-client</div><div style="font-size: 15px;"><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div># coding=utf-8</div><div>import requests</div><div>import time</div><div>import json</div><div>import os</div><div>import sys</div><div>reload(sys)</div><div>sys.setdefaultencoding('utf-8')</div><div>BASE_DIR = os.path.dirname(os.path.abspath(os.path.dirname(__file__)))</div><div>sys.path.insert(0, os.path.join(BASE_DIR, 'conf'))</div><div><br/></div><div># 需要配置</div><div>SCRAPYD_NODE = &quot;&quot;</div><div>PROJECT_NAME = &quot;&quot;</div><div><br/></div><div><br/></div><div>class SpiderSwitch(object):</div><div><br/></div><div>    def __init__(self, project_name=&quot;&quot;, node=&quot;&quot;):</div><div>        self.project_name = project_name</div><div>        self.ip_port = node</div><div><br/></div><div>    def delete_project(self):</div><div>        &quot;&quot;&quot;</div><div>        删除项目</div><div>        &quot;&quot;&quot;</div><div>        delete_data = {&quot;project&quot;: self.project_name}</div><div>        delete_url = &quot;http://{}/delproject.json&quot;.format(self.ip_port)</div><div>        response = requests.post(delete_url, data=delete_data)</div><div>        print &quot;delete_project: [{}]&quot;.format(response.content.decode())</div><div><br/></div><div>    def start_spider(self, spider_name):</div><div>        &quot;&quot;&quot;</div><div>        启动爬虫的方法</div><div>        :return: 返回启动的状态</div><div>        &quot;&quot;&quot;</div><div>        start_data = {'project': self.project_name, 'spider': spider_name}</div><div>        start_url = &quot;http://{}/schedule.json&quot;.format(self.ip_port)</div><div>        response = requests.post(url=start_url, data=start_data)</div><div>        print &quot;start_spider: [{}]&quot;.format(response.content.decode())</div><div><br/></div><div>    def stop_spider(self, job_id):</div><div>        &quot;&quot;&quot;</div><div>        关闭爬虫的方法</div><div>        :return:返回关闭结果</div><div>        &quot;&quot;&quot;</div><div>        stop_data = {'project': self.project_name, 'job': job_id}</div><div>        stop_url = &quot;http://{}/cancel.json&quot;.format(self.ip_port)</div><div>        response = requests.post(stop_url, data=stop_data)</div><div>        print &quot;stop_spider: [{}]&quot;.format(response.content.decode())</div><div><br/></div><div>    def show_spiders(self):</div><div>        &quot;&quot;&quot;</div><div>        获取scrapyd服务器上名为myproject的工程下的爬虫清单</div><div>        :return: 返回查询到的状态</div><div>        &quot;&quot;&quot;</div><div>        show_url = 'http://{}/listspiders.json?project={}'.format(self.ip_port, self.project_name)</div><div>        response = requests.get(show_url)</div><div>        print &quot;show_spiders : [{}]&quot;.format(json.loads(response.content.decode()))</div><div><br/></div><div>    def show_project(self):</div><div>        &quot;&quot;&quot;</div><div>        查看所有项目</div><div>        :return:返回查询结果</div><div>        &quot;&quot;&quot;</div><div>        show_url = &quot;http://{}/listprojects.json&quot;.format(self.ip_port)</div><div>        response = requests.get(show_url)</div><div>        print &quot;show_projects: [{}]&quot;.format(response.content.decode())</div><div><br/></div><div>    def show_jobs(self):</div><div>        &quot;&quot;&quot;</div><div>        查看正在运行的job</div><div>        :return: 返回查看结果</div><div>        &quot;&quot;&quot;</div><div>        job_url = &quot;http://{}/listjobs.json?project={}&quot;.format(self.ip_port, self.project_name)</div><div>        response = requests.get(job_url)</div><div>        print &quot;jobs: [{}]&quot;.format(response.content.decode())</div><div>        return response.content.decode()</div><div><br/></div><div>    def start_some(self, name, n):</div><div>        &quot;&quot;&quot;</div><div>        一次启动多个任务</div><div>        :param:n: 启动的任务数量</div><div>        &quot;&quot;&quot;</div><div>        for i in xrange(n):</div><div>            time.sleep(0.2)</div><div>            self.start_spider(name)</div><div><br/></div><div>    def stop_project(self):</div><div>        &quot;&quot;&quot;</div><div>        停止改项目下的所有爬虫</div><div>        &quot;&quot;&quot;</div><div>        job_list = json.loads(self.show_jobs()).get(u&quot;running&quot;)</div><div>        if job_list:</div><div>            for job in job_list:</div><div>                spider_job_id = job.get(u&quot;id&quot;)</div><div>                self.stop_spider(spider_job_id)</div><div>                time.sleep(0.2)</div><div>        print u&quot;the jobs for the project are all closed&quot;</div><div><br/></div><div><br/></div><div>if __name__ == '__main__':</div><div>    scrpayd_node = SCRAPYD_NODE</div><div>    spider_switch = SpiderSwitch(project_name=PROJECT_NAME, node=scrpayd_node)</div><div>    task = sys.argv[1]</div><div><br/></div><div>    if task == &quot;start&quot;:</div><div>        spider_name = sys.argv[2]</div><div>        spider_switch.start_spider(spider_name)</div><div><br/></div><div>    if task == &quot;stop&quot;:</div><div>        job_id = sys.argv[2]</div><div>        spider_switch.stop_spider(job_id)</div><div><br/></div><div>    if task == &quot;show_jobs&quot;:</div><div>        spider_switch.show_jobs()</div><div><br/></div><div>    if task == &quot;show_spiders&quot;:</div><div>        spider_switch.show_spiders()</div><div><br/></div><div>    if task == &quot;delete_project&quot;:</div><div>        spider_switch.delete_project()</div><div><br/></div><div>    if task == &quot;show_projects&quot;:</div><div>        spider_switch.show_project()</div><div><br/></div><div>    if task == &quot;start_some&quot;:</div><div>        spider_name = sys.argv[2]</div><div>        job_num = int(sys.argv[3])</div><div>        spider_switch.start_some(spider_name, job_num)</div><div><br/></div><div>    if task == &quot;stop_project&quot;:</div><div>        spider_switch.stop_project()</div></div><div style="font-size: 15px;"><br/></div></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html>