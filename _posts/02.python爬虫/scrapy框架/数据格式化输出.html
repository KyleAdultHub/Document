---
title: 数据格式化输出
date: "2017-03-26 23:00:00"
categories:
- python爬虫
- scrapy框架
tags:
- 爬虫
- scrapy
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><span style="font-size: 18.399999618530273px;background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 18.4px; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">自动格式化输出文件</span></span></div><div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 21.6px;">scrapy支持的格式化输出文件格式</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">json</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">jsonlines</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">csv</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">xml</span></font></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 21.6px;">通过配置setting中属性，来定义存储方式</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;"><span style="font-size: 9pt; line-height: 21.6px; font-weight: bold;">FEED_URI</span>   存储路径，必须配置，如果不配置，需要在启动时候指定路径</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">示例：file://tmp/export.csv</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">备注：</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;">路径的名称可以格式化，例如：</span></font></div></li><ul><li><div><img src="/e_img/数据格式化输出_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="446"/></div></li></ul></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;"><span style="font-size: 9pt; line-height: 21.6px; font-weight: bold;">FEED_FORMAT</span>   用于序列化输出的文件格式，就是上面的几种</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 21.6px;"><span style="font-size: 9pt; line-height: 21.6px; font-weight: bold;">FEED_EXPORT_ENCODING</span>   文件编码格式，一般默认utf-8，json默认是安全编码格式</span></font></div></li><li><div><span style="font-size: 9pt; font-weight: bold;">FEED_EXPORT_FIELDS</span> <span style="font-size: 9pt;">   定义输出文件中包含的字段，为列表格式</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;"><span style="font-size: 9pt; line-height: 13.6px; font-weight: bold;">FEED_EXPORT_INDENT</span>    定义输出内容的缩进，默认为0,</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">0和负数表示内容会放在一行上</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">None会选择最紧凑的方式，将数据进行摆放</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">其他，将会按照指定的缩进，对对象的成员进行格式化显示</span></font></div></li></ul><li><div><span style="font-size: 9pt; font-weight: bold;">FEED_STORE_EMPTY</span> <span style="font-size: 9pt;">    如果没输出是否会导出文件，默认为False</span></div></li><li><div><span style="font-size: 9pt; font-weight: bold;">FEED_STORAGES_BASE</span> <span style="font-size: 9pt;">   字典类型，包含所有支持存储方式模板引擎</span><span style="font-size: 9pt; line-height: 1.45;">， 一般不需要手动配置</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">默认为</span></font></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/数据格式化输出_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="415"/></span></div></li></ul></ul></ul></div><div><ul><li><div><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">FEED_STORAGES</span> <span style="font-size: 9pt; line-height: 1.45;">    一个字典类型，可以手动添加存储方式的模板引擎</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">默认为 { }</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">如果想要禁用某一个模板文件类型的引擎，可以将上面对应字段值设置为None</span></div></li></ul><li><div><span style="font-size: 9pt; font-weight: bold;">FEED_EXPORTERS_BASE  </span> <span style="font-size: 9pt;"> 字典类型，包含了所有支持的格式文件处理引擎</span><span style="font-size: 9pt; line-height: 1.45;">， 一般不需要手动配置</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">默认为</span></font></div></li><li><div><img src="/e_img/数据格式化输出_files/Image [2].png" type="image/png" data-filename="Image.png" width="402"/></div></li></ul></ul><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">FEED_EXPORTERS      </span><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">一个字典类型，可以手动添加文件处理引擎</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">默认为{ }</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">如果想要禁用某一个模板文件类型的引擎，可以将上面对应字段值设置为None</span></div></li></ul></ul></div><div><font style="background-color: rgb(255, 250, 165);font-size: 14pt;-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">scrapy手动输出指定csv格式文件</span></font></div><div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">目标：</span></font></div></li><ul><li><div><span style="font-size: 9pt;">获取如下格式的csv文件</span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">配置的步骤</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">1. 在scrapy的spiders同层目录，新建my_project_csv_item_exporter.py文件内容如下（文件名可改，目录定死）</span></font></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            from scrapy.conf import settings</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            from scrapy.contrib.exporter import CsvItemExporter</span></div><div><br style="font-size: 9pt;"/></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            class MyProjectCsvItemExporter(CsvItemExporter):</span></div><div><br style="font-size: 9pt;"/></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            def __init__(self, *args, **kwargs):</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                delimiter = settings.get('CSV_DELIMITER', ',')</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                kwargs['delimiter'] = delimiter</span></div><div><br style="font-size: 9pt;"/></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                fields_to_export = settings.get('FIELDS_TO_EXPORT', [])</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                if fields_to_export :</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                    kwargs['fields_to_export'] = fields_to_export</span></div><div><br style="font-size: 9pt;"/></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                super(</span><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; line-height: 1.45;">MyProjectCsvItemExporter, self).__init__(*args, **kwargs)</span></div></div><ul><li><div><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">2. 在同层目录，settings.py文件新增如下内容（指定item,field顺序）</span></span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            FEED_EXPORTERS = {</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                'csv': 'my_project.my_project_csv_item_exporter.MyProjectCsvItemExporter',</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            } #这里假设你的project名字为my_project</span></div><div><br style="font-size: 9pt;"/></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            FIELDS_TO_EXPORT = [</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                'id',</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                'name',</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                'email',</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">                'address'</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">            </span></div></div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">3. 在同层目录，settings.py文件指定分隔符</span></font></div></li><ul><li><div><span style="font-size: 9pt;">CSV_DELIMITER = &quot;\t&quot;</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">4.启动项目</span></font></div></li><ul><li><div><span style="font-size: 9pt;">全部设定完后，执行scrapy crawl spider -o spider.csv的时候，字段就按顺序来了。</span></div></li></ul></ul></div><div><br/></div></span>
</div></body></html>