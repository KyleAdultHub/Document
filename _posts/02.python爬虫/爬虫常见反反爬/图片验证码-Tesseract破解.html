---
title: 图片验证码-Tesseract破解
date: "2017-05-02 23:00:00"
categories:
- python爬虫
- 爬虫常见反反爬
tags:
- 爬虫
- 反反爬
toc: true
typora-root-url: ..\..\..
---

<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/307941 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="416"/>

<div>
<span><div><div><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">图像的翻译-Tesseract</span></div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">文字识别</span></font></div></li><ul><li><div><span style="font-size: 9pt;">文字识别-机器视觉的一个分支，将图像翻译成文字一般被称为 光学文字识别(Optical Character Recognition, OCR)。可以实现OCR的底层库并不多,目前很多库都是使用共同的几个底层 OCR 库,或者是在上面 进行定制</span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">ORC库的概念</span></font></div></li><ul><li><div><span style="font-size: 9pt;">在读取和处理图像、图像相关的机器学习以及创建图像等任务中，Python 一直都是非常出色的语言。虽然有很多库可以进行图像处理，但在这里我们只重点介绍： Tesseract</span></div></li></ul><li><div><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">作用</span></div></li><ul><li><div><span style="font-size: 9pt;">Tesseract是一个将图像翻译成文字的OCR库(光学文字识别，Optical Character Recognition)，可以翻译图片中的文字内容，目前由 Google 赞助(Google 也是一家以 OCR 和机器学习技术闻名于世的公司)。Tesseract 是目前公认最优秀、最精确的开源 OCR 系统，除了极高的精确度，Tesseract 也具有很高的灵活性。它可以通过训练识别出任何字体，也可以识别出任何 Unicode 字符。</span></div></li></ul><li><div><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">tesseract处理的文字规范</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">tesseract处理的文字大都是格式规范的，</span><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">格式规范的文字具有以下特点:</span></font></div></li><ul><li><div><span style="font-size: 9pt;">使用一个标准字体(不包含手写体、草书,或者十分“花哨的”字体)</span></div></li><li><div><span style="font-size: 9pt;">即使被复印或拍照，字体还是很清晰，没有多余的痕迹或污点</span></div></li><li><div><span style="font-size: 9pt;">排列整齐，没有歪歪斜斜的字</span></div></li><li><div><span style="font-size: 9pt;">没有超出图片范围，也没有残缺不全，或紧紧贴在图片的边缘</span></div></li></ul><li><div><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">怎么将图片格式化</span></span></div></li><ul><li><div><span style="font-size: 9pt;">文字的一些格式问题在图片预处理时可以进行解决。例如,可以把图片转换成灰度图，调整亮度和对比度，还可以根据需要进行裁剪和旋转（详情需要了解图像与信号处理）等</span></div></li></ul></ul><li><div><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">使用步骤</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">安装</span><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">tesseract和tensor-ocr</span></font></div></li><ul><li><div><span style="font-size: 9pt; font-weight: bold;">windows下安装</span></div></li><ul><li><div><span style="font-size: 9pt;">先下载tesseract<span style="font-size: 9pt;">-ocr</span></span></div></li><ul><li><div><span style="font-size: 9pt;">下载地址:</span> <a href="https://digi.bib.uni-mannheim.de/tesseract" style="font-size: 9pt;">https://digi.bib.uni-mannheim.de/tesseract</a></div></li></ul><li><div><span style="font-size: 9pt;">下载 pytenseract</span></div></li><ul><li><div><span style="font-size: 9pt;">pip install pytesseract pillow</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">ubuntu下安装</span></font></div></li><ul><li><div><span style="font-size: 9pt;">sudo apt-get install -y tesseract-ocr libtesseract-dev libleptonica-dev</span></div></li><li><div><span style="font-size: 9pt;">pip install</span> <span style="font-size: 9pt;">pytesseract </span><span style="font-size: 9pt;">pillow</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">centos下安装</span></font></div></li><ul><li><div><span style="font-size: 9pt;">yum install -y tesseract</span></div></li><li><div><span style="font-size: 9pt;">pip install</span> <span style="font-size: 9pt;">pytesseract p</span><span style="font-size: 9pt;">illow </span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; font-weight: bold;">在终端中使用tesseract</span></div></li><ul><li><div><span style="font-size: 9pt;">tesseract  test.jpg  text      将翻译结果保存在text.txt中</span></div></li><li><div><span style="font-size: 9pt;">tesseract chi_sim  text.png  paixu    将翻译结果保存在paixu.txt中（可以翻译中文简体）</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">tesseract --list-langs    查看当前支持的语言</span></div></li><li><div><img src="/e_img/图片验证码-Tesseract破解_files/Image.png" type="image/png" data-filename="Image.png" width="546"/></div></li></ul><li><div><span style="font-size: 9pt; font-weight: bold;">在Python中使用tesesract</span></div></li><ul><li><div><span style="font-size: 9pt;">import <span style="font-size: 9pt;">pytesseract</span></span></div></li><li><div><span style="font-size: 9pt;">from PIL import Image</span></div></li><li><div><span style="font-size: 9pt;">image = Image.open(jpg)       获取图片</span></div></li><li><div><span style="font-size: 9pt;">text =</span> <span style="font-size: 9pt;">pytesseract</span><span style="font-size: 9pt;">.image_to_string(image, lang=</span><span style="font-size: 9pt; line-height: 13.6px;">'chi_sim'</span><span style="font-size: 9pt;">)       对图片的内容进行翻译</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">import subprocess</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">subprocess.call(['tessetact', '-1', 'chi_sim', filePath, 'paixu'])     使用终端命令进行翻译</span></div></li><li><div><span style="font-size: 9pt;"><span style="font-size: 9pt;">pytesseract</span>.file_to_text('image.png')       直接对图片进行识别</span></div></li></ul><li><div><span style="font-size: 11pt; font-weight: bold;">使用tesseract识别代码(包含图片处理)</span></div></li><ul><li><div><span style="font-size: 9pt;">import <span style="font-size: 9pt;">pytesseract</span></span></div></li><li><div><span style="font-size: 9pt;">from PIL import Image</span></div></li><li><div><span style="font-size: 9pt;">image = Image.open('code2.jpg')</span></div></li><li><div><span style="font-size: 9pt;"># 图片灰度化处理</span></div></li><li><div><span style="font-size: 9pt;">image = image.convert('L') </span></div></li><li><div><span style="font-size: 9pt;"># 图片二值化处理</span></div></li><li><div><span style="font-size: 9pt;">threshold = 127        设置二值化阈值      </span></div></li><li><div><span style="font-size: 9pt;">filter_func = lambda x: 0 if x &lt; threshold else 1</span></div></li><li><div><span style="font-size: 9pt;">image = image.point(</span><span style="font-size: 9pt;">filter_func</span><span style="font-size: 9pt;">, '1')</span></div></li><li><div><span style="font-size: 9pt;">image.show()</span></div></li><li><div><span style="font-size: 9pt;">result =</span> <span style="font-size: 9pt;">pytesseract</span><span style="font-size: 9pt;">.image_to_text(image)     对处理后的图片进行识别</span></div></li><li><div><span style="font-size: 9pt;">print(result)</span></div></li></ul><li><div><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">对tesseract进行训练</span></div></li><ul><li><div><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">训练的目的</span></span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">tesseract一般只能识别符合文字规范的字体，其他的稍微复杂的字很难识别，tesseract可以通过训练对一种格式字体的反复训练，来实现字体的高精度识别</span></div></li></ul><li><div><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">训练tesseract的方法</span></span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">要训练 Tesseract 识别一种文字，无论是晦涩难懂的字体还是验证码，你都需要向 Tesseract 提供每个字符不同形式的样本。</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">首先要收集大量的验证码样本，样本的数量和复杂程度，会决定训练的效果。第二步是准确地告诉 Tesseract 一张图片中的每个字符是什么，以及每个字符的具体位置。</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">这里需要创建一些矩形定位文件(box file)，一个验证码图片生成一个矩形定位文件，也可以通过jTessBoxEditor软件来修改矩形的定位。</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">一个图片的矩形定位文件如下所示:</span></div></li><ul><li><div><img src="/e_img/图片验证码-Tesseract破解_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="139"/></div></li></ul><li><div><span style="font-size: 9pt; line-height: 1.45;">第一列符号是图片中的每个字符，后面的 4 个数字分别是包围这个字符的最小矩形的坐标 (图片左下角是原点 (0，0)，4 个数字分别对应每个字符的左下角 x 坐标、左下角 y 坐标、右上角 x 坐标和右上角 y 坐标)，最后一个数字“0”表示图片样本的编号。</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">矩形定位文件必须保存在一个 .box 后缀的文本文件中，(例如 4MmC3.box)。</span></div></li></ul></ul><li><div><span style="font-size: 9pt; font-weight: bold;">tesseract训练教程</span></div></li><ul><li><div><a href="http://www.cnblogs.com/mjorcen/p/3800739.html?utm_source=tuicool&amp;utm_medium=referral" style="font-size: 9pt;">http://www.cnblogs.com/mjorcen/p/3800739.html?utm_source=tuicool&amp;utm_medium=referral</a></div></li></ul></ul></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html>