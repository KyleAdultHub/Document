---
title: Django-Model
date: "2016-10-01 22:00:00"
categories:
- Django
- Django五大模块
tags:
- Django
toc: true
---

<html>
<head>
  <title>Django-URL</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/307941 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="832"/>
<h1>Django-URL</h1>

<div>
<span><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">Django的路由U</span></font></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">路由的简介</span></font></li><ul><li><span style="font-size: 9pt;">浏览者通过在浏览器的地址栏中将要访问的网站地址(URL格式)，当Django网站所在服务器接到请求后，用户发起的请求具体由Django的views视图文件的哪一个函数进行处理请求，是根据路由系统配置的，也就是说由urls.py文件中的关键字匹配规则指定的。也就是说Django的路由系统主要是一个&quot;路标&quot;的作用</span><span style="font-size: 9pt; line-height: 1.45;">你想往哪走，只要有路，那么你就往哪走</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">配置路由</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-weight: bold; line-height: 13.600000381469727px;">配置setting文件</span></font></li><ul><li><font style="font-size: 9pt;">ROOT_URLCONF = 'book_project.urls'    在setting文件中添加</font></li><ul><li><font style="font-size: 9pt;">意思代表项目的路由文件在项目目录下book_project目录下的urls.py中</font></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-weight: bold; line-height: 13.600000381469727px;">配置项目url文件</span></font></li><ul><li><font style="font-size: 9pt;"><img src="Django-URL_files/Image.png" type="image/png" data-filename="Image.png" width="318"/></font></li><ul><li><font style="font-size: 9pt;">备注：</font></li><ul><li><font style="font-size: 9pt;">url对象（）里面的参数：第一个为匹配url的规则，第二个是匹配成功执行的函数或方法</font></li><li><font style="font-size: 9pt;">只要url中有admin/关键字，那么所有请求都交给<span style="line-height: 1.45;">/data/virtual/py_django/lib/python3.5/site-packages/django/contrib/admin/s</span><span style="line-height: 1.45;">ite.py 文件中的urls进行处理</span></font></li><li><font style="font-size: 9pt;">Django进行import的时候默认有两种方式，首先会在项目的根目录下进行寻找，如果根目录下没有找到对应的文件，会去虚拟环境的目录下/lib/python3.5/site-packages/里面进行寻找</font></li></ul></ul></ul></ul></ul><div><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">url对象的结构</span></span></font></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">urlpatterns变量</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">记录了所有的url对象，保存了项目的所有路由，相当于一个路由表的功能，在url的文件中写法固定，记住就好；</span></font></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">url配置的基本的语法  </span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">url的导入</span></font></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">应用场景</font></span></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">在根url中设置比较模糊的匹配规则，将具体的判断交给应用中的url文件进行进一步匹配，一般会将首页的匹配规则等用根url来配置</span></font></li><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">在应用的设置精确匹配的集合，根据请求url的路径，交给对应的view函数进行处理；</font></span></li></ul><li><font style="font-size: 9pt;">导入url，include函数</font></li><ul><li><font style="font-size: 9pt;">from django.conf.urls import include, url</font></li></ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">导入传递模块和view函数</font></span></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">在根url中导入传递模块</font></span></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">示例：</span><span style="line-height: 13.600000381469727px;">from django.contrib import admin</span></font></li></ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">在应用目录下的url模块中导入view函数</font></span></li><ul><li><font style="font-size: 9pt;">from .views import *</font></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">注意：在django中只能使用绝对路径的方式来导入模块，所以当在应用url中导入view函数的时候可以使用from  .views import * 的形式对函数进行导入（在from  import语法中  . 代表当前目录  ..代表上层目录   也可以写全，这只是省略的写法）</font></span></li></ul></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">url配置导入的两种语法结构</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">第一种语法结构(</span><span style="font-size: 9pt; color: rgb(255, 70, 53); line-height: 13.600000381469727px;">一般应用在根url文件中</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">)</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">格式：</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">url(正则,include(应用名.urls))</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">对请求url进行正则匹配，如果符合规则则执行include函数中的第一个参数定义的函数或方法</span></li><li><span style="font-size: 9pt;">如果导入的是一个文件，需要在include的内容两侧加上单引号</span></li><li><span style="font-size: 9pt;">如果导入的是一个函数或者方法，则不需要在include的内容外侧加上单引号</span></li><li><span style="font-size: 9pt; line-height: 1.45;">这个地方的正则一般使用r '^....', 一般不写$,一般不会对完整的url做匹配，详细的匹配会交给应用的url来进行匹配</span></li><li><span style="font-size: 9pt;"><span style="font-size: 9pt; color: rgb(255, 70, 53);">这种语法一般用于Django项目的根urls.py文件中</span></span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例：</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">在根目录的url文件中设置</span></li><ul><li><span style="font-size: 9pt;"><img src="Django-URL_files/Image [1].png" type="image/png" data-filename="Image.png" width="251"/></span></li></ul></ul></ul><li><span style="font-size: 9pt;">第二种语法结构（</span><span style="font-size: 9pt; color: rgb(255, 70, 53);">一般应用在应用目录下的url文件中</span><span style="font-size: 9pt;">）</span></li><ul><li><span style="font-size: 9pt;">格式：</span></li><ul><li><span style="font-size: 9pt;">url(正则,视图函数名称)</span></li><ul><li><span style="font-size: 9pt;">这个地方是真正定义请求地址和views文件函数的对应关系，此处用到的是精确匹配，正则格式必须是</span><span style="font-size: 9pt; line-height: 1.45;">r'^...$'（定义开头和结尾）</span></li><li><span style="font-size: 9pt; line-height: 1.45;">视图函数名称不需要加引号，直接写就可以了</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例：</span></li><ul><li><span style="font-size: 9pt;"><img src="Django-URL_files/Image [2].png" type="image/png" data-filename="Image.png" width="231"/></span></li></ul></ul></ul></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 1.45;-evernote-highlight:true;">url分组与参数传递</span></font></span></div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">url的分组方式</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">第一种（普通分组）</span></font></li><ul><li><span style="line-height: 1.45;"><font style="font-size: 9pt;">应用场景</font></span></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">当需要获取url中匹配出来的部分内容，且按顺序取出其中的内容，这时候应用该种分组方式</font></span></li></ul><li><span style="line-height: 1.45;"><font style="font-size: 9pt;">语法：</font></span></li><ul><li><span style="line-height: 1.45;"><font style="font-size: 9pt;">url(r'^renwu(\d+)', renwu)</font></span></li><ul><li><span style="line-height: 1.45;"><font style="font-size: 9pt;">（\d+）的匹配结果就会传递给renwu函数，被renwu函数的第二个形参接收</font></span></li></ul></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">第二种（关键字分组）</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">应用场景</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">当需要获取url中匹配出来的部分内容，想要根据分组名称获取内容的时候，这时候就应用该种分组方式</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">语法：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">url(r'^(?P&lt;value1&gt;\d+)/$', renwu)</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">\d+匹配的内容，将通过命名参数的形式传递给view的renwu函数，在函数中可以不按照顺序接收，只需要通过分组名来接收即可；</span></li></ul></ul></ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">注意：</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">两种分组方式在一个匹配规则中只能用一种，不能混用</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">url的参数传递</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">位置参数传递</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">用法：</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">当使用上方第一种分组方法的时候，可以按照分组的顺去将参数传递给view方法，view方法可以从第二个形参开始接收url对象传递过来的参数</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">关键字参数</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">用法：</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">当使用上方第二种分组方法的时候，可以按照分组的名称通过命名参数的形式传递给view方法，view方法可以通过形参与关键字分组名对应来接收对应分组的参数；</span></li></ul></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 12pt;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">在url函数中使用匹配时候需要注意点</span></font></span></div><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">在匹配的时候尽量使用r' 匹配规则 '  来进行匹配，将字符串中的\进行转义</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">注意：   r '  ' 只能配合单引号进行使用</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">url获取的url是不包括域名 端口和 参数的</span></font></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">在匹配规则中的，尽量把匹配规则的开头和结尾协成这种形式：r'^</span><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">index/$'</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">一般浏览器会在url结尾加上一个/      </span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">url对象会默认将url地址的第一个/去掉，所有如果我们自己也在前边加上一个/,匹配规则会是匹配以//开始的路径</span></li></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">url的反向解析</span></font></span></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">什么是反向解析</span></font></li><ul><li><span style="font-size: 9pt;">随着我们项目的功能的越来越多，</span><span style="font-size: 9pt; line-height: 1.45;">这个时候可能发现之前配置的正则表达式在有些情况下可能不够准确，于是就要修改原来的正则表达式规则。</span><span style="font-size: 9pt; line-height: 1.45;">但是正则表达式一旦修改了，之前所有对应的模板中的请求（比如a标签中的地址）和</span><span style="font-size: 9pt; line-height: 1.45;">请求处理函数（重定向）都要修改，这可是一件麻烦的事情，甚至可能出现意外的</span><span style="font-size: 9pt; line-height: 1.45;">问题，那么解决这个问题的办法就是反向解析</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">使用反向解析的优点</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">可以减少因为需要在模板中和函数中修改请求url而产生错误的可能</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">可以根据正则的表达式动态生成url地址，减轻后期的维护成本</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">反向解析使用的场景</span></font></li><ul><li><span style="font-size: 9pt;">反向解析应用在两个地方：模板中的超链接，视图中的重定向</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">反向解析的使用方法</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">为url定义name属性，当url请求是其属性时会自动生成符合匹配的url地址</span></font></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">定义根url属性：在根url<span style="line-height: 13.600000381469727px;">的include的时候定义include的namespace属性</span></span></font></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">格式：<span style="line-height: 13.600000381469727px;">url(r'^',include('book_app.urls',namespace= '</span><span style="line-height: 13.600000381469727px;">namespace_value'</span><span style="line-height: 13.600000381469727px;">))</span></span></font></li></ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">定义应用目录下url属性：给url一个name属性</font></span></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">格式： <span style="line-height: 13.600000381469727px;">url(r'^book_change/$', book,name='name_value')</span></span></font></li></ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">作用：</font></span></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px;">这样设置后，当请求url是带有和</span><span style="line-height: 13.600000381469727px;">namespace和name的value值相等属性的</span><span style="line-height: 13.600000381469727px;">时候，便可以根据正则匹配动态生成刚好符合匹配规则的url</span></font></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">在模板中使用url标签</span></font></li><ul><li><span style="font-size: 9pt;">格式：{%url 'namespace_value : name_value '%}</span></li><ul><li><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.600000381469727px;">生成的url前半部分会符合带有namespace属性的url对象中的匹配规则</span></font></li><li><span style="font-size: 12px; line-height: 13.600000381469727px;">生成的url后半部分会符合带有name属性的url对象中的匹配规则</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">在视图中使用reverse函数</span></font></li><ul><li><span style="font-size: 9pt;">格式：redirect(reverse('namespace_value:name_value'))</span></li><ul><li><span style="font-size: 9pt;">需要先导入reverse函数 ：from django.core.urlresolvers import reverse</span></li><li><span style="font-size: 12px; line-height: 13.600000381469727px;">生成的url前半部分会符合带有namespace属性的url对象中的匹配规则</span></li><li><span style="font-size: 12px; line-height: 13.600000381469727px;">生成的url后半部分会符合带有name属性的url对象中的匹配规则</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">反向解析实践</span></font></li><ul><li><span style="font-size: 9pt;"><img src="Django-URL_files/Image [3].png" type="image/png" data-filename="Image.png" width="322"/></span></li><li><span style="font-size: 9pt;"><img src="Django-URL_files/Image [4].png" type="image/png" data-filename="Image.png" width="384"/></span></li><li><span style="font-size: 9pt;"><img src="Django-URL_files/Image [5].png" type="image/png" data-filename="Image.png" width="401"/></span></li><ul><li><span style="font-size: 9pt;">可以看到由反向解析实现了{%url 'booktest:book '%} 标签的动态生成，生成刚好可以匹配url匹配规则的rul然后拼接成/book_change/</span></li></ul></ul><li><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">反向解析的传参</span></font></li><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">使用场景</span></font></li><ul><li><span style="font-size: 9pt;">当url的匹配规则中存在分组且其中存在转移字符的时候（例如\d+）的时候，这时候动态url将不能自动生成，要解决这种情况就需要向url中传递参数，将参数填在分组中，生成符合规则的url ，一般只会在应用下面的url中使用</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">传参格式</span></font></li><ul><li><span style="font-weight: bold; line-height: 15.199999809265137px;">url文件中的匹配格式</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">传递位置参数</span></font></li><ul><li><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.600000381469727px;">在url文件中的url对象</span></font></li><ul><li><span style="font-size: 9pt;">url(r'^....(\d+).....(\d+)/$', view函数 ,name='name_value')</span></li></ul><li><span style="font-size: 9pt;">在模板中传参格式：</span></li><ul><li><span style="font-size: 9pt;">{%url ' namespace_value : name_value ' 参数1 参数2%}</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">在视图中传参格式：  </span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">redirect(reverse('</span> <span style="font-size: 9pt; line-height: 13.600000381469727px;">namespace_value</span><span style="font-size: 9pt; line-height: 13.600000381469727px;"> :</span> <span style="font-size: 9pt; line-height: 13.600000381469727px;">name_value</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">  ', args=(参数1,参数2)))f</span></li><ul><li><span style="font-size: 9pt;">需要先导入reverse函数 ：from django.core.urlresolvers import reverse</span></li></ul></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">传递关键字参数</span></font></li><ul><li><span style="font-size: 12px; line-height: 13.600000381469727px;">在url文件中的url对象</span></li><ul><li><span style="font-size: 9pt;">url(r'^....(?P&lt;组名1&gt;\d+)_(?P&lt;组名2&gt;\d+....)/$', view函数,name='name_value')</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">在模板中传参格式</span></li><ul><li><span style="font-size: 9pt;">{%url </span><span style="font-size: 9pt;">'namespace_value : name_value '</span><span style="font-size: 9pt;"> 组名1=参数1 组名2=参数2 %}</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">在视图中传参格式：  </span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">redirect(reverse(</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">'namespace_value : name_value '</span><span style="font-size: 9pt; line-height: 13.600000381469727px;"> , kwargs=( '组名1' : 参数1 , '组名2' : 参数2)）)</span></li><ul><li><span style="font-size: 9pt;">需要先导入reverse函数 ：from django.core.urlresolvers import reverse</span></li></ul></ul></ul></ul></ul></ul></div><div><br/></div></span>
</div></body></html> 