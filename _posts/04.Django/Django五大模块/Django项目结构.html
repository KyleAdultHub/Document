---
title: Django-项目结构
date: "2016-10-04 22:00:00"
categories:
- Django
- Django五大模块
tags:
- Django
toc: true
---

<html>
<body>
<div>
<span><div><font style="background-color: rgb(255, 250, 165);font-size: 14pt;-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">Django项目相关命令操作</span></font></div><div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">创建项目专用目录</span></font></div></li><ul><li><div><span style="font-size: 9pt;">mkdir /data/server</span></div></li><li><div><span style="font-size: 9pt;">cd /data/server/</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">创建DJango项目</span></font></div></li><ul><li><div><span style="font-size: 9pt;">django-admin startproject 项目名称</span></div></li><li><div><span style="font-size: 9pt;">django-admin startproject itcast</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">项目操作相关命令</span></font></div></li><ul><li><div><span style="font-size: 9pt;">命令格式：python manage.py</span> <span style="font-size: 9pt; font-weight: bold;">命令</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">常用命令（一定要再项目目录中执行）</span></div></li><ul><li><div><span style="font-size: 9pt;">startapp       创建项目应用</span></div></li><li><div><span style="font-size: 9pt;">makemigrations       生成迁移文件</span></div></li><li><div><span style="font-size: 9pt;">migrate       执行迁移</span></div></li><li><div><span style="font-size: 9pt;">shell       shell命令窗口</span></div></li><ul><li><div><span style="font-size: 9pt;">shell和python的区别：</span></div></li><ul><li><div><span style="font-size: 9pt;">启动python命令解释器两种方式：</span><span style="font-size: 9pt; line-height: 1.45;">python manage.py shell 和 python</span></div></li><li><div><span style="font-size: 9pt;">但是manage.py shell特点是：在启动解释器时候，使用当前Django项目的配置文件，可以直接使用当前项</span><span style="font-size: 9pt; line-height: 1.45;">目的所有环境变量等信息。</span><span style="font-size: 9pt; line-height: 1.45;">而python命令没有这种功能（当然也可以手动配置虚拟化环境所在的根目录下的.bash_profile文件，添加DJANGO_SETTING_MODULE这个变量）</span></div></li></ul></ul><li><div><span style="font-size: 9pt;">runserver       启动django服务</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">启动项目的四种方式</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">1、python manage.py runserver         直接启动 ，浏览器访问地址：127.0.0.1:8000，只能在虚拟机中的浏览器中查看</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">2、python  manage.py  runserver  端口号       指定端口启动   </span><span style="font-size: 9pt; line-height: 13.6px;">浏览器访问地址：127.0.0.1:指定端口号，<span style="font-size: 9pt; line-height: 13.6px;">只能在虚拟机中的浏览器中查看</span></span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">3、python manage.py runserver 服务器地址:监听端口号     指定ip和端口启动      只有启动方式三，才能在虚拟机的外侧可以访问得到，但是如果指定的ip地址是0.0.0.0的话，本地和外部网络都可以访问的到</span><span style="font-size: 9pt; line-height: 1.45;">，用于部署服务器。</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">ip地址只能填写本机的ip地址</span></font></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">4、python manage.py runserver &gt;&gt; /dev/null 2&gt;&amp;1 &amp;        脚本启动</span></div></li></ul></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">test  (app名称)     执行应用中的test文件</span></div></li></ul></ul></ul></ul></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">Django项目简单案例介绍</span></font></span></div><div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">案例分析</span></font></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image.png" type="image/png" data-filename="Image.png" width="397"/></span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">项目需求分析</span></font></div></li><ul><li><div><span style="font-size: 9pt;">1、既然是一个Django项目，那么必须部署一个完整的Django项目开发环境，</span></div></li><li><div><span style="font-size: 9pt;">2、该项目有具体的应用，</span></div></li><ul><li><div><span style="font-size: 9pt;">所以必须有项目和应用相关的操作</span></div></li><li><div><span style="font-size: 9pt;">项目名称：book_project</span></div></li><li><div><span style="font-size: 9pt;">应用名称：book_app</span></div></li></ul><li><div><span style="font-size: 9pt;">3、三个展示网页的调用，</span><span style="font-size: 9pt; line-height: 1.45;">必须有足够的数据逻辑处理(网页跳转</span><span style="font-size: 9pt; line-height: 1.45;">必须根据产品设计，自己开发模板文件格式）</span></div></li><ul><li><div><span style="font-size: 9pt;">首页：index.html</span></div></li><li><div><span style="font-size: 9pt;">图书页：book.html</span></div></li><li><div><span style="font-size: 9pt;">人物页：hero.html</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;"> 项目方案</span></font></div></li><ul><li><div><span style="font-size: 9pt;">1、环境部署部分</span></div></li><ul><li><div><span style="font-size: 9pt;">1.1 python虚拟环境部署</span></div></li><li><div><span style="font-size: 9pt;">1.2 django环境部署</span></div></li><li><div><span style="font-size: 9pt;">1.3 开发环境部署</span></div></li></ul><li><div><span style="font-size: 9pt;">2、项目和应用部分配置</span></div></li><ul><li><div><span style="font-size: 9pt;">2.1 项目的基本操作</span></div></li><li><div><span style="font-size: 9pt;">2.2 应用的基本操作</span></div></li><li><div><span style="font-size: 9pt;">2.3模板目录的配置</span></div></li></ul><li><div><span style="font-size: 9pt;">3、访问流程部分</span></div></li><ul><li><div><span style="font-size: 12px; font-weight: bold; line-height: 13.6px;">       数据库的配置和数据的获取后面的M实例再进行完善</span></div></li><li><div><span style="font-size: 9pt;">3.2 web网页模板开发</span></div></li><li><div><span style="font-size: 9pt;">3.3 数据获取与逻辑处理</span></div></li><li><div><span style="font-size: 9pt;">3.4 路由配置</span></div></li></ul><li><div><span style="font-size: 9pt;">4、整体调试</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">项目方案的实施（VT的设计）</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">1、环境部署---省略</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">2、项目应用部分配置</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">2.1项目基本操作</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">创建项目</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">cd  /data/server</span></div></li><li><div><span style="font-size: 9pt;">django-admin startproject book_project</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">创建出来项目初始的结构：</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [1].png" type="image/png" data-filename="Image.png" width="135"/></span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">manage.py</span><span style="text-indent: 21pt; font-size: 9pt;">是项目管理文件，通过它管理项目。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">itcast</span><span style="text-indent: 21pt; font-size: 9pt;">与项目同名的目录，存放项目的所有基础文件。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">_init_.py</span><span style="text-indent: 21pt; font-size: 9pt;">是一个空文件，作用是这个目录</span><span style="text-indent: 21pt; font-size: 9pt;">test1</span><span style="text-indent: 21pt; font-size: 9pt;">可以被当作包使用。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">settings.py</span><span style="text-indent: 21pt; font-size: 9pt;">是项目的整体配置文件。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">urls.py</span><span style="text-indent: 21pt; font-size: 9pt;">是项目的</span><span style="text-indent: 21pt; font-size: 9pt;">URL</span><span style="text-indent: 21pt; font-size: 9pt;">配置文件。</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">wsgi.py</span><span style="text-indent: 21pt; font-size: 9pt;">是项目与</span><span style="text-indent: 21pt; font-size: 9pt;">WSGI</span><span style="text-indent: 21pt; font-size: 9pt;">兼容的</span><span style="text-indent: 21pt; font-size: 9pt;">Web</span><span style="text-indent: 21pt; font-size: 9pt;">服务器入口，详细内容会在布署中讲到。</span></font></div></li></ul></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">2.2应用基本操作</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">创建应用</span></div></li><ul><li><div><span style="font-size: 9pt;">python manage.py startapp </span><span style="font-size: 9pt; line-height: 13.6px;">book_app</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">应用起名为book_app</span></font></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">配置应用</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [2].png" type="image/png" data-filename="Image.png" width="204"/></span></div></li><ul><li><div><span style="font-size: 9pt;">在django项目的配置文件settings.py中有应用注册的一项配置：INSTALLED_APPS,想要创建的应用生效，需要在其中添加应用的名称；</span></div></li></ul></ul></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">2.3模板目录的创建与配置</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">创建Templates</span></div></li><ul><li><div><span style="line-height: 1.45; font-size: 9pt;">cd /data/server/book_project/</span></div></li><li><div><span style="line-height: 1.45; font-size: 9pt;">mkdir templates</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">配置</span><span style="font-size: 9pt; line-height: 13.6px;">Templates</span></font></div></li><ul><li><div><img src="/e_img/Django项目结构_files/Image [3].png" type="image/png" data-filename="Image.png" style="line-height: 1.45;" width="367"/></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">在django项目的模板配置信息在settings.py文件中的TEMPLATES部分中。配置一条：'DIRS': [os.path.join(BASE_DIR, 'templates')],</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">BASE_DIR为项目目录，temlates指的是目录中的temlates的文件夹</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">配置后当访问模板文件的时候会直接在project/temlates目录下进行寻找</span></div></li></ul></ul></ul></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">3、访问流程部分</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">3.2首页模板开发</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">在templates中创建和应用同名的目录</span></div></li><ul><li><div><span style="font-size: 9pt;">cd /data/server/book_project/templates</span></div></li><li><div><span style="font-size: 9pt;">mkdir book_app</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">避免后期每个应用的前端代码过多，产生混乱</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">创建首页模板并编辑</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">index.html</span></div></li></ul></ul><li><div><span style="font-size: 9pt;">3.3创建网页处理逻辑</span></div></li><ul><li><div><span style="font-size: 9pt;">vim /data/server/book_project/book_app/views.py</span></div></li><li><div><span style="font-size: 9pt;">def index(request):</span></div></li><ul><li><div><span style="font-size: 9pt;"># 接收到请求后，返回的内容就是 book_app/index.html</span></div></li><li><div><span style="font-size: 9pt;">return render(request,'book_app/index.html'）</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义收到请求后返回的页面</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">3.4路由设计</span></div></li><ul><li><div><span style="font-size: 9pt;">urlpatterns = [</span></div></li><li><div><span style="font-size: 9pt;">url(r'^admin/', include(admin.site.urls)),</span></div></li><li><div><span style="font-size: 9pt;"># 如果请求的 url 是 127.0.0.1:8000 ，那么就交给 views 文件的 index 函数去处理</span></div></li><li><div><span style="font-size: 9pt;">url(r'^$', index),</span></div></li><li><div><span style="font-size: 9pt;">]</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">说明：</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">设置urls.py文件的urlpatterns配置，增加匹配url的规则磨合匹配后的请求跳转路径，</span><span style="font-size: 9pt; line-height: 1.45;">url(r'^admin/', include(admin.site.urls))</span><span style="font-size: 9pt; line-height: 13.6px;">是匹配规则</span><span style="font-size: 9pt; line-height: 1.45;">,admin就是一个关键字，经过url的配置，那么就将该请求交给admin.site.urls这个文件</span><span style="font-size: 9pt; line-height: 1.45;">处理</span></font></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">注意：</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">这里的admin后面必须加/，当url的端口后面不为空的时候，浏览器一般会默认在文件的最后边加上/，如果匹配的时候后边有$，如果没有/将不能匹配搭配内容；</span></div></li></ul></ul></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">4、测试 --  最基本的思路应完成</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">后面需要再完善图书和任务的模板，通过视图函数将模板进行渲染</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">访问流程图（没有M的功能）</span></font></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [4].png" type="image/png" data-filename="Image.png" width="578"/></span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">设计Model模型类（完成MVT的设计）</span></font></div></li></ul></div><div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">目标</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">所以我们需要在模板中完成一个&quot;车票&quot;的功能，让从数据库获取的数据在模板中进行填充（完成上面没有实现的数据获取的功能）。</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">设计过程的方案</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">1、数据库的配置</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">2、model文件中数据模型的设计</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">3、数据的获取方法</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">4、模板文件填充数据</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">5、逻辑升级</span></div></li></ul><li><div><font style="font-size: 12px;"><span style="font-size: 12px; font-weight: bold; line-height: 13.6px;">方案的实施</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">1.数据库配置</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">安装数据库</span></div></li><ul><li><div><span style="font-size: 9pt;">apt-get install mysql-server -y</span></div></li></ul><li><div><span style="font-size: 9pt;">配置数据库服务器端的字符编码（数据库传输出来的编码类型）</span></div></li><ul><li><div><span style="font-size: 9pt;">vim /etc/mysql/mysql.conf.d/mysqld.cnf</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">编辑上面文件，在[mysqld]的下面添加一条配置character-set-server=utf8即可，这样数据库输出的汉字不会是乱码</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">重启数据库</span></div></li><ul><li><div><span style="font-size: 9pt;">/etc/init.d/mysql restart</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">验证编码设置是否成功</span></div></li><ul><li><div><span style="font-size: 9pt;">show variables like '%char%ser%';  在数据库中操作</span></div></li><ul><li><div><span style="line-height: 13.6px;">variables 数据库的配置属性设置</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">安装DJANGO和mysql通讯的工具</span></font></div></li><ul><li><div><span style="font-size: 9pt;">pip install pymysql</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">编辑Django项目的配置文件settings.py文件</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [5].png" type="image/png" data-filename="Image.png" width="354"/></span></div></li><li><div><span style="font-size: 9pt;">select User,Host from user;   可以在数据库中提前获取主机名和用户名；</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">在py_django/lib/python3.5/site-packages/django/db/ba</span><span style="font-size: 9pt; line-height: 1.45;">ckends/   里面存储了所有的django支持的数据库，django支持7中关系型的数据库</span></font></div></li></ul><li><div><span style="font-size: 9pt;">编辑Django项目的__init__.py文件，在里面增加两行配置</span></div></li><ul><li><div><span style="font-size: 9pt;">import pymysql</span></div></li><li><div><span style="font-size: 9pt;">pymysql.install_as_MySQLdb()</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">如果不加上这两行配置会在进入 python manage.py shell  解释环境的时候报错</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">将pymasql转义成MySqldb，因为django默认是启动MySqldb与mysql通讯得，而py3又不支持MySqldb所以只能设置一下了</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">最后创建数据库</span></font></div></li><ul><li><div><span style="font-size: 9pt;">create database itcastdb charset=utf8;</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">2.Model模型的设计</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">model模型分析</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">Model模型的功能</span></div></li><ul><li><div><span style="font-size: 9pt;">1、设计数据库表</span></div></li><li><div><span style="font-size: 9pt;">2、进行数据库的操作(生成迁移、执行迁移、向数据库表中插入数据)</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">数据库表设计（在应用下的model文件里面设计）</span></div></li><ul><li><div><span style="font-size: 9pt;">from django.db import models</span></div></li></ul></ul></ul></ul></div><div><ul><ul><ul><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">class BookInfo(models.Model):</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">btitle = models.CharField(max_length=20)#图书名称</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">bpub_date = models.DateField()#发布日期</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">bread = models.IntegerField(default=0)#阅读量</span></div></li><li><div><span style="line-height: 1.45; font-size: 9pt;">bcomment = models.IntegerField(default=0)#评论量</span></div></li><li><div><span style="line-height: 1.45; font-size: 9pt;">isDelete = models.BooleanField(default=False)#逻辑删除</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">创建的类对应数据库的表，类属性对应数据库表相应的字段</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">生成的数据库表的名字为:   应用名_类名   （全部会换成小写）</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">创建出来的表会默认增加一个逐渐字段</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">生成迁移文件</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">python manage.py makemigrations</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">这个命令的主要意义就是生成了一个迁移文件，这个生成的文件在哪里？</span><span style="font-size: 9pt; line-height: 1.45;">在 book_app/migrations 这个目录里面，文件的名称是 0001_initial.py</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">执行迁移文件</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">python manage.py migrate</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">执行完迁移文件，才相当于创建完成了数据库表格</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">记住，任何修改models文件都需要重新生成迁移文件并执行一次迁移</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">如果只对字段名称和一些约束进行修改，可能会迁移失败，因为生成的迁移文件和数据库中已经完成迁移的内容重复，这个时候不能再次执行迁移</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">解决办法：</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">1.删除掉数据库中的迁移文件相关的表</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">2.修改生成新的迁移文件的名称</span></div></li></ul></ul></ul><li><div><span style="font-size: 12px; color: rgb(255, 0, 0); line-height: 13.6px;">备注：</span><span style="color: rgb(255, 0, 0); line-height: 13.6px; font-size: 9pt;">如果执行迁移成功，但是没有成功修改或者创建表单（获取迁移文件对应的sql语句）</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">python manage.py sqlmigrate  应用名  迁移文件名（不包含后缀）</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">查看迁移文件对应的sql语句在数据库中手动更改</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">向数据库中插入数据</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">3.数据获取</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">修改model返回的数据（由对象改为字符串）</span></font></div></li><ul><li><div><span style="font-size: 9pt;">class BookInfo(models.Model):</span></div></li><ul><li><div><span style="font-size: 9pt;">btitle = models.CharField(max_length=20)#图书名称</span></div></li><li><div><span style="font-size: 9pt;">bpub_date = models.DateField()#发布日期</span></div></li><li><div><span style="font-size: 9pt;">bread = models.IntegerField(default=0)#阅读量</span></div></li><li><div><span style="font-size: 9pt;">bcomment = models.IntegerField(default=0)#评论量</span></div></li><li><div><span style="font-size: 9pt;">isDelete = models.BooleanField(default=False)#逻辑删除</span></div></li><li><div><span style="font-size: 9pt;">def __str__(self):             新增__str__方法</span></div></li><ul><li><div><span style="font-size: 9pt;">return self.btitle</span></div></li><ul><li><div><span style="font-size: 9pt;">注意：</span></div></li><li><div><span style="font-size: 9pt;">在这里里面我们只是重写了一个私有类方法，__str__，他的作用就是将返回的结果转换成字符串，只是将通过过滤器获取的对象结果的显示为定义返回的内容，实质上过滤器获取到的还是对象；</span></div></li></ul></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">确定获取数据的方法</span></div></li><ul><li><div><span style="font-size: 9pt;">from book_app.models import *     导入models的类对象</span></div></li><li><div><span style="font-size: 9pt;">BookInfo.objects.all()     获取所有图书的对象</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;"><span style="font-size: 9pt; line-height: 1.45;">返回结果是一个列表，包含所有图书的对象</span>        </span></font></div></li><li><div><span style="font-size: 9pt;">objects 是Django的 models模型类中定义的一个默认的对象管理器</span></div></li><li><div><span style="font-size: 9pt;">all(),是一个方法，作用就是获取类对象的数据库表中的所有数据</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">通过重写__str__方法可以修改all()等过滤器方法获得的内容</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">4.图书模板升级</span></font></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [6].png" type="image/png" data-filename="Image.png" width="542"/></span></div></li><li><div><span style="font-size: 9pt;">网页的title我们使用 Tem_title来代替，格式就是 {{Tem_title}}</span></div></li><li><div><span style="font-size: 9pt;">获取的所有图书信息，我们使用Tem_booklist来代替，那么我们来遍历这个变量获取具体的图书信息：</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">网页需要逻辑view传递过来两个参数，模板中的标签会代替view传递过来的参数</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">通过遍历数据标签，将每个其中每个值都输出来；</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">{{</span><span style="text-indent: 21pt; font-size: 9pt;">变量名标签</span><span style="text-indent: 21pt; font-size: 9pt;">}}的作用：</span></font></div></li><ul><li><div><span style="text-indent: 21pt;"><span style="font-size: 9pt;">从view视图中获取的数据，通过标签变量名的方式，传递到模板文件中</span></span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">5.图书逻辑升级</span></font></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [7].png" type="image/png" data-filename="Image.png" width="527"/></span></div></li><li><div><font style="font-size: 9pt;"><span style="text-indent: 21pt; font-size: 9pt;">render(</span><span style="text-indent: 21pt; font-size: 9pt;">请求</span><span style="text-indent: 21pt; font-size: 9pt;">,'</span><span style="text-indent: 21pt; font-size: 9pt;">文件</span><span style="text-indent: 21pt; font-size: 9pt;">',</span><span style="text-indent: 21pt; font-size: 9pt;">内容</span><span style="text-indent: 21pt; font-size: 9pt;">)，render可以通过第三个参数，把数据传递给模板文件</span></font></div></li><li><div><span style="font-size: 9pt;">将需要遍历的列表 ，和模板的title两个参数放到列表中在rendert函数第三个参数中一起返回</span></div></li><li><div><span style="font-size: 9pt;">注意：因为Django的默认工作目录是在project目录，而models是在当前目录，所以导入models文件的时候，需要在models前面加上一个. ，代表当前目录，代表book_app .models</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">整个访问流程梳理</span></font></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;"><img src="/e_img/Django项目结构_files/Image [8].png" type="image/png" data-filename="Image.png" width="561"/></span></font></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">完善人物信息的设计（M部分的完善）</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">需求：</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">人物页面中的数据从数据库中获取，人物信息和书进行关联，通过点击书名，可以获取对应包括的人物</span></font></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">设计过程分析：</span></font></div></li><ul><li><div><span style="font-size: 9pt;">1、数据模型文件的配置</span></div></li><li><div><span style="font-size: 9pt;">2、指定数据的获取需要数据</span></div></li><li><div><span style="font-size: 9pt;">3、模板文件填充数据</span></div></li><li><div><span style="font-size: 9pt;">4、逻辑升级</span></div></li><li><div><span style="font-size: 9pt;">5、路由系统跳转的配置</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">1.数据模型文件的配置</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">人物的数据库表设计</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [9].png" type="image/png" data-filename="Image.png" width="441"/></span></div></li><li><div><span style="font-size: 9pt;">需要注意：</span></div></li><ul><li><div><span style="font-size: 9pt;">1.进行外键的设置，要将一个字段设置为书名的外键，可以根据书对应的id来取出所有对应书id的英雄对象；</span></div></li><li><div><span style="font-size: 9pt;">2.要重写__str__方法</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 1.45;">生成迁移文件</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">执行迁移</span></div></li><li><div><span style="font-size: 9pt;">向数据库中添加数据</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">2.确定数据的获取方法 和需要的数据</span></font></div></li><ul><li><div><span style="font-size: 9pt;">需求：需要获取书对应的所有人物</span></div></li><li><div><span style="font-size: 9pt;">完成方法：</span></div></li><ul><li><div><span style="font-size: 9pt;">定义一个指定id的图书对象</span></div></li><li><div><span style="font-size: 9pt;">使用关联格式方法获取指定图书对象所关联的所有人物信息</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">示例：</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;"><img src="/e_img/Django项目结构_files/Image [10].png" type="image/png" data-filename="Image.png" width="289"/></span></font></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [11].png" type="image/png" data-filename="Image.png"/></span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">3.人物模板升级</span></font></div></li><ul><li><div><span style="font-size: 9pt;">需求：</span></div></li><ul><li><div><span style="font-size: 9pt;">页面的title要更换</span></div></li><li><div><span style="font-size: 9pt;">图书的人物要更换，同时要注明该人物是属于哪本图书</span></div></li><li><div><span style="font-size: 9pt;">增加一个超链接，直接返回上一级，方便我们好再次查看效果</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">示例：<img src="/e_img/Django项目结构_files/Image [12].png" type="image/png" data-filename="Image.png" width="467"/></span></font></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">4.人物逻辑升级</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">需求：</span></div></li><ul><li><div><span style="font-size: 9pt;">获取图书数据</span></div></li><ul><li><div><span style="font-size: 9pt;">book = BookInfo.objects.get(id=1)</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">id 通过url传递给view</span></div></li></ul></ul><li><div><span style="font-size: 9pt;">获取人物数据</span></div></li><ul><li><div><span style="font-size: 9pt;">herolist = book.heroinfo_set.all()</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">通过数据关联来获取任务数据、</span></div></li></ul></ul><li><div><span style="font-size: 9pt;">指定模板，添加数据</span></div></li><ul><li><div><span style="font-size: 9pt;">context = {'Tem_title':'英雄信息', 'Tem_book':book, 'Tem_herolist':herolist}</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将上下文变量存储在字典中，传递给模板文件；</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">示例：</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Django项目结构_files/Image [13].png" type="image/png" data-filename="Image.png" width="475"/></span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">5.路由系统配置</span></font></div></li><ul><li><div><span style="font-size: 9pt;">url(r'^renwu(\d+)/$', renwu),</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">可以将(\d+)中的内容传递给view，逻辑函数可以根据传递过来的数值，来判断是要获取哪本书的对象，就能根据获取书的对象，来获取人物的对象； </span></div></li></ul></ul></ul></ul></ul><div><font style="background-color: rgb(255, 250, 165);font-size: 12pt;-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 12pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">开发流程总结</span></font></div></div><div><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">1、Django框架的Models数据模型类文件开发</span></font></div></li><ul><li><div><span style="font-size: 9pt;">数据库环境配置</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">设计model模型</span></font></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">向数据库中添加或者更新数据</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义获取数据的方法，和获取的数据</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">2、Django框架的Templates模板文件开发</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义模板的展示框架</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义需要替换数据位置的标签和所需变量</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">设置模板中的超链接等</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">3、Django框架的Views数据逻辑处理文件开发</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义需要从url获取的参数</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">存储查询集，存储在字典中，用来传递给模板文件使用</span></div></li><li><div><span style="line-height: 13.6px;">构建response对象，将参数传递给模板文件，通过方法返回Response报文返回给客户端</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">4、Django的路由配置调整</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">在正则中定义需要传递给view的数据</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">定义路由功能，指定需要执行的view函数</span></div></li></ul></ul></div><div><br/></div><div><br/></div></span>
</div></body></html>