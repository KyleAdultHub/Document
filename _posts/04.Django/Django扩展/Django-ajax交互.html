---
title: Django-ajax交互
date: "2016-11-08 22:00:00"
categories:
- Django
- Django拓展
tags:
- Django
toc: true
---


<html>
<body>
<div>
<span><div><font style="color: rgb(50, 135, 18); background-color: rgb(255, 250, 165); font-size: 14pt;-evernote-highlight:true;"><b>Django与ajax交互的典型案例</b></font></div><div><ul><li><font style="font-size: 10pt;"><b>功<font>能的结构性分析</font></b></font></li><ul><li><img src="/e_img/Django-ajax交互_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;"/></li></ul><li><b><font style="font-size: 10pt;">代码执行流程</font></b></li><ul><li><span style="font-size: 9pt;">1、构造字典格式的图书数据，然后作为参数给JsonResponse对象，返回一个Json字典</span><span style="font-size: 9pt; line-height: 1.45;">关于这部分的内容，我们可以参考之前json案例的过程：</span><span style="font-size: 9pt; line-height: 1.45;">获取数据 -- 定义空列表 -- 定义数据存储格式 -- 追加到空列表 -- 定义整体字典格式</span><span style="font-size: 9pt; line-height: 1.45;">所以我们可以根据上面的流程来完成这一步</span></li><ul><li><span style="font-size: 9pt;">1.1 获取所有的图书数据    </span><span style="font-size: 9pt; line-height: 1.45;">tushu = BookInfo.objects.all()</span></li><li><span style="font-size: 9pt;">1.2 定义空列表    </span><span style="font-size: 9pt; line-height: 1.45;">tushu_list = []</span></li><li><span style="font-size: 9pt;">1.3 定义数据存储格式，</span><span style="font-size: 9pt; line-height: 1.45;">因为我们要根据图书的id获取到人物的所有信息，所以必须有两个字段内容：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">id和btitle</span><span style="font-size: 9pt; line-height: 1.45;">[图书id,图书名称]</span></li></ul><li><span style="font-size: 9pt;">1.4 追加到空列表      </span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">for ts in tushu:</span></li><ul><li><span style="font-size: 9pt;">tushu_list.append([ts.id,ts.btitle])</span></li></ul></ul><li><span style="font-size: 9pt;">1.5 构造字典对象，传递给JsonResponse对象</span></li><ul><li><span style="font-size: 9pt;">tushu_dict = {&quot;TuDic&quot;:tushu_list}</span></li><li><span style="font-size: 9pt;">return JsonResponse(tushu_dict)</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 1.45;">2、点击图书的选择项，触发一个ajax请求实践</span><span style="font-size: 9pt; line-height: 1.45;">因为没有按钮，而且直接点击，就能出现数据，所以我们就可以直接在jquery文件加载完成后，就触发一个aj</span><span style="font-size: 9pt; line-height: 1.45;">ax请求，去获取所有的图书数据。</span><span style="font-size: 9pt; line-height: 1.45;">所以这部分我们只需要使用一个$.get()方法即可完成该任务</span></li><li><span style="font-size: 9pt;">$(function(){</span></li><ul><li><span style="font-size: 9pt;">$.get('/TuShu/',function (){</span></li><ul><li><span style="font-size: 9pt;">});</span></li></ul><li><span style="font-size: 9pt;">});</span></li></ul><li><span style="font-size: 9pt;">3、将Json对象数据传递给ajax请求</span><span style="font-size: 9pt; line-height: 1.45;">我们知道ajax发起127.0.0.1:8000/TuShu/请求后，会返回一个Json格式的数据，那我们直接对这个对</span><span style="font-size: 9pt; line-height: 1.45;">象进行操作即可，所以我们将获取到的对象存放到function后面的()内部即可</span></li><li><span style="font-size: 9pt;">$(function(){</span></li><ul><li><span style="font-size: 9pt;">$.get('/TuShu/',function (data){</span></li><ul><li><span style="font-size: 9pt;">});</span></li></ul><li><span style="font-size: 9pt;">});</span></li><li><span style="font-size: 9pt;">注意：</span><span style="font-size: 9pt; line-height: 1.45;">function后面的小括号内部的名字随意起，反正都代表/TuShu/请求返回的结果，</span><span style="font-size: 9pt; line-height: 1.45;">返回的结果是：</span></li><ul><li><span style="font-size: 9pt;">{&quot;TuDic&quot;: [[1, &quot;\u5c04\u96d5\u82f1\u96c4\u4f20&quot;], [2, &quot;\u5929\u9f99\u516b\</span><span style="font-size: 9pt; line-height: 1.45;">u90e8&quot;], [3, &quot;\u7b11\u50b2\u6c5f\u6e56&quot;], [4, &quot;\u96ea\u5c71\u98de\u72d0&quot;], [5,</span><span style="font-size: 9pt; line-height: 1.45;">&quot;\u78a7\u8840\u5251&quot;]]}</span></li></ul></ul><li><span style="font-size: 9pt;">4、对这些数据进行选项的拼接</span><span style="font-size: 9pt; line-height: 1.45;">我们要对获取的Json格式的数据的真实内容，那么怎么获取呢？</span><span style="font-size: 9pt; line-height: 1.45;">使用对象.属性的方法来获取，那么我们可以通过data.TuDic的格式获取出来所有的数据</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">[[1, &quot;\u5c04\u96d5\u82f1\u96c4\u4f20&quot;], [2, &quot;\u5929\u9f99\u516b\u90e8&quot;], [</span><span style="font-size: 9pt; line-height: 1.45;">3,&quot;\u7b11\u50b2\u6c5f\u6e56&quot;], [4, &quot;\u96ea\u5c71\u98de\u72d0&quot;], [5, &quot;\u78a7\u</span><span style="font-size: 9pt; line-height: 1.45;">8840\u5251&quot;]]             </span><span style="font-size: 9pt; line-height: 1.45;">可以看到，这是一大堆列表数据，那么我们就可以使用ajax的遍历方法$.each来分别获取具体的内容</span></li><ul><li><span style="font-size: 9pt;">$.each(data.TuDic,function (i,t) {。。。});</span></li><ul><li><span style="font-size: 9pt;">因为是一个列表的格式，所以我们可以使用列表的分片功能，分别获取到他们的值</span><span style="font-size: 9pt; line-height: 1.45;">图书的id可以使用t[0],图书的名称可以使用t[1]</span><span style="font-size: 9pt; line-height: 1.45;">我们要把获取到的图书id和图书名称展示到选项框内，那么我们可以使用绑定的方式，给他定义一个孔列表，</span><span style="font-size: 9pt; line-height: 1.45;">然后使用列表的追加方式，将所有内容以选项框的方式追加到空列表空间内</span></li><ul><li><span style="font-size: 9pt;">tushu=$('#tushu');</span></li><li><span style="font-size: 9pt; line-height: 1.45;">$.each(data.TuDic,function (i,t) {</span><br/></li><ul><li><span style="font-size: 9pt;">tushu.append('&lt;option value=&quot;'+t[0]+'&quot;&gt;'+t[1]+'&lt;/option&gt;');</span></li></ul><li><span style="font-size: 9pt;">});</span></li></ul></ul></ul></ul></ul></ul></div><div><br/></div></span>
</div></body></html>