---
title: Django-静态文件管理
date: "2016-11-13 22:00:00"
categories:
- Django
- Django拓展
tags:
- Django
toc: true
---

<html>
<body>
<div>
<span><div><font style="font-size: 14pt; background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">  静态文件介绍</span></font></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">什么是静态文件</span></font></li><ul><li><span style="font-size: 9pt;">对于Django项目来说，项目中的CSS、图片、js等都属于静态文件。</span><span style="font-size: 9pt; line-height: 1.45;">我们一般会将静态文件放到一个单独的目录中，以方便管理。在html页面中调用时，也需要指定静态文件的路径。</span><span style="font-size: 9pt; line-height: 1.45;">Django中提供了一种解析的方式配置静态文件路径。</span></li></ul><li><span style="font-size: 10pt; font-weight: bold;">静态文件放置</span>：</li><ul><li><span style="font-size: 9pt;">静态文件可以放在项目根目录下，也可以放在应用的目录下，</span><span style="font-size: 9pt; line-height: 1.45;">由于有些静态文件在项目中是通用的，所以推荐放在项目的根目录下，方便管理</span></li></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">静态文件的基础配置和访问</span></font></span></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">Django静态文件的访问路径配置</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">配置访问关键字路径</span></font></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image.png" type="image/png" data-filename="Image.png" width="176"/></span></li><ul><li><span style="font-size: 9pt;">访问路径可以换成别的目录名称，这里只是强调静态文件的存储目录，用来判断对静态文件的请求</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">为什么要我们配置关键字访问路径</span></font></li><ul><li><span style="font-size: 9pt;">在Django项目的配置文件中由默认的静态文件访问方式，我们需要设定静态文件的访问途径，如果url是以我们设置的/static/开头，那就代表是在请求静态文件的存储目录；  然后Django没有直接给我们存储静态文件的目录，我们还需要自己设置静态文件存储的位置</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">创建静态文件的专用存放目录</span></font></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [1].png" type="image/png" data-filename="Image.png" width="207"/></span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">配置Django项目的静态文件配置，让我们创建的目录在Django项目中生效</span></font></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [2].png" type="image/png" data-filename="Image.png" width="332"/></span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">创建子静态文件存放的目录</span></font></li><ul><li><span style="font-size: 9pt;">在静态文件存储目录中创建，css、img</span><span style="font-size: 9pt; line-height: 1.45;">、js等文件夹用来存储对应的静态文件</span></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">两条配置信息对访问静态文件的作用：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">第一条是声明/static/是请求静态文件的请求，不会进行url匹配，会去寻找静态文件目录下的静态文件</span></li><li><span style="font-size: 9pt; line-height: 1.45;">第二条是设置静态文件的访问路径，当访问静态文件的时候会默认的去访问静态文件目录下面的文件</span></li><li><span style="font-size: 9pt; line-height: 1.45;">第一条设置的请求目录关键字，可以不与存储目录的名称相同，当第一个关键字如果匹配成功后，会直接在默认存储目录中寻找请求的文件；</span></li></ul></ul><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">使用静态标签访问文件</span></font></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">在模板中或者跳转函数中通过静态url访问文件的弊端</span></font></li><ul><li><span style="font-size: 9pt;">第一种情况：</span></li><ul><li><span style="font-size: 9pt;">在模板文件中定义好了静态文件的绝对路径，那么这种情况就固定了，后期</span><span style="font-size: 9pt; line-height: 1.45;">维护太麻烦，万一请求url的配置一旦发生变动，那么就会出现意外的问题</span></li></ul><li><span style="font-size: 9pt;">第二种情况：</span></li><ul><li><span style="font-size: 9pt;">当用户通过网页上的连接静态资源的时候，如果设置的是静态的文件存储地址，那么用户可以通过开发者工具看到我们静态文件存储的地址，为了安全可以通过配置项隐藏真实图片路径</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">解决的办法：</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">可以使用static的动态标签，防止用户端可以看到我们实际的静态文件存储地址</span></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">模板文件中静态标签</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">设置静态文件标签</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">加载静态文件的标签并设置静态标签</span></font></li><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [3].png" type="image/png" data-filename="Image.png" width="246"/></span></li><ul><li><span style="line-height: 13.600000381469727px;">加载后我们就可以使用static关键字来代表我们设置的<span style="font-size: 9pt; line-height: 13.600000381469727px;">static_url的路径，这样客户端就不会看到我们的实际设置的访问的静态文件的路径</span></span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">标签生成的url地址(实际生成的用来访问静态文件的url地址)</span></font></li><ul><li><span style="font-size: 9pt;">'static_url' + 'img/jingtai.jpg'         static_url 为在setting文件中设置好的static_url 地址</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">实际的访问路径问</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">'</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">STATICFILES_DIRS</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">'</span> <span style="font-size: 9pt; line-height: 13.600000381469727px;"> +</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">‘</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">img/jingtai.jpg</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">’    </span><span style="font-size: 9pt; line-height: 13.600000381469727px;">STATICFILES_DIRS 为在setting文件中设置好的静态文件默认访问地址</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">在客户端看到的文件地址</span></font></li><ul><li><span style="font-size: 9pt;">'static/' + 'img/jingtai.jpg'      这样设置客户端看到的存储静态文件的地址永远是static，异常了实际的静态文件访问地址；</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">效果</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">在我们的setting文件中不管我们怎么更改我们的</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">static_url  的内容，也就是更改我们的请求url关键字，我们都是在我们的默认静态文件路径中去寻找我们请求的文件，这样既解决了目录修改的问题，也不会让客户看到我们的实际文件存储地址</span></li></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">文件的上传管理（图片）</span></font></span></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">文件上传的几种方式（图片）</span></font></li><ul><li><span style="font-size: 9pt;">在管理页面admin中上传图片</span></li><li><span style="font-size: 9pt;">自定义form表单中上传图片</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">上传文件前的基本环境配置</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">安装PIL（python中图片操作的工具）</span></font></li><ul><li><span style="font-size: 9pt;">pip install Pillow==3.4.1</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">图片上传相关模型类配置</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">第一步</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;"> </span><img src="/e_img/Django静态文件管理_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="299"/></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">将用来生成存储图片存储路径的的数据库表</font></span></li><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">ImageField为图片类型字段，当有图片进行上传的时候会去验证，如果不是图片格式的文件会报错</font></span></li><li><font style="font-size: 9pt;">upload_to选项代表要把提交的图片提交到哪里</font></li><li><font style="font-size: 9pt;">这个 book_app/是一个专门存放图片的目录，在我们后边定义的MEDIA_ROOT的目录下（后面我门会创建该目录用来存储图片）</font></li></ul></ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">第二步</font></span></li><ul><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">执行迁移文件</font></span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-weight: bold; line-height: 13.600000381469727px;">配置上传文件的目录</span></font></li><ul><li><font style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [5].png" type="image/png" data-filename="Image.png" width="312"/></font></li><ul><li><font style="font-size: 9pt;">MEDIA_ROOT 是django中默认配置的专门存放图片的配置，因为图片也属于静态文件，我们也将其路径设置在static/中，定义了admin上传的路径和orm进行图片验证的路径；</font></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">在static目录下创建media目录，在创建应用名称的目录，用来存储对应应用的图片</span></font></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [6].png" type="image/png" data-filename="Image.png" width="238"/></span></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">admin中上传文件步骤</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">注册PicTest的模型类</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;"> </span><img src="/e_img/Django静态文件管理_files/Image [7].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="240"/></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">运行admin后台系统</span></font></li><ul><li><a href="http://127.0.0.1:8000/admin/" style="font-size: 9pt;">http://127.0.0.1:8000/admin/</a></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">点击PIctest  所显示行右侧的增加按钮</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">  </span><img src="/e_img/Django静态文件管理_files/Image [8].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="402"/></li></ul></ul></ul></div></div><div><ul><ul><li><span style="font-size: 9pt; line-height: 1.45;">点击Browse按钮，选择文件点击保存</span></li><li><span style="font-size: 9pt; line-height: 1.45;">可以看到已经在数据库中增加了该行图片对象的记录，并且已经在服务器的图片默认存储路径存储了该图片</span></li></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">自定义表单上传文件（图片）</span></li><ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">定义包含上传文件的 表单标签的模板</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">1、form的属性enctype=&quot;multipart/form-data&quot;  </span></li><li><span style="font-size: 9pt; line-height: 1.45;">2、form的method为post</span></li><li><span style="font-size: 9pt; line-height: 1.45;">3、input的类型为file</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">enctype 属性规定在发送到服务器之前应该如何对表单数据进行编码</span></li><li><span style="font-size: 9pt;">multipart/form-data      </span> <span style="font-size: 9pt; line-height: 1.45;">不对字符编码，对图片和一些二进制数据文件进行编码。</span></li><li><span style="font-size: 9pt; line-height: 1.45;">在使用包含文件上传控件的表单时，必须使用该值</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例：</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;"> </span><img src="/e_img/Django静态文件管理_files/Image [9].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 13.600000381469727px;" width="416"/></li></ul></ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">定义view函数，当接收上传图片需求的时候返回上传图片的表单模板</span></li><ul><li><img src="/e_img/Django静态文件管理_files/Image [10].png" type="image/png" data-filename="Image.png" style="font-weight: bold; font-size: 9pt;" width="308"/></li></ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">设置url，当有上传图片文件的需求的时候，调用对应的函数</span></li><ul><li><img src="/e_img/Django静态文件管理_files/Image [11].png" type="image/png" data-filename="Image.png" style="font-weight: bold; font-size: 9pt;" width="373"/></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">创建view函数的pic_handle函数，用来接收上传文件的请求，来完成图片的上传功能</span></font><span style="font-size: 9pt; line-height: 1.45;"> </span></li><ul><li><img src="/e_img/Django静态文件管理_files/Image [12].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="458"/></li><li><span style="font-size: 9pt; line-height: 1.45;">return HttpResponse('OK')    <span style="font-size: 9pt; line-height: 1.45;">返回上传成功的界面给客户端</span></span></li><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">备注：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">这部分函数主要包括两部分：</span></li><li><span style="font-size: 9pt; line-height: 1.45;">1、从网络数据中获取数据流存储到磁盘上</span></li><li><span style="font-size: 9pt; line-height: 1.45;">2、将上传的文件记录存储到数据库中</span></li></ul><li><font style="font-size: 12px;"><span style="font-size: 12px; line-height: 13.600000381469727px; font-weight: bold;">应用到的方法和函数：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">with方式打开文件，不需要关闭</span></li><li><span style="font-size: 9pt; line-height: 1.45;">python编辑文件必须使用wb格式，而不能用w格式</span></li><li><span style="font-size: 9pt; line-height: 1.45;">chunks()方法</span><span style="font-size: 9pt; line-height: 1.45;">迭代整个文件，并生成指定大小的一部分内容。chunk_size默认为64 KB。处理大文件时这会非常有用，因为这样可以把他们从磁盘中读取出来，而避免将整个文件存到内存中.</span></li><li><span style="font-size: 12px; line-height: 13.600000381469727px;">FILES获取到的是请求包含的所有的文件对象的集合，以键值对的形式存储，可以通过键来获取</span></li><ul><li><span style="line-height: 1.45;"> </span><img src="/e_img/Django静态文件管理_files/Image [13].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="325"/></li></ul></ul></ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">配置上传文件的url（请求上传rul是通过第一个表单的上传按钮触发的）</span></li><ul><li><span style="line-height: 1.45;"> </span><img src="/e_img/Django静态文件管理_files/Image [14].png" type="image/png" data-filename="Image.png" style="font-size: 9pt;"/></li></ul><li><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">接下来便可以访问进行上传需求的网址</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">python manage.py pic_upload</span></li><li><a href="http://127.0.0.1:8000/pic_upload/" style="font-size: 9pt;">127.0.0.1:8000/pic_upload</a></li></ul></ul></ul></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">图片的展示</span></font></div><div><ul><li><span style="font-size: 9pt;"><img src="/e_img/Django静态文件管理_files/Image [15].png" type="image/png" data-filename="Image.png" width="508"/></span></li></ul></div><div><br/></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">备注TIps：</span></font></div><div><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">1、响应状态403： </span></font></li><ul><li><span style="font-size: 9pt;">代表访问静态文件返回的结果是进行调用缓存的结果，浏览器根据HTTP协议接收到该响应行，会去再缓存中寻找对应的静态资源，服务器端为了减少服务器的压力，不会对浏览器重复的发送同一个静态资源，会先让浏览器进行缓存，然后在没有清空缓存的情况下，下次请求会直接调用缓存文件</span></li></ul></ul></div><div><span style="font-size: 9pt;">    </span></div><div><br/></div><div><br/></div></span>
</div></body></html>