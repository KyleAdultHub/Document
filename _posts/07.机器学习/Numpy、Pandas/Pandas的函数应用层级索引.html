---
title: Pandas的函数应用与层级索引
date: "2017-05-24 20:00:00"
categories:
- 机器学习
- Numpy、Pandas
tags:
- 数据处理
- pandas
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">Pandas的函数应用</span></font></div><div><ul><li><span style="font-size: 10pt; font-weight: bold;">Numpy的ufunc函数（pandas的数据结构支持Numpy的ufunc函数</span><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">）</span></li><ul><li><span style="font-size: 9pt;">示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image.png" type="image/png" data-filename="Image.png" width="242"/></span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">备注</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">在使用计算类函数的时候会直接对所有数据运算输出一个最终结果</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">当使用统计类函数的时候，会对每一列进行统计并输出每列的结果</span></li></ul></ul></ul><li><span style="font-size: 10pt; font-weight: bold;">apply将函数应用到列或者行上</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">使用方法</span></span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">定义一个函数</span></li><ul><li><span style="font-size: 9pt;">func = lambda x : np.max(x) - np.min(x)</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">定义的方法，要能处理每一列/行的数据</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">将每一列的数据应用到自定义的函数上</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">ser_obj.apply(func， [axis=0])</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis：0 表示将DataFrame的每一列作为func函数的输入，1表示将每一行作为func函数的输入，默认为0</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">备注</span></font></li><ul><li><span style="font-size: 9pt;">对于DataFrame，x 是将每一 列/行 做为参数传给自定义函数，默认操作的这一行/列（Series对象）；</span><span style="font-size: 9pt; line-height: 1.45;">如果是 统计函数，每一行/列返回一个数字，最后组合为一个Series （np.sum\np.mean\np.max..)；</span><span style="font-size: 9pt; line-height: 1.45;">如果是 计算函数/广播运算，每一 行/列 都会返回一个Series，最后组合为一个DataFrame</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">对于Series是将每一数据都作为func的输入，每一个数组返回一个结果，最后再拼接成一个Series</span></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [1].png" type="image/png" data-filename="Image.png" width="345"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold;">applymap将函数应用到每个数据上</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">使用方法</span></span></li><ul><li><span style="font-size: 9pt;">定义一个函数</span></li><ul><li><span style="font-size: 9pt;">func = lambda x : x ** 2</span></li><ul><li><span style="font-size: 9pt;">定义的方法，要能对没个数据进行处理，并且数据类型也匹配</span></li></ul></ul><li><span style="font-size: 9pt;">将每一列的数据应用到自定义的函数上</span></li><ul><li><span style="font-size: 9pt;">ser_obj.applymap(func)</span></li></ul><li><span style="font-size: 9pt;">备注</span></li><ul><li><span style="font-size: 9pt;">对于DataFrame对象，x 将所有行和列的每一个元素做为参数传递给自定义函数，默认操作的是一个数据（str、int、float）；</span><span style="font-size: 9pt; line-height: 1.45;">如果是统计函数，每个元素做统计计算，并返回一个值，最后组合为一个DataFrame；</span><span style="font-size: 9pt; line-height: 1.45;">如果是计算函数和算术运算，每个元素计算后，返回一个值，最后组合为一个DataFrame</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">对于Series也同样将每个元素作为参数传递为自定义函数，并每次都输出一个结果</span></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [2].png" type="image/png" data-filename="Image.png" width="237"/></span></li></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">Pandas的排序</span></span></div></div><div><ul><li><span style="font-size: 10pt; font-weight: bold;">按照索引排序</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">使用方法</span></span></li><ul><li><span style="font-size: 9pt;">sort_index([ascending=False， axis=1])     </span></li><ul><li><span style="font-size: 9pt;">ascending:   True 表示按升序进行排序， False按照降序进行排序，默认为升序</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis： 1表示按照列索引进行排序，0表示按照行索引进行排序</span></font></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [3].png" type="image/png" data-filename="Image.png" width="259"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">按照值进行排序</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">使用方法</span></span></li><ul><li><font style="font-size: 9pt;">sort_values(by='column name')   根据某个唯一的列名进行排序，如果有其他相同列名则报错。</font></li><ul><li><font style="font-size: 9pt;">ascending:   True 表示按升序进行排序， False按照降序进行排序，默认为升序</font></li><li><span style="line-height: 13.600000381469727px;"><font style="font-size: 9pt;">by：表示按照哪一列进行排序</font></span></li></ul></ul><li><span style="font-weight: bold; line-height: 13.600000381469727px;"><font style="font-size: 9pt;">示例代码</font></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [4].png" type="image/png" data-filename="Image.png" width="255"/></span></li></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">Pandas处理缺失数据</span></span></div></div><div><ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">判断是否存在缺失值</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">判断方法</span></span></li><ul><li><span style="font-size: 9pt;">isnull()    判断pandas数据类型是否存在nan值</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">isnotnull()   判断pandas数据类型不为Nan的值</span></li></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [5].png" type="image/png" data-filename="Image.png" width="231"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">丢弃缺失的数据</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">使用方法</span></span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">dropna(axis=0)   删除包含Nan值的行或列</span></li><ul><li><span style="font-size: 9pt;">axis：0删除包含nan的行，1删除包含nan的列，默认删除nan所在的行</span></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [6].png" type="image/png" data-filename="Image.png" width="224"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">填充缺失的数据</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">使用方法</span></span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">fillna()   将所有的nan值填充为指定的值</span></li></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.600000381469727px;">示例代码</span></span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [7].png" type="image/png" data-filename="Image.png" width="177"/></span></li></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.600000381469727px;-evernote-highlight:true;">Pandas层级索引</span></span></div></div><div><ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">层级索引的创建</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">怎么创建层级索引</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">创建pandas对象的时候，指定Index为两个列表构成的索引，第一个子list是外层索引，第二个list是内层索引。</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例代码</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [8].png" type="image/png" data-filename="Image.png" style="line-height: 1.45;" width="358"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold;">MultiIndex多层索引对象</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">查看层级索引</span></li><ul><li><span style="font-size: 9pt;">打印这个Series的索引类型，显示是MultiIndex</span></li><li><span style="font-size: 9pt;">直接将索引打印出来，可以看到有lavels,和labels两个信息。lavels表示两个层级中分别有那些标签，labels是每个位置分别是什么标签。</span></li></ul><li><span style="font-size: 9pt;">示例代码</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [9].png" type="image/png" data-filename="Image.png" width="438"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold;">通过索引对子集的选取</span></li><ul><li><span style="font-size: 9pt;">选取方法的介绍</span></li><ul><li><span style="font-size: 9pt;">根据索引获取数据。因为现在有两层索引，当通过外层索引获取数据的时候，可以直接利用外层索引的标签来获取。</span></li><li><span style="font-size: 9pt;">当要通过内层索引获取数据的时候，在list中传入两个元素，前者是表示要选取的外层索引，后者表示要选取的内层索引</span></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">通过外层选取内层</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">ser_obj['outer_index']     通过外层索引名选取其包含的所有内层索引</span></font></li></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">通过外层和内层索引选取对应的值</span></li><ul><li><span style="font-size: 9pt;">ser_obj['a']['3']    通过外层和内层索引选取某个值</span></li></ul><li><span style="font-size: 9pt;">选取连续外层索引对应的内层索引</span></li><ul><li><span style="font-size: 9pt;">ser_obj[ : , '3']</span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">交换分层顺序</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">使用方法</span></li><ul><li><span style="font-size: 9pt;">swaplevel( (x1, x2) )        交换内层与外层索引，交换两层默认为(0, 1)。</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">(x1, x2): 交换索引的两个索引下标，</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">如果是两层索引，默认内外层索引转换，如果是多层索引，可以通过索引下标来表示需要交换的分层</span></font></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例代码</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [10].png" type="image/png" data-filename="Image.png" width="176"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 13.600000381469727px;">交换并排序分层</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">使用方法</span></li><ul><li><span style="font-size: 9pt;">sort_index(level=0)</span><span style="font-size: 9pt; line-height: 1.45;">    </span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">level: 表示按照哪一层的索引进行排序，0表示按照最外层，默认为0</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">示例代码</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [11].png" type="image/png" data-filename="Image.png" width="221"/></span></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">数据重构</span></li><ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">将具有多层索引的Series对象重构为DataFrame对象</span></span></li><ul><li><span style="font-size: 9pt;">数据重构方法（前提是series要有多层索引）</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">unstack(x)    将有层级索引的series重构为DataFrame</span></li><ul><li><span style="font-size: 9pt;">x: 表示将多层索引的哪一层索引作为列索引，默认将最内层索引作为列索引</span></li></ul></ul><li><span style="font-size: 9pt;">代码示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [12].png" type="image/png" data-filename="Image.png" width="332"/></span></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">将DataFrame对象重构为Series对象</span></span></li><ul><li><span style="font-size: 9pt;">使用方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">stack()   将DataFrame对象重构为具有多层索引的Series对象</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">默认将列索引作为Series的内层索引</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">代码示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas的函数应用层级索引_files/Image [13].png" type="image/png" data-filename="Image.png" width="307"/></span></li></ul></ul></ul></ul></div><div><br/></div></span>
</div></body></html>