---
title: Pandas数据处理、合并、转化、重构
date: "2017-05-25 22:00:00"
categories:
- 机器学习
- Numpy、Pandas
tags:
- 数据处理
- pandas
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><font style="font-size: 14pt;"><span style="color: rgb(50, 135, 18); font-size: 14pt; font-weight: bold; background-color: rgb(255, 250, 165); background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">Pandas数据清洗</span></font></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">数据清洗的介绍</span></font></li><ul><li><span style="font-size: 9pt;">数据清洗是数据分析关键的一步，直接影响之后的处理工作</span></li><li><span style="line-height: 1.45; font-size: 9pt;">数据清洗是一个迭代的过程，实际项目中可能需要不止一次地执行这些清洗操作</span></li></ul></ul><div><font size="2"><span style="line-height: 13.600000381469727px;"><br/></span></font></div><div><span style="font-weight: bold; line-height: 13.600000381469727px; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-size: 14pt; background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">数据的缺失数据处理</span></div><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">pd.fillna()    补充缺失数据</span></li><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">pd.dropna()    删除缺失数据</span></li></ul><div><span style="font-weight: bold; line-height: 1.45; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-size: 14pt; background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">数据的联接</span></div><ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 13.600000381469727px;">数据联接的介绍</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">根据单个或多个键将不同DataFrame的行连接起来</span></li><li><span style="font-size: 9pt; line-height: 1.45;">类似数据库的连接操作</span></li></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 13.600000381469727px;">0.先定义两个表</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="313"/></li></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 13.600000381469727px;">1.通过merge将两个表通过外键关联到一起</span> <span style="font-size: 9pt; line-height: 13.600000381469727px;"> (默认使用相同且唯一的列作为外键，合并成内联接的结果)</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">使用方法   ()</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pd.merge(df_obj1, df_obj_2)</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [1].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="375"/></li></ul></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 1.45;">2.on指定列作为&quot;外键&quot;</span><span style="font-size: 9pt; line-height: 1.45;">（如果多个相同列名的情况下，通过on来指定）</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">使用方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pd.merge(df_obj1, df_obj_2， on='key')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [2].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="208"/></li></ul></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 1.45;">3.left_on, right_on,分别指定两张表的外键</span><span style="font-size: 9pt; line-height: 1.45;">（如果两张表不存在相关联同名列的时候）</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">使用方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pd.merge(df_obj1, df_obj_2， left_on='key1', right_on='key2')</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">left_on/right</span><span style="font-size: 9pt; line-height: 1.45;">_on:  表示指定两张表的哪个列作为外键进行关联</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 1.45;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [3].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="290"/></li></ul></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 1.45;">4.通过how指定连接方式，默认是内联接(inner)</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">使用方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pd.merge(df_obj1, df_obj2, left_on='key1', right_on='key2', how=&quot;outer&quot;)</span></li><ul><li><span style="font-size: 9pt; line-height: 13.600000381469727px;">how：表示指定的联接方式，默认为inner内联接。outer：外联接；left：左联接；right：右联接</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 1.45;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [4].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="326"/></li></ul></ul><li><span style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">5.按索引连接</span></span></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">使用场景（当一个表的索引是另一张表的列数据的时候）</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [5].png" type="image/png" data-filename="Image.png" style="line-height: 1.45;" width="191"/></span></li></ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">使用方法</span></li><ul><li><span style="line-height: 1.45; font-size: 9pt;">pd.merge(df_obj3, df_obj4, left_on=&quot;key&quot;, right_index=True, suffixes=[&quot;_left&quot;, &quot;_right&quot;])</span></li><ul><li><span style="line-height: 1.45; font-size: 9pt;">left_index/right_index: True 表示使用对应左/右表的索引作为外键，与另一张表的列进行关联</span></li></ul></ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [6].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="452"/></li></ul></ul></ul><div><span style="font-weight: bold; font-size: 10pt; line-height: 13.600000381469727px;">处理合并后的同名数据列</span></div><ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 13.600000381469727px;">使用方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pd.merge(df_obj1, df_obj2, left_on='key1', right_on='key2', suffixes=[&quot;_left&quot;, &quot;_right&quot;])</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">suffixes：指定同名数据列后缀，可接收一个列表，分别表示左/右表同名列后缀默认为_x, _y；</span></li></ul></ul><li><span style="font-weight: bold; font-size: 9pt; line-height: 13.600000381469727px;">示例代码</span></li><ul><li><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [7].png" type="image/png" data-filename="Image.png" style="font-size: 9pt; line-height: 1.45;" width="393"/></li></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); line-height: 13.600000381469727px; color: rgb(50, 135, 18); font-size: 14pt; font-weight: bold;-evernote-highlight:true;">Pandas数据合并</span></font></span></div></div><div><ul><li><span style="line-height: 1.45; font-weight: bold; font-size: 10pt;">数据合并的介绍</span></li><ul><li><span style="font-size: 9pt;">将两个pandas的对象的数据进行合并</span></li><li><span style="font-size: 9pt;">与表的联接不同，合并数据只会将两个表存在的数据进行合并，不会生成额外关联的数据</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; line-height: 13.600000381469727px; font-weight: bold;">Series对象的数据合并</span></font></li><ul><li><font style="font-size: 9pt;"><span style="line-height: 13.600000381469727px; font-size: 9pt; font-weight: bold;">1.当索引有重复的情况</span></font></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">使用方法</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">pd.concat([ser_obj1, ser_obj_2, ser_obj3], [</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis=1</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">, join='inner'])</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis: 1表示将Series转化为DataFrame对象数据按列追加，0表示直接在行下面对数据进行追加</span></font></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">join: 数据的连接方式，默认为outer，还支持inner，表示内连接，默认为outer；</span></font></li></ul></ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">代码示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [8].png" type="image/png" data-filename="Image.png" width="309"/></span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">2.索引不重复的情况</span></font></li><ul><li><span style="font-size: 9pt;">使用方法</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">pd.concat([ser_obj1, ser_obj_2, ser_obj3], [</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis=1</span><span style="font-size: 9pt; line-height: 13.600000381469727px;">])</span></font></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">axis: 1表示将Series转化为DataFrame对象数据按列追加，0表示直接在行下面对数据进行追加</span></li></ul></ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">代码示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [9].png" type="image/png" data-filename="Image.png" width="279"/></span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="line-height: 13.600000381469727px; font-size: 10pt; font-weight: bold;">DataFrame对象的数据合并</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">0.创建两组数据</span></font></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [10].png" type="image/png" data-filename="Image.png" width="434"/></span></li></ul><li><span style="font-size: 9pt; font-weight: bold;">1.将两组数据进行合并</span> <span style="font-size: 9pt;">（默认列索引共享，行索引不共享，默认在行的尾部添加数据）</span></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">使用方法</span></li><ul><li><span style="font-size: 9pt;">pd.concat([df_obj1, df_obj2], axis = 1, join='inner')</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">axis：1 按照行方向进行追加，共享行索引；0<span style="font-size: 9pt; line-height: 13.600000381469727px;"> 按照列方向进行追加，共享列索引；</span></span></font></li><li><span style="font-size: 9pt;">join：inner(当axis=1时，包含nan的行不显示，当axis=0时，包含nan的列不显示)，还支持outer，默认为outer</span></li></ul></ul><li><span style="font-size: 9pt;">代码示例</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/Pandas数据处理、合并、转化、重构_files/Image [11].png" type="image/png" data-filename="Image.png" width="272"/></span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">pd.concat与pd.merge的区别</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">pd.concat() </span></font></li><ul><li><span style="font-size: 9pt;">表示多个数据结构按行/按列合并，并返回一个完整的数据结构，concat合并不会制造新的数据（尽量保证结构的索引个数匹配）</span></li><li><span style="font-size: 9pt;">数据合并到一起</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">pd.merge()</span></font></li><ul><li><span style="font-size: 9pt;">表示多个数据结构按指定的列进行关联，并返回一个完整的数据结构，merge关联需要保证数据结构的形状完整，会填充新的数据（关联不依赖索引个数—）</span></li><li><span style="line-height: 1.45; font-size: 9pt;">类似于数据库的表关联</span></li></ul></ul></ul></div><div><font style="font-size: 14pt;"><span style="color: rgb(50, 135, 18); font-size: 14pt; font-weight: bold; background-color: rgb(255, 250, 165); background-position: initial initial; background-repeat: initial initial;-evernote-highlight:true;">Pandas的数据转化</span></font></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">duplicated处理重复数据</span></font></li><ul><li><span style="font-size: 9pt;">使用方法   (依次判断指定列数据，如果判断当前数据之前有重复，则设为True，否则为False)</span></li><ul><li><span style="font-size: 9pt;">df_obj.duplicated('col_name')     返回布尔类型的Series对象</span></li><ul><li><span style="font-size: 9pt;">col_name:  表示指定那一列来判断重复</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">drop_duplicates 过滤重复的行</span></font></li><ul><li><span style="font-size: 9pt;">使用方法 (依次判断指定数据列的重复情况，并将重复的行删除（注意，根据行索引删除，会影响其他列数据))</span></li><ul><li><span style="font-size: 9pt;">df_obj.drop_duplicates('col_name')</span></li><ul><li><span style="font-size: 9pt;">col_name:  表示指定那一列来判断重复</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="line-height: 13.600000381469727px; font-size: 10pt; font-weight: bold;"> map 将每列数据进行转换</span></font></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">使用方法（将数据对象传递给函数，对所有的数据进行处理）</span></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">DataFrame.map(lambda x : x ** 2))</span></li><ul><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">函数的参数为DataFrame数据对象，或者Series数据对象</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="line-height: 13.600000381469727px; font-size: 10pt; font-weight: bold;">replace 数据替换</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px; font-weight: bold;">将所有不想要的数据进行替换</span></font></li><ul><li><span style="font-size: 9pt;">df_obj.replace(old_data, new_data)</span></li><ul><li><span style="font-size: 9pt;">old_data: 为将要被替换的数据</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.600000381469727px;">new_data: 为替换的目标数据</span></font></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">替换固定个数数据</span></font></li><ul><li><span style="font-size: 9pt;">df_obj.replace([old_data, new_data], num)</span></li><ul><li><span style="font-size: 9pt;">old_data: 为将要被替换的数据</span></li><li><span style="font-size: 9pt;">new_data: 为替换的目标数据</span></li><li><span style="font-size: 9pt;">num：替换的最大数量</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45; font-weight: bold;">同时替换多个数据</span></font></li><ul><li><span style="font-size: 9pt;">df_obj.replace([old_data1, old_data2], [new_data1, old_data2])</span></li><ul><li><span style="font-size: 9pt;">old_data: 为将要被替换的数据</span></li><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">new_data: 为替换的目标数据</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">rename 修改数据结构属性</span></font></li><ul><li><span style="font-size: 9pt;">df_obj.rename(columns={&quot;old_col1&quot; : &quot;new_col1&quot;, &quot;old_col2&quot;: &quot;new_col2&quot;}, inplace=True)</span></li><ul><li><span style="font-size: 9pt;">old_data: 为将要被替换的列名</span></li><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">new_data: 为替换的目标列名</span></li><li><span style="line-height: 13.600000381469727px; font-size: 9pt;">inplace：True在源文件上进行修改，False会返回修改后的数据，默认为False</span></li></ul></ul></ul></div><div><br/></div></span>
</div></body></html>