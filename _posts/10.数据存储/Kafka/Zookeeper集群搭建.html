---
title: Zookeeper集群搭建
date: "2018-09-18 20:30:00"
categories:
- 数据存储
- Kafka
tags:
- Zookeeper
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div style="outline: 0px; box-sizing: border-box;"><div style="box-sizing: inherit; outline: 0px; background-color: rgb(245, 246, 247); -webkit-font-smoothing: antialiased;"><div style="outline: 0px; box-sizing: border-box;"><div style="box-sizing: inherit; outline: 0px; background: rgb(255, 255, 255); box-shadow: rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;"><div style="font-size: 14px; box-sizing: inherit; outline: 0px; padding: 16px 0px 0px; margin: 0px; border-bottom: 1px solid rgb(224, 224, 224); z-index: 9; background-color: rgb(255, 255, 255);"><div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;"><div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;"><span style="min-width: 100%; position: relative;"><span style="color: rgb(51, 127, 229); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 20px;">软件环境准备:</span><br/></span></div></div></div><div style="box-sizing: inherit; outline: 0px; position: relative; padding-top: 16px;"><div style="box-sizing: inherit; outline: 0px; padding: 0px; margin: 0px; word-break: break-all;"><div style="box-sizing: inherit; outline: 0px; padding: 0px; margin: 0px; word-break: break-all;"><div style="font-size: 14px; outline: 0px; padding: 0px; box-sizing: border-box; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; font-size: 14px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.5;">Linux服务器一台、三台、五台（2*n+1台）；</span></div><div style="font-size: 14px; outline: 0px; padding: 0px; box-sizing: border-box; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; font-size: 14px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.5;">Java jdk 1.7；</span></div><div style="font-size: 14px; outline: 0px; padding: 0px; box-sizing: border-box; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; font-size: 14px; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.5;">zookeeper 3.4.6版；</span></div><h2 style="font-size: 20px; outline: 0px; padding: 0px; box-sizing: border-box; margin: 8px 0px 16px; word-break: break-all;"></h2><h2><font style="font-size: 12pt;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; color: rgb(51, 127, 229); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; line-height: 1.5; font-weight: 500;">软件安装：</span></font></h2><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">解压jdk、zookeeper文件到指定目录，执行命令tar -zvxf xxxx.tar.gz -C /usr/local/program</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">配置环境变量，vi /etc/profile</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><div style="white-space: pre-wrap; position: relative; outline: 0px; border: none; background-color: rgb(248, 248, 248); box-sizing: border-box; word-wrap: break-word; word-break: break-all; margin: 0px 0px 24px; padding: 8px 16px 4px 56px; overflow: auto;"><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#set enviroment</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">export JAVA_HOME=/usr/local/program/jdk1.7.0_79</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">export ZK_HOME=/usr/local/program/zk/zookeeper-3.4.6</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">export PATH=$JAVA_HOME/bin:$ZK_HOME/bin:$PATH</font></span></div></div></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">java -version 命令测试是否成功配置jdk</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><div style="white-space: pre-wrap; position: relative; outline: 0px; border: none; background-color: rgb(248, 248, 248); box-sizing: border-box; word-wrap: break-word; word-break: break-all; margin: 0px 0px 24px; padding: 8px 16px 4px 56px; overflow: auto;"><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">[root@localhost ~]# java -version</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">java version &quot;1.7.0_79&quot;</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">Java(TM) SE Runtime Environment (build 1.7.0_79-b15)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">Java HotSpot(TM) 64-Bit Server VM (build 24.79-b02, mixed mode)</font></span></div></div></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><font style="font-size: 10pt;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;">配置zookeeper；首先建立两个文件夹mkdir /usr/local/program/zk/zkdata ，</span><span style="outline: 0px; box-sizing: border-box; word-break: break-all; color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;">mkdir /usr/local/program/zk/zkdataLog </span></font></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">然后执行命令cd /usr/local/program/zk/zookeeper-3.4.6/conf/ 进入配置文件目录，拷贝一份配置文件cp zoo_sample.cfg zoo.cfg改名为zoo.cfg</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">编辑配置文件修改配置（将端口改大的目的是为了防止冲突）：</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><div style="white-space: pre-wrap; position: relative; outline: 0px; border: none; background-color: rgb(248, 248, 248); box-sizing: border-box; word-wrap: break-word; word-break: break-all; margin: 0px 0px 24px; padding: 8px 16px 4px 56px; overflow: auto;"><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># The number of milliseconds of each tick</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">tickTime=2000</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># The number of ticks that the initial</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># synchronization phase can take</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">initLimit=10</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># The number of ticks that can pass between</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># sending a request and getting an acknowledgement</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">syncLimit=5</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># the directory where the snapshot is stored.</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># do not use /tmp for storage, /tmp here is just</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># example sakes.</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">dataDir=/usr/local/program/zk/zkdata</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">dataLogDir=/usr/local/program/zk/zkdataLog</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># the port at which the clients will connect</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">clientPort=12181</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># the maximum number of client connections.</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># increase this if you need to handle more clients</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#maxClientCnxns=60</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># Be sure to read the maintenance section of the</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># administrator guide before turning on autopurge.</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># The number of snapshots to retain in dataDir</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#autopurge.snapRetainCount=3</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># Purge task interval in hours</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># Set to &quot;0&quot; to disable auto purge feature</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#autopurge.purgeInterval=1</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">server.1=192.168.0.102:12888:13888</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">server.2=192.168.0.103:12888:13888</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">server.3=192.168.0.104:12888:13888</font></span></div></div></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">进入zkdata目录，执行命令echo “1” &gt; myid创建myid文件并输入值为1</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">依次在另外两台机器上执行同样的操作，myid的数值依次为2,3</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">配置成功，执行命令zkServer.sh start分别启动三台机器</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">执行命令zkServer.sh status查看对应的状态发现出现：zookeeper Error contacting service. It is probably not running错误</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">执行命令：tail -f zookeeper.out</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">查看到错误记录：</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">2016-04-21 06:56:56,242 [myid:1] – WARN  [QuorumPeer[myid=1]/0:0:0:0:0:0:0:0:2181:Follower@89] – Exception when following the leader</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">java.net.NoRouteToHostException: No route to host</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.PlainSocketImpl.socketConnect(Native Method)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at java.net.Socket.connect(Socket.java:579)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at org.apache.zookeeper.server.quorum.Learner.connectToLeader(Learner.java:225)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:71)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:786)</font></span></div></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">经验证：防火墙的问题，执行命令service iptables stop关闭防火墙（如要永久关闭防火墙执行命令：chkconfig iptables off）</font></span></div><div style="outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; box-sizing: border-box; list-style-type: decimal; word-break: break-all;"><span style="color: rgb(51, 51, 51); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; line-height: 1.57143;"><font style="font-size: 10pt;">重启机器，执行命令zkServer.sh status 分别查看每台机器的状态为leader、follower、follower则表明启动成功</font></span></div><div style="font-size: 16px; box-sizing: border-box; padding: 0px; outline: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all;"></div><h2 style="font-size: 20px; outline: 0px; padding: 0px; box-sizing: border-box; margin: 8px 0px 16px; word-break: break-all;"></h2><h2><font style="font-size: 12pt;"><span style="outline: 0px; box-sizing: border-box; word-break: break-all; color: rgb(51, 127, 229); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; line-height: 1.5; font-weight: 500;">配置说明：</span></font></h2><div style="font-size: 16px; box-sizing: border-box; padding: 0px; outline: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all;"></div><div style="white-space: pre-wrap; position: relative; outline: 0px; border: none; background-color: rgb(248, 248, 248); box-sizing: border-box; word-wrap: break-word; word-break: break-all; margin: 0px 0px 24px; padding: 8px 16px 4px 56px; overflow: auto;"><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">作用：</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">leader：从客户端接收读写请求，响应读写请求，向slaver发送数据</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">slaver：从leader同步数据，当leader失败时，从新投票选举新的leader</font></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">配置详解：</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">myid:位于快照目录，是用来标识本台机器在集群中的唯一标识</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">zoo.cfg:</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">    tickTime:是initLimit 和 syncLimit的时间单位（毫秒）</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">    initLimit:集群机器之间的同步时间，比如启动m1，s1在这个时间段内必须都起来</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">    syncLimit：leader与follower之间的通信时间（心跳），超时则说明follower失败</font></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#快照日志的存储路径</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">dataDir=/usr/local/program/zk/zkdata</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#zk事物日志存储目录 (如果不配置zkdataLog那么快照日志和事务日志都将写到dataDir中，严重影响性能)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">dataLogDir=/usr/local/program/zk/zkdataLog</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;"># the port at which the clients will connect</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#本台机器的端口，默认为2181</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">clientPort=12181</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">log4j.properties:</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">    日志文件，zookeeper.out位置bin下面，可以更改</font></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">注意：需要定期清理事务日志文件，否则会造成性能下降（crontab）</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">crontab -l查看当前用户定时任务</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">crontab -e编辑定时任务</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">(例：0 0 * * 0 sh /usr/local/program/zk/cleanup.sh)</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">另外2台机器执行同样的操作</font></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">#server.1标识本台机器，通过myid文件指定id=1;ip:机器之间通信端口（默认为2888）:leader选举端口（默认为3888）</font></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;courier new&quot;; line-height: 22px;"><font style="font-size: 10pt;">server.1=192.168.0.102:12888:13888</font></span></div></div></div><div style="font-size: 14px; clear: both; height: 0px; visibility: hidden;"></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html>