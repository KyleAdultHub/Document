---
title: 数据库-Mysql_python交互
date: "2016-06-12 22:00:00"
categories:
- 数据存储
- Mysql
tags:
- Mysql
toc: true
---

<html>
<body>
<div>
<span><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">Mysql_python交互</span></font></div><div><ul><li><span style="font-weight: bold; line-height: 1.45;">Python 中操作DB的步骤</span></li><li><img src="/e_img/e_img/数据库-Mysql_python交互_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="356"/></li><li><span style="font-weight: bold;">使用PyMysql的步骤</span></li><ul><li><span style="font-size: 9pt;">引入模块</span></li><ul><li><span style="font-size: 9pt;">from pymysql import *</span></li></ul><li><span style="font-size: 9pt;">创建Connection 对象</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">作用：</span><span style="font-size: 9pt; line-height: 1.45;">调用connect()方法，创建连接对象，</span><span style="font-size: 9pt; line-height: 1.45;">用于建立与数据库的连接</span></font></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">格式：</span><span style="font-size: 9pt; line-height: 13.6px;">con=connect(参数列表)</span></font></li><li><span style="font-size: 9pt;">con = connect(host=host, port=3306, db='test', user='py', password=pwd, charset='utf8')</span></li><ul><li><span style="font-size: 9pt;">参数host：连接的mysql主机，如果本机是'localhost'</span></li><li><span style="font-size: 9pt;">参数port：连接的mysql主机的端口，默认是3306</span></li><li><span style="font-size: 9pt;">参数database/db：数据库的名称 两者等价</span></li><li><span style="font-size: 9pt;">参数user：连接的用户名</span></li><li><span style="font-size: 9pt;">参数password：连接的密码</span></li><li><span style="font-size: 9pt;">参数charset：通信采用的编码方式，推荐使用utf8, 默认不是utf8编码</span></li></ul><li><span style="font-size: 9pt; line-height: 13.6px;">con对象的方法：</span></li><ul><li><span style="font-size: 9pt;">close()关闭连接</span></li><li><span style="font-size: 9pt;">commit()提交 connect默认是不自动提交事务的</span></li><li><span style="font-size: 9pt;">cursor()返回Cursor对象，用于执行sql语句并获得结果</span></li></ul></ul><li><span style="font-size: 9pt;">创建Cursor对象</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">作用：</span><span style="font-size: 9pt; line-height: 13.6px;">用于执行sql语句，使用频度最高的语句为select、insert、update、delete，需要主要cursor对象不线程安全的，如果用多线程来同时操作多个cursor对象会造成资源竞争，产生阻塞；</span></font></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">获取格式：</span><span style="font-size: 9pt; line-height: 13.6px;">cur = con.cursor()</span></font></li><li><span style="font-size: 9pt;">Cursor对象的方法：</span></li><ul><li><span style="font-size: 9pt;">close()关闭</span></li><li><span style="font-size: 9pt;">execute(operation ，[ parameters（默认为空） ])执行语句，返回受影响的行数，主要用于执行insert、update、delete    （返回值是影响的行数）</span></li><li><span style="font-size: 9pt;">语句，也可以执行create、alter、drop等语句</span></li><li><span style="font-size: 9pt;">fetchone()执行查询语句时，获取查询结果集的第一个行数据，返回一个元组</span></li><li><span style="font-size: 9pt;">fetchall()执行查询时，获取结果集的所有行，一行构成一个元组，再将这些元组装入一个元组返回</span></li></ul><li><span style="font-size: 9pt;">Cursor对象的属性</span></li><ul><li><span style="font-size: 9pt;">rowcount只读属性，表示最近一次execute()执行后受影响的行数</span></li><li><span style="font-size: 9pt;">connection获得当前连接对象</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 13.6px;">执行mysql语句</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">cur.<span style="font-size: 9pt; line-height: 13.6px;">execute(<span style="font-size: 9pt; line-height: 13.6px;">operation ，[ parameters（默认为空） ])</span></span></span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">openration 为执行语句， parameters为语句所需要的参数；</span></font></li><li><span style="font-size: 9pt; line-height: 13.6px;">注意：</span></li><ul><li><span style="font-size: 9pt;">execute参数化数据时 只支持%s的数据  如果占位符有%d 则会解析出错，所以在使用excute的时候都要用字符串来占位。当使用参数化的时候，用%s来站位，当不使用参数化的时候用‘%s’来占位；</span></li></ul><li><span style="font-size: 9pt; line-height: 13.6px;">例子：</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">sql = &quot;select * from user_info where user_name='%s' and user_pass='%s'&quot; % (uname, u</span><span style="font-size: 9pt; line-height: 1.45;">pass)</span></font></li><li><span style="font-size: 9pt;">row_count = cur.execute(sql)</span></li></ul></ul></ul><li><span style="font-size: 9pt; line-height: 13.6px;">提交操作</span></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">con.commit()  不提交会默认rollback</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">关闭Cursor对象，关闭Connection对象</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">close()</span></li></ul></ul></ul></div><div><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">SQL注入问题</span></span></font></div><div><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">什么是SQL注入问题：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">SQL语句的字符串直接拼接会引起SQL注入等安全问题。</span></li></ul><li><span style="font-size: 9pt; font-weight: bold;">会产生SQL问的的情景</span></li><ul><li><span style="font-size: 9pt;"><img src="/e_img/e_img/数据库-Mysql_python交互_files/Image [1].png" type="image/png" data-filename="Image.png" width="621"/></span></li><li><span style="font-size: 9pt;">产生问题原因：</span></li><ul><li><span style="font-size: 9pt;">因为#为注释的意思</span></li><li><span style="font-size: 9pt;">当拼接内容为如下的时候,不管用户用户密码输入什么都不需要考虑，都会默认输入有效</span></li><ul><li><span style="font-size: 9pt;">itheima'#</span></li><li><span style="font-size: 9pt;">itheima' or 1=1 or '</span></li></ul><li><span style="font-size: 9pt; line-height: 13.6px;">这样就因为字符创拼接导致了数据库操作的漏洞</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">解决方法（参数化）</span></font></li><ul><li><span style="font-size: 9pt;">sql语句的参数化，可以有效防止sql注入</span></li><ul><li><span style="font-size: 9pt;">注意：此处不同于python的字符串格式化，全部使用%s占位</span></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">例：</span></li><li><span style="font-size: 9pt;"><img src="/e_img/e_img/数据库-Mysql_python交互_files/Image [2].png" type="image/png" data-filename="Image.png" width="485"/></span></li></ul><li><span style="font-size: 9pt;">这样excute方法内部会自动对参数进行处理，防止因为字符串拼接造成的问题；</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">其原理是执行execute的时候在内部调用了</span><span style="font-size: 9pt; line-height: 13.6px;">mogrify（）方法</span><span style="font-size: 9pt; line-height: 13.6px;">先进行了</span><span style="font-size: 9pt; line-height: 13.6px;">mogrify转化，再进行语句的execute。</span></font></li></ul></ul></ul></ul></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html>