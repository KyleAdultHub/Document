---
title: 数据库-select查询
date: "2016-06-04 22:00:00"
categories:
- 数据存储
- Mysql
tags:
- Mysql
toc: true
---

<html>
<body>
<div>
<span><div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">数据库的查询</span></font></div><ul><li><span style="font-size: 9pt; font-weight: bold;">查询数据表信息( 基本格式</span><span style="font-size: 9pt;">)</span></li><ul><li><span style="font-size: 9pt;">SELECT  */col1,... [as &quot;别名&quot;]</span><span style="font-size: 9pt; font-weight: bold;">(显示字段)</span> <span style="font-size: 9pt;"> FROM table_name </span><span style="font-size: 9pt;">[as &quot;别名&quot;]</span><span style="font-size: 9pt;">（</span><span style="font-size: 9pt; font-weight: bold;">数据来源</span><span style="font-size: 9pt;">） [WHERE  condition</span><span style="font-size: 9pt; font-weight: bold;">（搜索条件）</span><span style="font-size: 9pt;">]  </span><span style="font-size: 9pt; font-weight: bold;">（其他条件）</span><span style="font-size: 9pt;">;</span></li><ul><li><span style="font-size: 9pt;">[ ]内容更可以根据需要选择</span></li><li><span style="font-size: 9pt;">table_name 可以用database_name.table_name 来表示</span></li></ul></ul><li><span style="font-size: 9pt; font-weight: bold;">对显示字段的拓展</span></li><ul><li><span style="font-size: 9pt;">distinct 消除重复行</span></li><ul><li><span style="font-size: 9pt;">实例：select distinct 字段1,... from 表;</span></li><li><span style="font-size: 9pt;">作用：在对应的字段前面加上distinct可以消除字段信息的重复内容</span></li></ul><li><span style="font-size: 9pt;">聚合函数</span></li><ul><li><span style="font-size: 9pt;">作用：为了快读得到统计数据；</span></li><li><span style="font-size: 9pt;">count 总数的统计</span></li><ul><li><span style="font-size: 9pt;">示例：select count(*/列名) from students;</span></li><ul><li><span style="font-size: 9pt;">如果填列名count只统计非空的数据行</span></li></ul></ul><li><span style="font-size: 9pt;">max 最大值的统计</span></li><ul><li><span style="font-size: 9pt;">示例：select max(id) from students where gender=2;</span></li></ul><li><span style="font-size: 9pt;">min 最小值的统计</span></li><ul><li><span style="font-size: 9pt;">示例：select min(id) from students where isdelete=0;</span></li></ul><li><span style="font-size: 9pt;">sum 对列进行求和：</span></li><ul><li><span style="font-size: 9pt;">示例：select sum(age)/count(*) from students where gender=1;</span></li></ul><li><span style="font-size: 9pt;">avg 对列平均值计算</span></li><ul><li><span style="font-size: 9pt;">示例：select avg(id) from students where is_delete=0 and gender=2</span></li></ul></ul></ul><li><span style="font-size: 9pt; font-weight: bold;">对搜索条件的拓展</span></li><ul><li><span style="font-size: 9pt;">where  对字段内容进行筛选   （是对从表中获取的原始数据进行筛选）</span></li><ul><li><span style="font-size: 9pt;">作用：通过对字段内容限制，对符合条件的字段进行筛选；</span></li><li><span style="font-size: 9pt;">where 配合运算符筛选</span></li><ul><li><span style="font-size: 9pt;">实例：select * from students where id=1;</span></li><ul><li><span style="font-size: 9pt;">备注：where 后面支持多种运算符 =/&gt;/&gt;=/!=/&lt;&gt;/and/or/not（优先级:and&gt;or） 等等</span></li></ul></ul><li><span style="font-size: 9pt;">like  模糊查询</span></li><ul><li><span style="font-size: 9pt;">实例：select * from students where name like '王%';</span></li><ul><li><span style="font-size: 9pt;">备注：% 表示任意多个任意字符；  _表示一个任意字符；</span></li></ul></ul><li><span style="font-size: 9pt;">in/between  范围查询    （只限于数字类型）</span></li><ul><li><span style="font-size: 9pt;">作用：对在限定范围内的字段进行筛选</span></li><li><span style="font-size: 9pt;">in 范围查询</span></li><ul><li><span style="font-size: 9pt;">实例：select * from students where id in(1,3,8);</span></li><ul><li><span style="font-size: 9pt;">备注：括号中的内容不能用“-”来表示范围，必须要指定包含的数字；</span></li></ul></ul><li><span style="font-size: 9pt;">between ..and..范围查询</span></li><ul><li><span style="font-size: 9pt;">实例：select * from students where id between 3 and 8;</span></li></ul></ul><li><span style="font-size: 9pt;">is null 空判断</span></li><ul><li><span style="font-size: 9pt;">作用：对字段内容为空/非空的进行筛选；</span></li><li><span style="font-size: 9pt;">is null  判断为空</span></li><ul><li><span style="font-size: 9pt;">select * from students where height is null;</span></li></ul><li><span style="font-size: 9pt;">is not null 判断为非空；</span></li><ul><li><span style="font-size: 9pt;">select * from students where height is not null;</span></li></ul></ul></ul><li><span style="font-size: 9pt;">group by  分组</span></li><ul><li><span style="font-size: 9pt;">作用：将查询结果按照1个或多个字段进行分组，字段值相同的为一组</span></li><li><span style="font-size: 9pt;">group by 单独使用</span></li><ul><li><span style="font-size: 9pt;">示例：select gender from students group by gender;</span></li><ul><li><span style="font-size: 9pt;">备注：</span></li><ul><li><span style="font-size: 9pt;">当group by单独使用时，实际意义不大。</span></li><li><span style="font-size: 9pt; line-height: 13.6px;">group by 后边可以接多个字段，表示按照第一个条件分完组后再按照字段二的要求来进行分组；</span></li></ul></ul></ul><li><span style="font-size: 9pt;">group by + group_concat()   配合显示字段来使用</span></li><ul><li><span style="font-size: 9pt;">作用：表示分组之后，根据分组结果，使用group_concat()来放置每一组的某字段的值的集合</span></li><li><span style="font-size: 9pt;">示例：select gender,group_concat(name) from students group by gender;</span></li><ul><li><span style="font-size: 9pt;">会显示gender不同的每个分组下，对应的所有的名字信息</span></li></ul></ul><li><span style="font-size: 9pt;">group by +聚合函数     （计算的是每个组中的集合的运算结果）</span></li><ul><li><span style="font-size: 9pt;">作用：既然可以统计出每个分组的某字段的值的集合，那么我们也可以通过集合函数来对每个组值得集合做一些操作；</span></li><li><span style="font-size: 9pt;">示例：select gender,avg(age) from students group by gender;</span></li><ul><li><span style="font-size: 9pt;">注意：和之前的不同在于这里是在没个组内进行对应的计算并输出结果显示 </span></li></ul></ul><li><span style="font-size: 9pt;">group by + having  （having表示对group 后的结构进行的筛选 ， 与where筛选的内容是不一样的）</span></li><ul><li><span style="font-size: 9pt;">作用：用来分组查询后指定一些条件来输出查询结果</span></li><li><span style="font-size: 9pt;">示例：select gender,count(*) from students group by gender having count(*)&gt;2；</span></li><ul><li><span style="font-size: 9pt;">备注：这里只会显示组内原元素个数总和大于2的组</span></li></ul></ul><li><span style="font-size: 9pt;">group by + with rollup</span></li><ul><li><span style="font-size: 9pt;">作用：在最后新增一行，</span><span style="font-size: 9pt;">可以得到每个分组的汇总级别的数据</span><span style="font-size: 9pt;">，表头为null</span></li><li><span style="font-size: 9pt;">示例：select gender,group_concat(age) from students group by gender with rollup;</span></li></ul></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">其他条件的扩展</span></font></li><ul><li><span style="font-size: 9pt;">order by  对数据进行排序</span></li><ul><li><span style="font-size: 9pt;">作用：为了方便查看数据的排列情况，方便对数据的查看</span></li><li><span style="font-size: 9pt;">格式：select * from 表名 order by 字段1 asc|desc [,字段2 asc|desc,...]</span></li><li><span style="font-size: 9pt;">示例：select * from students where gender=1 and is_delete=0 order by id desc；</span></li><ul><li><span style="font-size: 9pt;">备注：</span></li><ul><li><span style="font-size: 9pt;">默认为asc从小到大排列，即升序/ desc从大到小排序，即降序</span></li><li><span style="font-size: 9pt;">先按照字段一进行排列，当某些行列的值相同的时候，按照2的规则进行排序</span></li></ul></ul></ul><li><span style="font-size: 9pt;">limit  获取部分行</span></li><ul><li><span style="font-size: 9pt;">作用：当数据量过大时，在一页中查看数据是一件非常麻烦的事情</span></li><li><span style="font-size: 9pt;">语法：select * from 表明 limit （start）,（count）</span></li><ul><li><span style="font-size: 9pt;">备注：从start下一条开始，获取count条数据</span></li></ul><li><span style="font-size: 9pt;">示例：select * from students where is_delete=0 limit (n-1)*m,m</span></li><ul><li><span style="font-size: 9pt;">每页显示m条内容，n为显示第几页</span></li></ul></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">对数据来源进行拓展（也可用于其他操作）</span></font></li><ul><li><span style="font-size: 9pt;">作用：当查询结果的列来源于多张表时，需要将多张表连接成一个大的数据集，再选择合适的列返回</span></li><li><span style="font-size: 9pt; font-weight: bold;">外链接/内连接</span></li><ul><li><span style="font-size: 9pt;">inner join内连接查询（显示进行连接的两表匹配的数据）</span></li><ul><li><span style="font-size: 9pt;">格式：select  *  from  表1  inner  join  表2  on  表1.列名 = 表2.列名</span></li><ul><li><span style="font-size: 9pt;">会把表二中和表一 对应字段相同的其他字段的数据和表一的数据集成一个大数据</span></li></ul></ul><li><span style="font-size: 9pt;">left join左连接外连接（在内连接的基础上添加外部数据行）</span></li><ul><li><span style="font-size: 9pt;">格式：select  *  from  表1  left  join  表2  on  表1.列名 = 表2.列名</span></li><ul><li><span style="font-size: 9pt;">查询的结果为两个表匹配到的数据，左表特有的数据，对于右表中不存在的数据使用null填充</span></li></ul></ul><li><span style="font-size: 9pt;">right join右连接外连接（在内连接的基础上添加外部数据行）</span></li><ul><li><span style="font-size: 9pt;">格式：select  *  from  表1  right  join  表2  on  表1.列名 = 表2.列名</span></li><ul><li><span style="font-size: 9pt;">查询的结果为两个表匹配到的数据，右表特有的数据，对于左表中不存在的数据使用null填充</span></li></ul></ul><li><span style="font-size: 9pt;">为了查询简单经常给表起别名</span></li><ul><li><span style="font-size: 9pt;">例子：select  s.name,  c.name  from  students  as  s  inner  join  classes  as  c  on  s.cls_id = c.id;</span></li></ul><li><span style="font-size: 9pt;">连表查询</span><span style="font-size: 9pt; font-weight: bold;">数据处理</span><span style="font-size: 9pt;">的步骤</span></li><ul><li><span style="font-size: 9pt;">1 from  students  as  s  （获取主表的数据）</span></li><li><span style="font-size: 9pt;">2  inner  join  classes  as  c  （与外链接表做笛卡尔积）</span></li><li><span style="font-size: 9pt;">3  on  s.cls_id = c.id   （设置外链接条件，对笛卡尔积结果进行过滤）</span></li></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">自关联（自连接）</span></font></li><ul><li><span style="font-size: 9pt;">自关联定义：一个表中的一个字段关联着本表的其他行，就是自关联</span></li><li><span style="font-size: 9pt;">自关联也可以进行自连查询</span></li><ul><li><span style="font-size: 9pt;">例子：</span></li><ul><li><span style="font-size: 9pt;">select city.* from areas as city</span></li><li><span style="font-size: 9pt;">inner join areas as province on city.pid=province.aid</span></li><li><span style="font-size: 9pt;">where province.atitle='地名';</span></li></ul></ul></ul></ul></ul><div style="font-size: 12px;"><div><br/></div></div><div><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">子查询</span></div><div><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">概念：</span></font></li><ul><li><span style="font-size: 9pt;">在一个 select 语句中,嵌入了另外一个 select 语句, 那么被嵌入的 select 语句称之为子查询语句</span></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">注意select语句只能嵌套select查询语句，其他语句例如update，delete等，不能嵌套select 语句</span></li></ul></ul><li><span style="font-size: 9pt; font-weight: bold;">主查询和子查询的关系</span></li><ul><li><span style="font-size: 9pt;">子查询是嵌入到主查询中</span></li><li><span style="font-size: 9pt;">子查询是辅助主查询的,要么充当条件,要么充当数据源</span></li><li><span style="font-size: 9pt;">子查询是可以独立存在的语句,是一条完整的 select 语句</span></li></ul><li><span style="font-size: 9pt; font-weight: bold;">子查询分类</span></li><ul><li><span style="font-size: 9pt;">标量子查询: 子查询返回的结果是一个数据(一行一列)</span></li><li><span style="font-size: 9pt;">列子查询: 返回的结果是一列(一列多行)</span></li><li><span style="font-size: 9pt;">行子查询: 返回的结果是一行(一行多列)</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">常见的查询示例</span></font></li><ul><li><span style="font-size: 9pt;">标量子查询</span></li><ul><li><span style="font-size: 9pt;">select * from students where age &gt; (select avg(age) from students);</span></li></ul><li><span style="font-size: 9pt;">列级子查询</span></li><ul><li><span style="font-size: 9pt;">select name from classes where id in (select cls_id from students);</span></li></ul><li><span style="font-size: 9pt;">行级子查询</span></li><ul><li><span style="font-size: 9pt;">select * from students where (height,age) = (select max(height),max(age) from students);</span></li></ul></ul></ul><div><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">总结：命令的执行顺序</span></span></font></div></div><div><ul><li><span style="font-size: 9pt; font-weight: bold;">完整的select语句</span></li><ul><li><span style="font-size: 9pt;">select distinct *</span></li><li><span style="font-size: 9pt;">from 表</span></li><li><span style="font-size: 9pt;">where ....</span></li><li><span style="font-size: 9pt;">（group by ... having ...）</span></li><li><span style="font-size: 9pt;">order by ...</span></li><li><span style="font-size: 9pt;">limit start,count</span></li></ul><li><span style="font-size: 9pt; font-weight: bold;">执行顺序为：</span></li><ul><li><span style="font-size: 9pt;">from 表名 从哪个表中取出数据</span></li><li><span style="font-size: 9pt;">where .... 取出符合什么条件的记录</span></li><li><span style="font-size: 9pt;">group by ... 根据哪个字段进行分组</span></li><li><span style="font-size: 9pt;">having ... 分组条件设定</span></li><li><span style="font-size: 9pt;">select distinct 选择上一步产生的数据中的指定属性 distinct表示去重</span></li><li><span style="font-size: 9pt;">order by ... 根据指定属性进行排序 ASC DESC</span></li><li><span style="font-size: 9pt;">limit start,count 取出指定位置的数据</span></li><ul><li><span style="font-size: 9pt;">实际使用中，只是语句中某些部分的组合，而不是全部</span></li></ul></ul></ul></div><div><br/></div><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html>