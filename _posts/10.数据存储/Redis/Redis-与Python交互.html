---
title: Redis-与Python交互
date: "2016-05-15 22:00:00"
categories:
- 数据存储
- Redis
tags:
- Redis
toc: true
---

<html>
<body>
<div>
<span><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 1.45;-evernote-highlight:true;">python中的redis操作</span></font></span></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">安装redis模块（用来和redis数据库进行数据交互）</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">安装模块</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pip install redis</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">注意：</span><span style="font-size: 9pt; line-height: 1.45;">要进入虚拟环境</span></font></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">python如何使用redis模块（简单操作示例）</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">创建sr对象（用来和数据库通信）</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">进入python解释器</span></li><ul><li><span style="font-size: 9pt;">workon py_django</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">导入模块</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">from redis import *</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">定义对象</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr = StrictRedis(host='localhost', port=6379, db=0)</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">简写：sr=StrictRedis()</span><span style="font-size: 9pt; line-height: 1.45;">     </span><span style="font-size: 9pt; line-height: 1.45;">host默认为localhost，port默认为6379，db默认为0</span><span style="font-size: 9pt; line-height: 1.45;"> </span></font></li></ul></ul></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">sc模块针对不同类型数据的方法</span></font></li><ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">keys</span></span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">exists、</span><span style="font-size: 9pt; line-height: 1.45;">type、</span><span style="font-size: 9pt; line-height: 1.45;">delete、</span><span style="font-size: 9pt; line-height: 1.45;">expire、</span><span style="font-size: 9pt; line-height: 1.45;">getrange、</span><span style="font-size: 9pt; line-height: 1.45;">ttl<span style="font-size: 9pt; line-height: 1.45;">、keys</span></span></font></li></ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">string</span></span></li><ul><li><font style="font-size: 9pt;"><span style="letter-spacing: 0.2px; orphans: 3; widows: 3; font-size: 9pt; color: rgb(51, 51, 51); line-height: 1.45;">set、</span><span style="letter-spacing: 0.2px; orphans: 3; widows: 3; font-size: 9pt; color: rgb(51, 51, 51); line-height: 1.45;">setex</span><span style="letter-spacing: 0.2px; orphans: 3; widows: 3; font-size: 9pt; color: rgb(51, 51, 51); line-height: 1.45;">、mset</span><span style="font-size: 9pt; line-height: 1.45;">、append</span><span style="font-size: 9pt; line-height: 1.45;">、get</span><span style="font-size: 9pt; line-height: 1.45;">、mget</span></font></li></ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">hash</span></span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">hset、</span><span style="font-size: 9pt; line-height: 1.45;">hmset、</span><span style="font-size: 9pt; line-height: 1.45;">hkeys、</span><span style="font-size: 9pt; line-height: 1.45;">hget、</span><span style="font-size: 9pt; line-height: 1.45;">hmget、</span><span style="font-size: 9pt; line-height: 1.45;">hvals、</span><span style="font-size: 9pt; line-height: 1.45;">hdel</span></font></li></ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">list</span></span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">lpush、</span><span style="font-size: 9pt; line-height: 1.45;">rpush、</span><span style="font-size: 9pt; line-height: 1.45;">linsert、</span><span style="font-size: 9pt; line-height: 1.45;">lrange、</span><span style="font-size: 9pt; line-height: 1.45;">lset、</span><span style="font-size: 9pt; line-height: 1.45;">lrem</span></font></li></ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">set</span></span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">sadd、</span><span style="font-size: 9pt; line-height: 1.45;">smembers、</span><span style="font-size: 9pt; line-height: 1.45;">srem</span></font></li></ul><li><span style="letter-spacing: 0.2px; orphans: 3; widows: 3;"><span style="font-size: 9pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.45;">zset</span></span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">zadd、</span><span style="font-size: 9pt; line-height: 1.45;">zrange、</span><span style="font-size: 9pt; line-height: 1.45;">zrangebyscore、</span><span style="font-size: 9pt; line-height: 1.45;">zscore、</span><span style="font-size: 9pt; line-height: 1.45;">zrem、</span><span style="font-size: 9pt; line-height: 1.45;">zremrangebyscore</span></font></li></ul></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">string常见方法</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">字符串常见方法：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">设置一个值：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.set('hello', 'world')</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;"> 添加或者修改成功会返回True</span></li></ul></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取一个值：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.get('hello')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">给key追加内容：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.append('hello','/')</span><span style="font-size: 9pt; line-height: 1.45;">                    </span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">设置过期时间：sr.setex('k','v',10)</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">查看剩余时间：sr.ttl('key')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">设置多个值：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.mset(k1='v1', k2='v2')</span></li><li><span style="font-size: 9pt; line-height: 1.45;">sr.mset({'k1':'v1', 'k1':'v1'})</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取多个值：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.mget('k1','k2')</span></li><li><span style="font-size: 9pt; line-height: 1.45;">sr.mget(['k1','k2'])</span></li></ul></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">hash常见方法：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">设置key的单个键值对</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hset('key_name', 'key', 'value')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">设置key的多个键值对</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hmset('key_name', {'k1': 'v1', 'k2': 'v2'})</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的某个键的值</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hget('key_name','k2')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的多个键的值</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hmget('key_name',['k1', 'k2'])</span></li><li><span style="font-size: 9pt; line-height: 1.45;">sr.hmget('key_name','k1', 'k2')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的所有键的值</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hgetall('key_name')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的所有键</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.hkeys('key_name')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的所有值</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">sr.hvals('key_name')</span><span style="font-size: 9pt; line-height: 1.45;">           </span></font></li></ul></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">list列表常用方法</span><span style="line-height: 1.45;">：</span></li><ul><li><span style="font-size: 9pt;">从列表中弹出一个值</span></li><ul><li style="orphans: 2; widows: 2;"><font style="font-size: 9pt;"><span style="white-space: pre; font-size: 9pt; line-height: 12.8px;">sr.blpop([&quot;key_name&quot;])</span></font></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">列表左侧添加列表</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.lpush('liebiao', 'v1','v2','v3')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">列表右侧添加列表</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.rpush('liebiao', 'v4','v5','v6')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">列表v4前面添加一个值</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.linsert('liebiao','BEFORE','v4','cc')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">列表v5后面添加一个值</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.linsert('liebiao','after','v5','dd')</span></li><li><span style="font-size: 9pt; line-height: 1.45;">注意：</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">after和before 大小写无所谓</span></li></ul></ul><li><span style="font-size: 12px;">获取列表的长度</span></li><ul><li><span style="font-size: 12px;">sr.llen('liebiao')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">列表查看数据</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">sr.lrange('liebiao','0','-1')</span><span style="font-size: 9pt; line-height: 1.45;">                    </span></font></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">set常见操作</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">设置一个key</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.sadd('set_name', 'ziduan')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key的属性</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">sr.smembers('set_name')</span><span style="font-size: 9pt; line-height: 1.45;">             </span></font></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">sorted set常见操作：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">设置一个key</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">sr.zadd('sorted_name','n1',11,'n2',22)</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">获取key所有的数据</span></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">sr.zrange('sorted_name', 0, -1)</span><span style="font-size: 9pt; line-height: 1.45;">          </span></font></li></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 1.45;-evernote-highlight:true;">django项目使用redis</span></font></span></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">简单说明</span></font></li><ul><li><span style="font-size: 9pt;">之前django的session默认是存在的数据库里面的，我们也可以把session存储在redis里面</span></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">安装模块</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">pip install django-redis-sessions==0.5.6</span></li><ul><li><span style="font-size: 9pt;">不要不指定版本，不指定版本的话会默认安装一个比较古老的版本</span></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">配置django的redis内容</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">SESSION_ENGINE = 'redis_sessions.session'</span></li><li><span style="font-size: 9pt; line-height: 1.45;">SESSION_REDIS_HOST = 'localhost'</span></li><li><span style="font-size: 9pt; line-height: 1.45;">SESSION_REDIS_PORT = 6379</span></li><li><span style="font-size: 9pt; line-height: 1.45;">SESSION_REDIS_DB = 2</span></li><li><span style="font-size: 9pt; line-height: 1.45;">SESSION_REDIS_PASSWORD = &quot; &quot;</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">SESSION_REDIS_PREFIX = 'session_project'</span><span style="font-size: 9pt; line-height: 1.45;">            </span></font></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">定义view函数：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">def session_set(request):</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">request.session['name']='itheima'</span></li><li><span style="font-size: 9pt; line-height: 1.45;">return HttpResponse('ok')</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">def session_get(request):</span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">name=request.session['name']</span></li></ul><li><span style="font-size: 9pt; line-height: 1.45;">return HttpResponse(name)</span></li></ul><li><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">定义路由配置规则  </span> <span style="line-height: 1.45;">     </span></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">url(r'^session_set/$',views.session_set),</span></li><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">url(r'^session_get/$', views.session_get),</span><span style="font-size: 9pt; line-height: 1.45;">            </span></font></li></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 1.45;">检查效果：</span></font></li><ul><li><span style="font-size: 9pt; line-height: 1.45;">redis  -cli</span></li><li><span style="font-size: 9pt; line-height: 1.45;">select   2</span></li><li><span style="font-size: 9pt; line-height: 1.45;">keys  *</span></li><li><span style="font-size: 9pt; line-height: 1.45;">get  key_name</span></li><li><span style="font-size: 9pt; line-height: 1.45;">echo  &quot;value&quot;  |  base64  -d</span></li></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">Redis事务</span></font></span></div></div><div><ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">redis使用事务的步骤</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">使用redis的管道操作</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">pipeline = redis_store.pipeline()</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">开启事务操作</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">pipeline.multi()</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">进行数据操作</span></font></li><ul><li><span style="font-size: 9pt; line-height: 13.6px;">pipeline.hset(redis_key, p, data)</span></li></ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">对事物进行提交操作</span></font></li><ul><li><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">pipeline.execute()</span></font></li></ul></ul><li><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">示例</span></font></li><ul><li><img src="/e_img//e_img/Redis-与Python交互_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="443"/></li></ul></ul><div><b><font color="#328712" style="background-color: rgb(255, 250, 165); font-size: 14pt;-evernote-highlight:true;">使用连接池，向redis中插入和取出数据</font></b></div></div><div><ul><li>示例：</li><ul><li><img src="/e_img//e_img/Redis-与Python交互_files/Image [1].png" type="image/png" data-filename="Image.png" width="525"/></li></ul></ul></div><div><br/></div></span>
</div></body></html>