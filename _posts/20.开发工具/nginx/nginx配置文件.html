---
title: nginx配置文件
date: "2017-07-27 22:00:00"
categories:
- 开发工具
- nginx
tags:
- nginx
toc: true
---

<html>
<body>
<div>
<span><div><font face="Arial"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Arial">user nobody;    <span style="font-size: 9pt; color: rgb(51, 51, 51);">#运行用户</span><br/></font></div><div><font face="Arial">worker_processes  1;    <span style="font-size: 9pt; color: rgb(51, 51, 51);">#启动进程,通常设置成和cpu的数量相等</span></font></div><div><font face="Arial">#全局错误日志及PID文件</font></div><div><font face="Arial">#error_log  logs/error.log;</font></div><div><font face="Arial">#error_log  logs/error.log  notice;</font></div><div><font face="Arial">#error_log  logs/error.log  info;</font></div><div><font face="Arial">#pid        logs/nginx.pid;</font></div><div><font face="Arial">#工作模式及连接数上限</font></div><div><font face="Arial">events {</font></div><div><font face="Arial">    <span style="font-size: 9pt; color: rgb(51, 51, 51);">accept_mutex on;   #设置网路连接序列化，防止惊群现象发生，默认为on</span></font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial">    multi_accept on;  #设置一个进程是否同时接受多个网络连接，默认为off</font></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial">    #use epoll;      #事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport</font></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial">    worker_connections  1024;    #最大连接数，默认为512</font></span></div><div><font face="Arial">}</font></div><div><font face="Arial">http {</font></div><div><font face="Arial">    include    mime.types;     <span style="font-size: 9pt; color: rgb(51, 51, 51);">#设定mime类型,类型由mime.type文件定义  </span><span style="font-size: 9pt; color: rgb(51, 51, 51);">文件扩展名与文件类型映射表</span></font></div><div><font face="Arial">    default_type  application/octet-stream;</font></div><div><font face="Arial">    #设定日志格式</font></div><div><font face="Arial">    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</font></div><div><font face="Arial">                      '$status $body_bytes_sent &quot;$http_referer&quot; '</font></div><div><font face="Arial">                      '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';</font></div><div><font face="Arial">    access_log  logs/access.log  main;   <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 服务日志 </span></font></div><div><font face="Arial">    sendfile     on;  <span style="font-size: 9pt; color: rgb(51, 51, 51);">#允许sendfile方式传输文件，默认为off，可以在http块，server块，location块</span></font></div><div><font face="Arial">    # tcp_nopush     on;    # 按照大小发送数据包,不是按照请求</font></div><div><font face="Arial">    keepalive_timeout  65;  <span style="font-size: 9pt; color: rgb(51, 51, 51);">#连接超时时间</span></font></div><div><font face="Arial">    tcp_nodelay     on;    # 按照请求发送数据包</font></div><div><font face="Arial">    gzip  on;   <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 开启gzip压缩</span></font></div><div><font face="Arial">    gzip_disable &quot;MSIE [1-6].&quot;;   # 不给IE6 Gzip</font></div><div><font face="Arial">    client_header_buffer_size    128k;  # <span style="font-size: 9pt; color: rgb(51, 51, 51);">如果请求头大小大于指定的缓冲区，则使用large_client_header_buffers指令分配更大的缓冲区。</span><span style="font-size: 9pt; color: rgb(51, 51, 51);"> </span></font></div><div><font face="Arial">    large_client_header_buffers  4 128k; # <span style="font-size: 9pt; color: rgb(51, 51, 51);">规定了用于读取大型客户端请求头的缓冲区的最大数量和大小。 这些缓冲区仅在缺省缓冲区不足时按需分配。</span></font></div><div><font face="Arial"><span>    </span><span style="font-size: 9pt; color: rgb(51, 51, 51);">sendfile_max_chunk 100k;  #每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。</span></font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial"><br/></font></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font style="font-family: Arial;"><span>    </span><span style="font-size: 9pt; color: rgb(51, 51, 51);">upstream mysvr {    # 服务集群</span></font></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial">      server 127.0.0.1:7878;</font></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial">      server 192.168.10.121:3333 backup;  #热备</font></span></div><div><font face="Arial"><span style="font-size: 9pt; color: rgb(51, 51, 51);"><br/></span><span style="font-size: 9pt; color: rgb(51, 51, 51);">    }</span></font></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial"><span>    </span><span>    </span><br/></font></span></div><div><font face="Arial">    #设定虚拟主机配置<br/></font></div><div><font face="Arial">    server {</font></div><div><font face="Arial">        listen    80;    <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 侦听80端口</span></font></div><div><font face="Arial">        server_name  <span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Arial;">mysvr</span>;    <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 定义使用 <span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Arial;">mysvr </span></span><span style="font-size: 9pt; color: rgb(51, 51, 51);">访问</span></font></div><div><font face="Arial">        root html;    <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 定义服务器的默认网站根目录位置</span></font></div><div><font face="Arial">        access_log  logs/nginx.access.log  main;  <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 设定本虚拟主机的访问日志</span></font></div><div><font style="font-family: Arial;">        </font></div><div><font face="Arial">        location / {   <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># 默认请求</span></font></div><div><font face="Arial">            index index.php index.html index.htm;  <span style="font-size: 9pt; color: rgb(51, 51, 51);"># 定义首页索引文件的名称</span></font></div><div><font face="Arial"><span style="font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);">client_max_body_size 100m;   #  配置请求体最大容量</span></span></font></div><div><br style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span>proxy_set_header Host $http_host;   <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># Host包含客户端真实的域名和端口号；</span></span></div><div><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span>proxy_set_header X-Real-IP $remote_addr;    <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># X-Forwarded-Proto表示客户端真实的协议（http还是https)</span></span></div><div><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span>proxy_set_header REMOTE-HOST $remote_addr;</span></div><div><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;     <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># X-Real-IP表示客户端真实的IP；</span></span></div><div><span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span><span>    </span><span>    </span>proxy_set_header X-Forwarded-Proto $scheme;    <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># X-Forwarded-For这个Header和X-Real-IP类似，但它在多层代理时会包含真实客户端及中间每个代理服务器的IP。</span></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51);"><font face="Arial"><span>    </span><span>    </span><span>    </span><span style="font-size: 9pt; color: rgb(51, 51, 51);">deny 127.0.0.1;  #拒绝的ip</span></font></span></div><div><font face="Arial"><span style="font-size: 9pt; color: rgb(51, 51, 51);"> <span>    </span><span>    </span><span>  </span> allow 172.18.5.54; #允许的ip</span></font></div><div><font face="Arial">        }</font></div><div><font face="Arial">        # 定义错误提示页面</font></div><div><font face="Arial">        error_page   500 502 503 504 /50x.html;</font></div><div><font face="Arial">        location = /50x.html {</font></div><div><font face="Arial">        }</font></div><div><font face="Arial">        #静态文件，nginx自己处理</font></div><div><font face="Arial">        location ~ ^/(images|javascript|js|css|flash|media|static)/ {</font></div><div><font face="Arial">            expires 30d;   <span style="font-family: Arial; font-size: 9pt; color: rgb(51, 51, 51);"># 过期30天，静态文件不怎么更新</span></font></div><div><font face="Arial">        }</font></div><div><font face="Arial">        #禁止访问 .htxxx 文件</font></div><div><font face="Arial">            location ~ /.ht {</font></div><div><font face="Arial">            deny all;</font></div><div><font face="Arial">        }</font></div><div><font face="Arial">    }</font></div><div><font face="Arial">}</font></div></div><div><font face="Arial"><br/></font></div><div><br/></div></span>
</div></body></html>