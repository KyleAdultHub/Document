---
title: Celery构建一个分布式爬虫: 基础篇
date: "2017-06-03 23:00:00"
categories:
- python爬虫
- celery分布式爬虫
tags:
- 爬虫
- celery
toc: true
typora-root-url: ..\..\..
---

<html>
<body>
<div>
<span><div><br/></div><div style="box-sizing: border-box; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><div style="box-sizing: border-box; background-color: rgb(245, 246, 247);"><div style="box-sizing: border-box;"><div style="box-sizing: border-box; box-shadow: rgba(0, 0, 0, 0.0470588) 0px 2px 4px 0px; background-color: rgb(255, 255, 255);"><h1 style="margin: 0px; box-sizing: border-box; padding: 0px 29px;"><span style="font-size: 16pt; color: rgb(44, 48, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-weight: 700; line-height: 38px;">如何构建一个分布式爬虫：基础篇</span></h1><div style="font-size: 16px; box-sizing: border-box; margin: 0px 0px 30px; padding: 20px 30px 0px; overflow: hidden;"><div style="box-sizing: border-box; margin: 0px; padding: 0px; font-size: 16px;"><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">首先，我们新建目录</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">distributedspider</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">，然后再在其中新建文件</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">workers.py</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">,里面内容如下</span></div><div style="word-break: break-all; box-sizing: border-box; border-radius: 0px; border: 0px solid rgb(136, 136, 136); background-color: rgba(128, 128, 128, 0.047); font-size: 14px; word-wrap: break-word; padding: 5px 5px 5px 60px; white-space: nowrap; position: relative; overflow-y: hidden; overflow-x: auto; margin: 0px 0px 1.7em;"><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">from</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">celery</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">import</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">Celery</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">app = Celery(</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'crawl_task'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">, include=[</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'tasks'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">], broker=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'redis://223.129.0.190:6379/1'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">, backend=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'redis://223.129.0.190:6379/2'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">)</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(136, 0, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;"># 官方推荐使用json作为消息序列化方式</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">app.conf.update(</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">CELERY_TIMEZONE=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'Asia/Shanghai'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">CELERY_ENABLE_UTC=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">True</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">CELERY_ACCEPT_CONTENT=[</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'json'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">],</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">CELERY_TASK_SERIALIZER=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'json'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">CELERY_RESULT_SERIALIZER=</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'json'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">)</span></div></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">上述代码主要是做Celery实例的初始化工作，</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">include</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">是在初始化celery app的时候需要引入的内容，主要就是注册为网络调用的函数所在的文件。然后我们再编写任务函数，新建文件</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">tasks.py</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">,内容如下</span></div><div style="word-break: break-all; box-sizing: border-box; border-radius: 0px; border: 0px solid rgb(136, 136, 136); background-color: rgba(128, 128, 128, 0.047); font-size: 14px; word-wrap: break-word; padding: 5px 5px 5px 60px; white-space: nowrap; position: relative; overflow-y: hidden; overflow-x: auto; margin: 0px 0px 1.7em;"><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">import</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">requests</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">from</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">bs4</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">import</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">BeautifulSoup</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">from</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">workers</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">import</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">app</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 102, 102); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">@app.task</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">def</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">crawl</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(102, 0, 102); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">(url)</span><span style="font-size: 90%; background-color: transparent; box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">:</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">print(</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'正在抓取链接{}'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">.format(url))</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">resp_text = requests.get(url).text</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">soup = BeautifulSoup(resp_text,</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'html.parser'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">)</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">return</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">soup.find(</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'h1'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">).text</span></div></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">它的作用很简单，就是抓取指定的url，并且把标签为</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">h1</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">的元素提取出来</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">最后，我们新建文件</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">task_dispatcher.py</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">，内容如下</span></div><div style="word-break: break-all; box-sizing: border-box; border-radius: 0px; border: 0px solid rgb(136, 136, 136); background-color: rgba(128, 128, 128, 0.047); font-size: 14px; word-wrap: break-word; padding: 5px 5px 5px 60px; white-space: nowrap; position: relative; overflow-y: hidden; overflow-x: auto; margin: 0px 0px 1.7em;"><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">from</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">workers</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">import</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">app</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">url_list = [</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/getting-started/introduction.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/getting-started/brokers/index.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/getting-started/first-steps-with-celery.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/getting-started/next-steps.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/getting-started/resources.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/application.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/tasks.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/canvas.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/workers.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/daemonizing.html'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">,</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html'</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">]</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">def</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">manage_crawl_task</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(102, 0, 102); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">(urls)</span><span style="font-size: 90%; background-color: transparent; box-sizing: border-box; margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">:</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">for</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">url</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">in</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">urls:</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">app.send_task(</span><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'tasks.crawl'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">, args=(url,))</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 0, 136); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">if</span> <span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">__name__ ==</span> <span style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 90%; background-color: transparent; color: rgb(0, 136, 0); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">'__main__'</span><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">:</span></div><div style="border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; box-sizing: border-box; background-color: transparent; white-space: pre; font-size: 90%; padding: 0px; overflow-x: auto; word-wrap: normal; background-position: initial initial; background-repeat: initial initial;"><span style="font-size: 90%; background-color: transparent; color: rgb(51, 51, 51); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">manage_crawl_task(url_list)</span></div></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">这段代码的作用主要就是给worker发送任务，任务是</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">tasks.crawl</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">，参数是</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">url</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">(元祖的形式)</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">现在，让我们在节点A(hostname为</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); box-sizing: border-box; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-weight: 400; line-height: 170%;">resolvewang</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">的主机)上启动worker</span></div><blockquote style="box-sizing: border-box; padding: 15px 20px; margin: 0px 0px 1.7em; border-left-width: 10px; border-left-style: solid; border-left-color: rgba(128, 128, 128, 0.0745098); background-color: rgba(128, 128, 128, 0.0470588); border-top-left-radius: 0px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 0px;"><div style="padding: 0px; box-sizing: border-box; margin: 0px; font-size: 1em; word-wrap: break-word; word-break: normal;"><span style="font-size: 1em; background-color: rgba(128, 128, 128, 0.047); color: rgb(111, 111, 111); font-family: &quot;microsoft yahei&quot;; font-weight: 300; line-height: 1.5;">celery -A workers worker -c 2 -l info</span></div></blockquote><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">这里</span> <span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">-c</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">指定了线程数为2，</span> <span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">-l</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">表示日志等级是</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">info</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">。我们把代码拷贝到节点B(节点名为</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); box-sizing: border-box; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-weight: 400; line-height: 170%;">wpm</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">的主机)，同样以相同命令启动worker，便可以看到以下输出</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;"><img src="/e_img/Celery构建一个分布式爬虫：基础篇_files/1240.png" type="image/png" data-filename="1240.png" alt="两个节点" height="443" style="border:0px;vertical-align:middle;outline:0px;box-sizing:border-box;margin-top:15px;margin-bottom:15px;max-width:100%;" width="860"/></span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">可以看到左边节点(A)先是</span><span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">all alone</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">，表示只有一个节点；后来再节点B启动后，它便和B同步了</span></div><blockquote style="box-sizing: border-box; padding: 15px 20px; margin: 0px 0px 1.7em; border-left-width: 10px; border-left-style: solid; border-left-color: rgba(128, 128, 128, 0.0745098); background-color: rgba(128, 128, 128, 0.0470588); border-top-left-radius: 0px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 0px;"><div style="padding: 0px; box-sizing: border-box; margin: 0px; font-size: 1em; word-wrap: break-word; word-break: normal;"><span style="font-size: 1em; background-color: rgba(128, 128, 128, 0.047); color: rgb(111, 111, 111); font-family: &quot;microsoft yahei&quot;; font-weight: 300; line-height: 1.5;">sync with celery@wpm</span></div></blockquote><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">这个时候，我们运行给这两个worker节点发送抓取任务</span></div><blockquote style="box-sizing: border-box; padding: 15px 20px; margin: 0px 0px 1.7em; border-left-width: 10px; border-left-style: solid; border-left-color: rgba(128, 128, 128, 0.0745098); background-color: rgba(128, 128, 128, 0.0470588); border-top-left-radius: 0px; border-top-right-radius: 5px; border-bottom-right-radius: 5px; border-bottom-left-radius: 0px;"><div style="padding: 0px; box-sizing: border-box; margin: 0px; font-size: 1em; word-wrap: break-word; word-break: normal;"><span style="font-size: 1em; background-color: rgba(128, 128, 128, 0.047); color: rgb(111, 111, 111); font-family: &quot;microsoft yahei&quot;; font-weight: 300; line-height: 1.5;">python task_dispatcher.py</span></div></blockquote><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">可以看到如下输出</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;"><img src="/e_img/Celery构建一个分布式爬虫：基础篇_files/1240 [1].png" type="image/png" data-filename="1240.png" alt="分布式抓取示意图" height="351" style="border:0px;vertical-align:middle;outline:0px;box-sizing:border-box;margin-top:15px;margin-bottom:15px;max-width:100%;" width="712"/></span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">可以看到两个节点都在执行抓取任务，并且它们的任务不会重复。我们再在redis里看看结果</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;"><img src="/e_img/Celery构建一个分布式爬虫：基础篇_files/1240 [2].png" type="image/png" data-filename="1240.png" alt="backend示意图" height="258" style="border:0px;vertical-align:middle;outline:0px;box-sizing:border-box;margin-top:15px;margin-bottom:15px;max-width:100%;" width="579"/></span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">可以看到一共有11条结果，说明</span> <span style="font-size: 90%; background-color: rgba(128, 128, 128, 0.075); border-radius: 0px; box-sizing: border-box; padding: 2px 4px; white-space: nowrap; color: rgb(63, 63, 63); font-family: &quot;Source Code Pro&quot;, monospace; font-weight: 400; line-height: 170%;">tasks.crawl</span><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">中返回的数据都在db2(backend)中了，并且以json的形式存储了起来，除了返回的结果，还有执行是否成功等信息。</span></div><div style="padding: 0px; box-sizing: border-box; margin: 0px 0px 1.7em; word-wrap: break-word; word-break: normal;"><span style="font-size: 16px; color: rgb(63, 63, 63); font-family: &quot;microsoft yahei&quot;; font-weight: 400; line-height: 170%;">到此，我们就实现了一个很基础的分布式网络爬虫，但是它还不具有很好的扩展性，而且貌似太简单了…下一篇我将以微博数据采集为例来演示如何构建一个稳健的分布式网络爬虫。</span></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html>