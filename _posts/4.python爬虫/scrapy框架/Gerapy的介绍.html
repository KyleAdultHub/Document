---
title: Gearapy的介绍和使用
date: "2017-04-12 10:00:00"
categories:
- python爬虫
- scrapy框架
tags:
- 爬虫
- scrapy
- gerapy
toc: true
typora-root-url: ..\..\..
---

<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/307941 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1802"/>

<div>
<span><div><div><div><font style="font-size: 14pt;"><span style="color: rgb(50, 135, 18); font-size: 14pt; font-weight: bold; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Gerapy的介绍</span></font></div><ul><li><div><span style="font-size: 9pt;">分布式的爬虫部署和管理工具，基于scrapy、scrapyd、scrapyd-API、Django、Vue.js</span></div></li></ul><div><font style="background-color: rgb(255, 250, 165); font-size: 14pt;-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-size: 14pt; font-weight: bold;-evernote-highlight:true;">Gerapy的使用</span></font></div><ul><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">Gerapy的安装</span></font></div></li><ul><li><div><span style="font-size: 9pt;">pip3 install gerapy</span></div></li></ul><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">Gerapy应用步骤</span></font></div></li><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">1.初始化Gerapy</span></font></div></li><ul><li><div><span style="font-size: 9pt;">gerapy init</span></div></li><ul><li><div><span style="font-size: 9pt;">执行完毕之后，本地便会生成一个名字为 gerapy 的文件夹，接着进入该文件夹，可以看到有一个 projects 文件夹，我们后面会用到。</span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">2.初始化数据库</span></font></div></li><ul><li><div><span style="font-size: 9pt;">cd gerapy</span></div></li><li><div><span style="font-size: 9pt;">gerapy migrate</span></div></li><ul><li><div><span style="font-size: 9pt;">会在 gerapy 目录下生成一个 SQLite 数据库，同时建立数据库表。</span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">3.启动Gerapy</span></font></div></li><ul><li><div><span style="font-size: 9pt;">gerapy runserver</span></div></li><ul><li><div><span style="font-size: 9pt;">这样我们就可以看到 Gerapy 已经在 8000 端口上运行了。接下来我们在浏览器中打开 http://localhost:8000/，就可以看到 Gerapy 的主界面了</span></div></li></ul></ul></ul><li><div><font style="font-size: 12pt;"><span style="font-size: 12pt; font-weight: bold;">使用Gerapy管理项目</span></font></div></li><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">主机管理</span></font></div></li><ul><li><div><span style="font-size: 9pt;">我们可以点击左侧 Clients 选项卡，即主机管理页面，添加我们的 Scrapyd 远程服务，点击右上角的创建按钮即可添加我们需要管理的 Scrapyd 服务。</span></div></li><li><div><span style="font-size: 9pt;">需要添加 IP、端口，以及名称，点击创建即可完成添加，点击返回即可看到当前添加的 Scrapyd 服务列表</span></div></li><li><div><span style="font-size: 9pt;">添加主机前后</span></div></li><li><div><span style="font-size: 9pt;">这样我们可以在状态一栏看到各个 Scrapyd 服务是否可用，同时可以一目了然当前所有 Scrapyd 服务列表，另外我们还可以自由地进行编辑和删除。</span></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image.png" type="image/png" data-filename="Image.png" width="603"/></span></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [1].png" type="image/png" data-filename="Image.png" width="605"/></span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">项目管理</span></font></div></li><ul><li><div><span style="font-size: 9pt;">Gerapy 的核心功能当然是项目管理，在这里我们可以自由地配置、编辑、部署我们的 Scrapy 项目，点击左侧的 Projects ，即项目管理选项，我们可以看到如下空白的页面：</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [2].png" type="image/png" data-filename="Image.png" width="585"/></span></div></li></ul><li><div><span style="font-size: 9pt;">将项目拖动到刚才 gerapy 运行目录的 projects 文件夹下，例如我这里写好了一个 Scrapy 项目，这时刷新页面，我们便可以看到 Gerapy 检测到了这个项目，同时它是不可配置、没有打包的</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [3].png" type="image/png" data-filename="Image.png" width="629"/></span></div></li></ul><li><div><span style="font-size: 9pt;">这时我们可以点击部署按钮进行打包和部署，在右下角我们可以输入打包时的描述信息，类似于 Git 的 commit 信息，然后点击打包按钮，即可发现 Gerapy 会提示打包成功，同时在左侧显示打包的结果和打包名称</span></div></li><li><div><span style="font-size: 9pt;">打包成功之后，我们便可以进行部署了，我们可以选择需要部署的主机，点击后方的部署按钮进行部署，同时也可以批量选择主机进行部署，示例如下</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [4].png" type="image/png" data-filename="Image.png" width="527"/></span></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [5].png" type="image/png" data-filename="Image.png" width="566"/></span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">监控任务</span></font></div></li><ul><li><div><span style="font-size: 9pt;">部署完毕之后就可以回到主机管理页面进行任务调度了，任选一台主机，点击调度按钮即可进入任务管理页面，此页面可以查看当前 Scrapyd 服务的所有项目、所有爬虫及运行状态</span></div></li><li><div><span style="font-size: 9pt;">我们可以通过点击新任务、停止等按钮来实现任务的启动和停止等操作，同时也可以通过展开任务条目查看日志详情</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [6].png" type="image/png" data-filename="Image.png" width="583"/></span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">编辑项目</span></font></div></li><ul><li><div><span style="font-size: 9pt;">同时 Gerapy 还支持项目编辑功能，有了它我们不再需要 IDE 即可完成项目的编写，我们点击项目的编辑按钮即可进入到编辑页面，如图所示</span></div></li><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [7].png" type="image/png" data-filename="Image.png"/></span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">CrawlSpider代码自动生成</span></font></div></li><ul><li><div><span style="font-size: 9pt;">在 Scrapy 中，其实提供了一个可配置化的爬虫 CrawlSpider，它可以利用一些规则来完成爬取规则和解析规则的配置，这样可配置化程度就非常高，这样我们只需要维护爬取规则、提取逻辑就可以了。如果要新增一个爬虫，我们只需要写好对应的规则即可，这类爬虫就叫做可配置化爬虫。</span></div></li><li><div><span style="font-size: 9pt;">Gerapy 可以做到：我们写好爬虫规则，它帮我们自动生成 Scrapy 项目代码。</span></div></li><li><div><span style="font-size: 9pt;">我们可以点击项目页面的右上角的创建按钮，增加一个可配置化爬虫，接着我们便可以在此处添加提取实体、爬取规则、抽取规则了，例如这里的解析器，我们可以配置解析成为哪个实体，每个字段使用怎样的解析方式，如 XPath 或 CSS 解析器、直接获取属性、直接添加值等多重方式，另外还可以指定处理器进行数据清洗，或直接指定正则表达式进行解析等等，通过这些流程我们可以做到任何字段的解析。</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [8].png" type="image/png" data-filename="Image.png" width="689"/></span></div></li></ul><li><div><span style="font-size: 9pt;">再比如爬取规则，我们可以指定从哪个链接开始爬取，允许爬取的域名是什么，该链接提取哪些跟进的链接，用什么解析方法来处理等等配置。通过这些配置，我们可以完成爬取规则的设置。</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [9].png" type="image/png" data-filename="Image.png" width="680"/></span></div></li></ul><li><div><span style="font-size: 9pt;">最后点击生成按钮即可完成代码的生成。</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [10].png" type="image/png" data-filename="Image.png" width="630"/></span></div></li></ul><li><div><span style="font-size: 9pt;">生成的代码示例结果如图所示，可见其结构和 Scrapy 代码是完全一致的。</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/Gerapy的介绍_files/Image [11].png" type="image/png" data-filename="Image.png" width="557"/></span></div></li></ul></ul></ul></ul><div><font style="font-size: 9pt;"><br/></font></div></div><div><font style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18);-evernote-highlight:true;"><b>Gerapy新增功能和Docker部署</b></font></div><div>上面的介绍当然都是人家开发好的，下面介绍下我给gerapy增加的很高效的功能</div><ul><li><div>1.项目本地上传</div></li><ul><li><div><img src="/e_img/Gerapy的介绍_files/Image [12].png" type="image/png" data-filename="Image.png"/></div></li><li><div>在project界面增加了选择项目select(需要提前打成zip包),和项目上传(upload)功能，可以直接将本地的项目上传的gerapy， 就不需要手动将代码去放到服务器上了</div></li></ul><li><div>2.批量启动和批量停止</div></li><ul><li><div><img src="/e_img/Gerapy的介绍_files/Image [13].png" type="image/png" data-filename="Image.png"/></div></li><li><div>在schedule界面， 如果想要一次启动多个爬虫进程可以点击run some来一起启动多个，即快速又准确又方便，另外也可以点击爬虫名称后面的stop 批量停止爬虫进程</div></li></ul><li><div>3.docker快速部署</div></li><ul><li><div>这部分去我的dockerhub找我的dockerfile吧</div></li></ul></ul><div><br/></div></div></span>
</div></body></html>