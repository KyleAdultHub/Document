---
title: 数据提取-json/Xpath
date: "2016-12-13 21:00:00"
categories:
- python爬虫
- 爬虫基础
tags:
- 爬虫
toc: true
typora-root-url: ..\..\..
---


<html>
<body>
<div>
<span><div><font style="font-size: 14pt;"><span style="font-size: 14pt; background-color: rgb(255, 250, 165); color: rgb(50, 135, 18); font-weight: bold;-evernote-highlight:true;">数据提取介绍</span></font></div><div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">什么是数据提取</span></font></div></li><ul><li><div><span style="font-size: 9pt;">简单的来说，数据提取就是从响应中获取我们想要的数据的过程</span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">响应数据的分类</span></font></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">非结构化数据：html中的数据</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">没有结构没有规律的数据，避难提取，需要使用正则、XPATH等方法将数据提取出来</span></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">结构化数据：json、xml等</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">数据的格式比较有规律，转化和提取很方便</span></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">数据的处理方法</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">非结构化数据的提取</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">正则表达式、xpath</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">结构化数据</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将响应内容转化为python的字段数据类型，再进行数据的筛选</span></div></li></ul></ul></ul><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><font style="font-size: 14pt;"><span style="background-color: rgb(255, 250, 165); font-size: 14pt; color: rgb(50, 135, 18); font-weight: bold; line-height: 13.6px;-evernote-highlight:true;">数据提取的方法</span></font></span></div></div><div><ul><li><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; line-height: 13.6px;">结构化的数据提取JSON</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">JSON数据的介绍</span></font></div></li><ul><li><div><span style="font-size: 9pt;">JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式，它使得人们很容易的进行阅读和编写。同时也方便了机器进行解析和生成。Json在数据交换中起到了一个载体的作用，承载着相互传递的数据，比如网站前台与后台之间的数据交互。</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">由于把json数据转化为python的字典格式的数据类型比较简单，所以在爬虫的时候，如果能找到返回json数据的url，尽量使用这用url的响应数据；</span></div></li><li><div><img src="/e_img/数据提取 jsonXpath_files/Image.png" type="image/png" data-filename="Image.png" style="font-size: 9pt;" width="171"/></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">json数据类型和python中一些数据类型的对应关系</span></font></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/数据提取 jsonXpath_files/Image [1].png" type="image/png" data-filename="Image.png" width="192"/></span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">怎么找到响应json数据的响应</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">请求手机版的网页，在响应中普遍会使用json数据的响应形式</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">抓包手机app软件</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">json字符串——python字典类型转化方法</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将python数据格式化打印</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">pprint(json_str)</span></font></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将json字符串转化为python风格的字典</span></div></li><ul><li><div><span style="font-size: 9pt;">json.loads(</span><span style="font-size: 9pt; line-height: 13.6px;">json_str</span><span style="font-size: 9pt;">)         </span><span style="font-size: 9pt; line-height: 1.45;">返回json字符串转化后的字典</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">json字符串转化为python的字典类型数据</span></font></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">将python字典数据转化为json字符串</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">json.dumps(python_dict, ensure_ascii=False, indent=4)       返回字典转化后的json字符串</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">把python字典对象转化为json字符串</span></div></li><li><div><span style="font-size: 9pt; line-height: 1.45;">ensure_ascii=Fale  json数据的编码格式默认为ascii，该参数将json的编码格式变为utf-8</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">indent   将json数据格式化，在打印和写入文件的时候，会格式化数据，并且按照规定缩进</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将json类文件对象转化为python字典类对象</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">with open('douban.txt') as f:</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">json.load(f)             </span><span style="font-size: 9pt; line-height: 13.6px;">  返回转化后文件内容</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">将python字典对象转化为json类文件对象：</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">with open('douban.txt') as f:</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">json.dump(f, f, ensure_ascii=False, indent=2)       返回转化后文件内容</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 1.45;">ensure_ascii=False  json数据的编码格式默认为ascii，该参数将json的编码格式变为utf-8</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">indent   将json数据格式化，在打印和写入文件的时候，会格式化数据，并且按照规定缩进</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">备注：</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">当我们读写数据到文件中的时候，具有read()和write()方法的对象就是类文件对象；</span></div></li></ul></ul><li><div><span style="font-size: 9pt; font-weight: bold;">处理json数据常见错误</span></div></li><ul><li><div><span style="font-size: 9pt;">loads的不是纯json字符串</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">处理方法：去数据中对应的位置去寻找错误</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">类似字典的，键值对使用单引号的数据（误以为json数据）</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">处理方法：将对应的单引号都替换成双引号，就变成了json字符串</span></font></div></li></ul></ul></ul><li><div><span style="font-weight: bold; line-height: 13.6px;">非结构化数据提取HTML</span></div></li><ul><li><div><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">怎么找到html的响应</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">先确定我们想要查找的内容</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">在带有html的的响应中进行查找需要寻找的内容，如果存在，我们就需要通过这个响应来提取数据</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">在急速版经常存在html响应</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">通过什么方式提取HTML内容中的数据</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">通过正则表达式了获取HTML页面中的目标数据（这种方法将不进行详细记录，查看正则表达式的笔记）</span></font></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">通过XPATH来获取目标数据</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold;">XPATH/LXML/XML的介绍</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">XML和HTML的区别</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">XML的介绍</span></div></li><ul><li style="orphans: 2; widows: 2;"><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">Extensible Markup Language（可扩展标记语言），</span><span style="font-size: 9pt; line-height: 13.6px;">是一种标记语言，很类似 HTML</span><span style="font-size: 9pt; line-height: 13.6px;">，被设计为传输和存储数据用的一种语言，焦点是数据的内容</span><span style="font-size: 9pt; color: rgb(189, 202, 219); font-family: Georgia, serif; line-height: 13.6px;">；</span></font></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">XML数据的节点结构示例：</span></div></li><ul><li><div><span style="font-size: 9pt;"><img src="/e_img/数据提取 jsonXpath_files/Image [2].png" type="image/png" data-filename="Image.png" width="411"/></span></div></li><li><div><span style="font-size: 9pt;">每个XML标签我们都称之为节点，所有节点之间都有他们之间的关系如上</span></div></li></ul></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">HTML的介绍</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">HyperText Markup Language（超文本标记语言） ，显示数据以及如何更好的显示数据</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">HTML DOM 介绍</span></div></li><ul><li><div><span style="font-size: 9pt;">Document Object Model for HTML (文档对象模型)，通过 HTML DOM，可以访问所有的 HTML 元素，连同它们所包含的文本和属性。可以对其中的内容进行修改和删除，同时也可以创建新的元素。</span></div></li></ul><li><div><span style="font-size: 9pt;">什么是XPATH</span></div></li><ul><li><div><span style="font-size: 9pt;">XPath (XML Path Language) 是一门在 XML/HTMl 文档中查找信息的语言，可用来在 XML/HTML 文档中对元素和属性进行遍历，进行数据的查找。</span></div></li><li><div><span style="font-size: 9pt;">W3School官方文档：</span><a href="http://www.w3school.com.cn/xpath/index.asp" style="font-size: 9pt;">http://www.w3school.com.cn/xpath/index.asp</a></div></li></ul><li><div><span style="font-size: 9pt;">什么是LXML</span></div></li><ul><li><div><span style="font-size: 9pt;">lxml是一款高性能的 Python HTML/XML 解析器，我们可以利用XPath，来快速的定位特定元素以及获取节点信息，我们在爬虫中会大量使用LXML来进行数据的提取等</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">XPATH的节点选择</span></font></div></li><ul><li><div><span style="font-size: 9pt; color: rgb(167, 69, 0);">常用节点选择工具：</span></div></li><ul><li><div><span style="font-size: 9pt;">Chrome插件 XPath Helper</span></div></li><li><div><span style="font-size: 9pt;">开源的XPath表达式编辑工具:XMLQuire(XML格式文件可用)</span></div></li><li><div><span style="font-size: 9pt;">Firefox插件 XPath Checker</span></div></li></ul><li><div><span style="font-size: 9pt; color: rgb(167, 69, 0); line-height: 13.6px;">常用节点选择语法</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">介绍</span></div></li><ul><li><div><span style="font-size: 9pt;">XPath 使用路径表达式来选取 XML 文档中的节点或者节点集。这些路径表达式和我们在常规的电脑文件系统中看到的表达式非常相似。</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">通过路径选择节点</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">/        在路径最开始表示根节点，后面的/代表层级关系，可以选择当前层级的下一层元素</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">//       在最开始表示根节点，后面//代表层级关系，可以选择当前层级的所有后代元素</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">/.       选取当前节点</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">/..      选取当前节点的父节点</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">/@attribute_name    获取节点的属性</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">//@</span><span style="font-size: 9pt; line-height: 13.6px;">attribute_name      选取节点包含节点后代元素的所有属性</span></div></li></ul><li><div><span style="font-size: 9pt;">/text()     获取文本中的内容（不包含文本中的标签）</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">//text( )    获取节点包含节点后代元素的所有文本内容</span></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">选择未知节点</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">/*                匹配当前节点下的所有节点元素</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">/@*            匹配当前节点的所有属性</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">/node()      匹配任意节点，用于过度，不明确目标节点和当前节点之间关系时候使用</span></div></li></ul><li><div><font style="font-size: 9pt;">节点轴的选择</font></div></li><ul><li><div><font style="font-size: 9pt;">/preceding-sibling::*    匹配节点之前的同级节点</font></div></li><li><div><font style="font-size: 9pt;">/following-sibling::*     匹配节点之后的同级节点</font></div></li><li><div><font style="font-size: 9pt;">/ancestor::*                   匹配该节点的祖先节点</font></div></li><li><div><font style="font-size: 9pt;">/descendant::*              匹配节点的子孙节点</font></div></li></ul></ul></ul></ul></ul><ul><ul><ul><li><div><font style="font-size: 9pt;">/child::*                         匹配节点的子节点</font></div></li><li><div><font style="font-size: 9pt;">/following::*                  匹配节点之后的所有节点</font></div></li><li><div><font style="font-size: 9pt;">/preceding::*                 匹配节点之前的所有节点</font></div></li><li><div><font style="font-size: 9pt;">/attribute::*                   匹配节点的所有属性</font></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">条件选择节点（条件放在括号中）----谓语</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">/book[1]                选取结果集的第一个元素</span></font></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">XPATH选取元素的开始索引为1，和列表的起始值不一样</span></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">/book[last()]         选取结果集的最后一个元素</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">/book[last() - 1]    选取结果集的倒数第二个元素</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">/book[position() &lt; 3]      选取结果集的前两个元素</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">//titie[@lang]      选取结果集中带lang元素的属性的元素</span></div></li><li><div><span style="line-height: 13.6px; font-size: 9pt;">//title[@lang='eng']       选取结果集带lang属性， 且为eng的元素</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">还可以加文本限制, 例如：//title[text()='下一页']</span></div></li></ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">//a[contains(text(), '下一页')]     选取结果集的文本内容包含'下一页'的元素</span></div></li><ul><li><div><span style="line-height: 13.6px; font-size: 9pt;">还可以加属性的限制，例如：//a[contains(@class, '下一页')]</span></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">//a[not (</span><span style="font-size: 9pt; line-height: 13.6px;">@class='1'</span><span style="font-size: 9pt; line-height: 13.6px;">)]      表示不包含该属性的标签元素</span></font></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">选取多路径节点</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">节点表达式1 | 节点表达式2   选取节点表达式1和节点表达式2所选取的所有节点；</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">备注</span></div></li><ul><li><div><span style="font-size: 9pt;">使用chrome插件选择标签时候，选中时，选中的标签会添加属性class=&quot;xh-highlight&quot;</span></div></li></ul></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; font-weight: bold; line-height: 13.6px;">在python中XPATH的使用（lxml库）</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; color: rgb(167, 69, 0); line-height: 13.6px;">通过lxml使用XPATH的方法</span><span style="font-size: 9pt; color: rgb(167, 69, 0); line-height: 1.45;">  </span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">pip install lxml</span></font></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">如果安装lxml失败，可以尝试安装anaconda软件，基本上可以解决所有环境问题</span></div></li></ul><li><div><span style="font-size: 9pt;">from lxml import etree       到如lxml库中的etree模块</span></div></li><li><div><span style="font-size: 9pt;">html = etree.HTML(text)            将html字符串转化为Element对象</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">返回的html是Element对象</span></div></li><li><div><span style="font-size: 9pt;">Element对象可以使用xpath的方法，对html字符串进行查询和修改；</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">text可以是str类型也可以是bytes类型（当标签中存在encoding属性的时候，text一定要是bytes类型）</span></div></li></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">list = html.xpath(' xpath语句 ')     使用xpath语句，返回查询结果组成的列表</span></div></li><ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">返回的是由Element节点对象组成的列表，每一个对象都可以使用Xpath方法；</span></div></li><li><div><span style="font-size: 9pt; line-height: 13.6px;">如果没有内容，返回的是一个空列表</span></div></li><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 13.6px;">text()  获取文本内容的时候，注意，当一段文字被标签</span><span style="font-size: 9pt; line-height: 13.6px;">拆</span><span style="font-size: 9pt; line-height: 13.6px;">分成多段的时候，每遇到一个标签便会被拆分成一个列表元素</span></font></div></li></ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">etree.tostring(html).decode()       将Element对象转化为字符串</span></font></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">etree.tostring(html)    返回值为</span><span style="font-size: 9pt; font-weight: bold; line-height: 1.45;">bytes</span><span style="font-size: 9pt; line-height: 1.45;">类型数据，如果需要str需要手动解码</span></font></div></li></ul></ul><li><div><span style="font-size: 9pt; line-height: 13.6px;">备注：</span></div></li><ul><li><div><font style="font-size: 9pt;"><span style="font-size: 9pt; line-height: 1.45;">lxml 会自动修正 html 代码，lxml会自动将html代码中的异常部分进行修改，但是有的时候，会有将代码修改错误的情况，所以这种情况我们需要查看lxml修改后的代码，再根据修改后的</span><span style="font-size: 9pt; line-height: 1.45;">代码进行操作</span></font></div></li></ul></ul></ul><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html>